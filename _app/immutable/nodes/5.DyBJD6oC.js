import{f as p,a as u,c as Ue,t as zt}from"../chunks/CEbVEvWq.js";import{o as ia}from"../chunks/DG6bnxrc.js";import{O as tt,S as s,U as i,J as e,I as D,K as c,T as a,Q as P,R as at,G as la,M as Je,aJ as vt,u as je,aI as le,af as pt,aK as Pt,P as We,aL as Bt,aC as yt}from"../chunks/DISrue0C.js";import{d as lt}from"../chunks/BWz26xft.js";import{i as x}from"../chunks/DqJZiQ1o.js";import{r as ft,a as wt,s as mt,b as ca}from"../chunks/eICFcUV5.js";import{p as Be,b as It}from"../chunks/CepRIdbm.js";import{s as y}from"../chunks/DHKgQpv7.js";import{s as Oe,a as ua,c as da,r as Rt}from"../chunks/DeimN4pl.js";import{M as Ve,a as Lt,b as O,c as pa,U as Ut,Z as va,B as ga,S as ha,T as fa,d as ma,e as _a,G as ba,g as ya,A as Ia,f as ht}from"../chunks/Cd-QzTh5.js";import{q as Yt,r as rt,v as wa,w as xa,e as He,i as Xe,b as Ft,D as Sa,t as Mt,x as Ca,y as Na,z as Ht,T as Aa,a as Ea,A as Ra,c as xt,B as Xt,G as Ga,E as Kt,W as qe,f as Ta,k as Da,F as Pa,H as Fa,I as ka,J as La,K as Ma,L as Zt,C as Wa,M as Gt,s as Oa,S as za,g as Vt,h as qt,N as Ua,U as Za,o as Va,p as qa,m as ja,n as Ba}from"../chunks/BalJhbXZ.js";import{b as Jt,A as Ya}from"../chunks/CEv-pqVm.js";import{g as jt}from"../chunks/DB_aGq-d.js";const Ha=!0,xo=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ha},Symbol.toStringTag,{value:"Module"}));var Xa=p('<div class="uno-4maolu"><div class="uno-senp7v"></div> <p class="uno-l6h9uf">Scanning folder structure...</p></div>'),Ka=p('<div class="uno-laclbo"><p class="uno-dl0t86"> </p></div>'),Ja=p('<div class="uno-tm086o"><button><h1 class="uno-brv6u2">Select Root Folder</h1> <p class="uno-l6h9uf">Select the folder containing manga subfolders with .zip files</p> <input class="uno-qya2ty" type="file"/></button> <!> <!></div>');function Qa(Ie,t){tt(t,!0);let n=Be(t,"guidedState",7),r=Be(t,"class",3,""),h=D(null),I=D(!1);async function l(A){c(I,!0);const M=A.target,ne=Array.from(M.files??[]),B=[];for(const K of ne){const _e=(K.webkitRelativePath||K.name).split("/").filter(Boolean);if(_e.length>=2){const Se=_e[0],fe=_e[0],me=K.name.split(".").pop()?.toLowerCase();(me==="zip"||me==="cbz")&&B.push({file:K,mangaFolderName:Se,mangaFolderPath:fe})}}n().rootFolderFiles=ne,n().zipFiles=B.map(K=>({...K,status:Ve.PENDING})),c(I,!1),t.onDone()}function R(A){e(h)?.click()}var S=Ja(),L=s(S);L.__click=R;var H=i(s(L),4);H.webkitdirectory=!0,H.multiple=!0,H.__change=l,It(H,A=>c(h,A),()=>e(h)),a(L);var X=i(L,2);{var q=A=>{var M=Xa();u(A,M)};x(X,A=>{e(I)&&A(q)})}var ae=i(X,2);{var Y=A=>{var M=Ka(),ne=s(M),B=s(ne);a(ne),a(M),P(()=>y(B,`Found ${n().zipFiles.length??""} zip file${n().zipFiles.length===1?"":"s"}`)),u(A,M)};x(ae,A=>{n().zipFiles.length>0&&A(Y)})}a(S),P(()=>{Oe(L,1,`uno-a4tqjo ${r()??""}`),L.disabled=e(I)}),u(Ie,S),at()}lt(["click","change"]);class $a{#e=D(null);get legacyToWeebdexMap(){return e(this.#e)}set legacyToWeebdexMap(t){c(this.#e,t,!0)}#t=D(null);get weebdexToLegacyMap(){return e(this.#t)}set weebdexToLegacyMap(t){c(this.#t,t,!0)}#a=D(!1);get isLoading(){return e(this.#a)}set isLoading(t){c(this.#a,t,!0)}#s=D(null);get loadError(){return e(this.#s)}set loadError(t){c(this.#s,t,!0)}loadPromise=null;async load(){if(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)return;if(this.loadPromise)return this.loadPromise;this.isLoading=!0,this.loadError=null;let t,n;this.loadPromise=new Promise((r,h)=>{t=r,n=h});try{const r=ua("/weebdex_lookup.csv"),h=await fetch(r);if(!h.ok)throw new Error(`Failed to fetch CSV: ${h.status} ${h.statusText}`);const I=await h.text(),{legacyToWeebdex:l,weebdexToLegacy:R}=this.parseCSV(I);this.legacyToWeebdexMap=l,this.weebdexToLegacyMap=R,t()}catch(r){this.loadError=r instanceof Error?r:new Error("Unknown error loading CSV"),n(this.loadError)}finally{this.isLoading=!1}return this.loadPromise}async ensureLoaded(){if(!(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)){if(this.loadPromise){await this.loadPromise;return}await this.load()}}parseCSV(t){const n=Yt(t,{columns:!0,skip_empty_lines:!0,trim:!0}),r=new rt,h=new rt;for(const I of n){const l=I.weebdex_id?.trim()||"",R=I.legacy_id?.trim()||"";l&&R&&(r.set(R,l),h.set(l,R))}return{legacyToWeebdex:r,weebdexToLegacy:h}}async getWeebdexIdFromLegacyId(t){return await this.ensureLoaded(),this.legacyToWeebdexMap===null?null:this.legacyToWeebdexMap.get(t)||null}async getLegacyIdFromWeebdexId(t){return await this.ensureLoaded(),this.weebdexToLegacyMap===null?null:this.weebdexToLegacyMap.get(t)||null}}const ut=new $a,Tt="completedWeebdexIds",it="completedWeebdexIdsV2";class es{#e=D(Je([]));get _sessions(){return e(this.#e)}set _sessions(t){c(this.#e,t,!0)}#t=D(Je([]));get _allCombinedIds(){return e(this.#t)}set _allCombinedIds(t){c(this.#t,t,!0)}#a=D(Je([]));get _allLegacyIds(){return e(this.#a)}set _allLegacyIds(t){c(this.#a,t,!0)}constructor(){this.migrateIfNeeded().then(()=>{this.loadData()}),this.loadData()}get sessions(){return this._sessions}get allCombinedIds(){return this._allCombinedIds}get allLegacyIds(){return this._allLegacyIds}async migrateIfNeeded(){if(typeof window>"u"||localStorage.getItem(it))return;const t=localStorage.getItem(Tt);if(t)try{const n=JSON.parse(t),r={};await ut.load();for(const[h,I]of Object.entries(n)){const l=[];for(const R of I){const S=await ut.getLegacyIdFromWeebdexId(R);l.push({weebdexId:R,legacyId:S})}r[h]=l}localStorage.setItem(it,JSON.stringify(r)),localStorage.removeItem(Tt)}catch(n){console.error("Failed to migrate completed IDs:",n)}}async addCompletedId(t,n){if(!(typeof window>"u"))try{await ut.load();const r=await ut.getLegacyIdFromWeebdexId(n),h=JSON.parse(localStorage.getItem(it)||"{}");h[t]||(h[t]=[]),h[t].some(l=>l.weebdexId===n)||(h[t].push({weebdexId:n,legacyId:r}),localStorage.setItem(it,JSON.stringify(h)),this.loadData())}catch(r){console.error("Failed to save weebdex ID to localStorage:",r)}}loadData(){if(!(typeof window>"u"))try{const t=JSON.parse(localStorage.getItem(it)||"{}");this._sessions=Object.entries(t).map(([h,I])=>({timestamp:h,ids:[...I]})).sort((h,I)=>I.timestamp.localeCompare(h.timestamp));const n=[],r=[];for(const h of this._sessions)for(const I of h.ids)n.includes(I.weebdexId)||n.push(I.weebdexId),I.legacyId&&!r.includes(I.legacyId)&&r.push(I.legacyId);this._allCombinedIds=n.sort(),this._allLegacyIds=r.sort()}catch(t){console.error("Failed to load completed IDs from localStorage:",t),this._sessions=[],this._allCombinedIds=[],this._allLegacyIds=[]}}deleteSession(t){if(!(typeof window>"u"))try{const n=JSON.parse(localStorage.getItem(it)||"{}");n[t]&&(delete n[t],localStorage.setItem(it,JSON.stringify(n)),this.loadData())}catch(n){console.error("Failed to delete session:",n)}}clearAll(){typeof window>"u"||(localStorage.removeItem(it),localStorage.removeItem(Tt),this.loadData())}getSessionIds(t){return this._sessions.find(r=>r.timestamp===t)?.ids.map(r=>r.weebdexId)||[]}async importLegacyIds(t){if(typeof window>"u")return{imported:0,failed:0};try{await ut.load();const r=`imported-${Date.now()}`,h=JSON.parse(localStorage.getItem(it)||"{}");h[r]||(h[r]=[]);let I=0,l=0;for(const R of t){const S=R.trim();if(S)try{const L=await ut.getWeebdexIdFromLegacyId(S);L?h[r].some(X=>X.weebdexId===L)||(h[r].push({weebdexId:L,legacyId:S}),I++):l++}catch(L){console.error(`Failed to lookup weebdex ID for legacy ID ${S}:`,L),l++}}return I>0&&(localStorage.setItem(it,JSON.stringify(h)),this.loadData()),{imported:I,failed:l}}catch(n){return console.error("Failed to import legacy IDs:",n),{imported:0,failed:t.length}}}}const Wt=la(),Dt="restored-ids-sheet-url";class ts{#e=D(null);get _data(){return e(this.#e)}set _data(t){c(this.#e,t,!0)}#t=D(null);get _legacyIdMap(){return e(this.#t)}set _legacyIdMap(t){c(this.#t,t,!0)}#a=D(Je([]));get _allRestoredWeebdexIds(){return e(this.#a)}set _allRestoredWeebdexIds(t){c(this.#a,t,!0)}#s=D(Je([]));get _allRestoredLegacyIds(){return e(this.#s)}set _allRestoredLegacyIds(t){c(this.#s,t,!0)}#r=D(!1);get isLoading(){return e(this.#r)}set isLoading(t){c(this.#r,t,!0)}#o=D(null);get loadError(){return e(this.#o)}set loadError(t){c(this.#o,t,!0)}loadPromise=null;#n=D("");get _sheetUrl(){return e(this.#n)}set _sheetUrl(t){c(this.#n,t,!0)}constructor(){this._sheetUrl=this.getSheetUrlFromStorage(),this.load()}get sheetUrl(){return this._sheetUrl}setSheetUrl(t){this._sheetUrl=t.trim(),this.saveSheetUrlToStorage(this._sheetUrl)}normalizeSheetUrl(t){if(!t)return t;const n=/https:\/\/docs\.google\.com\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/,r=t.match(n);if(!r)return t;const h=r[1],I=t.match(/[#&]gid=(\d+)/),l=I?I[1]:"0";return`https://docs.google.com/spreadsheets/d/${h}/export?format=csv&gid=${l}`}getSheetUrlFromStorage(){if(typeof localStorage>"u")return"";try{return localStorage.getItem(Dt)||""}catch(t){return console.error("Failed to load sheet URL from localStorage:",t),""}}saveSheetUrlToStorage(t){if(!(typeof localStorage>"u"))try{t?localStorage.setItem(Dt,t):localStorage.removeItem(Dt)}catch(n){console.error("Failed to save sheet URL to localStorage:",n)}}async reload(){this._data=null,this._legacyIdMap=null,this._allRestoredWeebdexIds=[],this._allRestoredLegacyIds=[],this.loadPromise=null,await this.load()}get allRestoredWeebdexIds(){return this._allRestoredWeebdexIds}get allRestoredLegacyIds(){return this._allRestoredLegacyIds}async load(){if(this._data!==null&&this._legacyIdMap!==null)return;if(this.loadPromise)return this.loadPromise;this.isLoading=!0,this.loadError=null;let t,n;this.loadPromise=new Promise((r,h)=>{t=r,n=h});try{if(!this._sheetUrl){this._data=new rt,this._legacyIdMap=new rt,this._allRestoredWeebdexIds=[],this._allRestoredLegacyIds=[],t();return}const r=this.normalizeSheetUrl(this._sheetUrl),h=await fetch(r);if(!h.ok)throw new Error(`Failed to fetch sheet: ${h.status} ${h.statusText}`);const I=await h.text(),{data:l,legacyIdMap:R,restoredWeebdexIds:S,restoredLegacyIds:L}=this.parseCSV(I);this._data=l,this._legacyIdMap=R,this._allRestoredWeebdexIds=S,this._allRestoredLegacyIds=L,t()}catch(r){this.loadError=r instanceof Error?r:new Error("Unknown error loading restored IDs CSV"),this._data=new rt,this._legacyIdMap=new rt,this._allRestoredWeebdexIds=[],this._allRestoredLegacyIds=[],n(this.loadError)}finally{this.isLoading=!1}return this.loadPromise}async ensureLoaded(){if(!(this._data!==null&&this._legacyIdMap!==null)){if(this.loadPromise){await this.loadPromise;return}await this.load()}}parseCSV(t){const n=Yt(t,{columns:!0,skip_empty_lines:!0,trim:!0}),r=new rt,h=new rt,I=[],l=[];for(const R of n){const S=R.weebdex_id?.trim()||"",L=R.legacy_mangadex_id?.trim()||"",H=R.mangadex_id?.trim()||"",X=R.restored?.trim().toUpperCase()==="TRUE";if(S){const q={mangadexId:H,weebdexId:S,legacyMangadexId:L,restored:X};r.set(S,q),L&&h.set(L,q),X&&(I.push(S),L&&l.push(L))}}return{data:r,legacyIdMap:h,restoredWeebdexIds:I.sort(),restoredLegacyIds:l.sort()}}async isRestoredByWeebdexId(t){return await this.ensureLoaded(),this._data===null?!1:this._data.get(t)?.restored??!1}async isRestoredByLegacyId(t){return await this.ensureLoaded(),this._legacyIdMap===null?!1:this._legacyIdMap.get(t)?.restored??!1}async getEntryByWeebdexId(t){return await this.ensureLoaded(),this._data===null?null:this._data.get(t)||null}async getEntryByLegacyId(t){return await this.ensureLoaded(),this._legacyIdMap===null?null:this._legacyIdMap.get(t)||null}async existsInSpreadsheet(t){return await this.ensureLoaded(),this._data===null?!1:this._data.has(t)}async existsInSpreadsheetByLegacyId(t){return await this.ensureLoaded(),this._legacyIdMap===null?!1:this._legacyIdMap.has(t)}}const Qt=new ts;function as(Ie){const t=wa(Ie,0);return xa(Ie,t,0,[])}function ss(Ie,t="v(\\d+)"){const n=new RegExp(t,"i"),r=Ie.match(n);return r&&r[1]?r[1].replace(/^0+/,"")||"0":null}function rs(Ie,t="c(\\d+(?:\\.\\d+){0,2})"){const n=new RegExp(t,"i"),r=Ie.match(n);if(r&&r[1]){const h=r[1];if(h.includes(".")){const I=h.split(".");return[I[0].replace(/^0+/,"")||"0",...I.slice(1)].join(".")}else return h.replace(/^0+/,"")||"0"}return null}function kt(Ie){const t=/MD-(\d+)/i,n=Ie.match(t);return n?n[1]:null}var os=p(`<div class="uno-x7vsh7"><label for="legacy-id-input" class="uno-kd6uvm">Batch Select by Legacy IDs (MD-#### format, one per line)</label> <textarea id="legacy-id-input" placeholder="MD-12345 MD-67890 12345 67890" class="uno-rlhew9 bg-background focus:ring-primary"></textarea> <div class="uno-qdzwro"><button type="button" class="uno-kaum0q">Select Matching Files</button> <button type="button" class="uno-lisxcn">Clear</button></div> <p class="uno-42pivu">Enter legacy IDs in MD-#### format (e.g., "MD-12345") or just the numeric part (e.g.,
					"12345"). One ID per line. Matching zip files will be selected.</p></div>`),ns=p('<p class="uno-t17h6o">Filtering zip files...</p>'),is=p("<span> </span>"),ls=p("<span> </span>"),cs=p("<span> </span>"),us=p('<div class="uno-1dfxdr"><p class="uno-t17h6o"> </p> <div class="uno-f3g7m9"><!> <!> <!></div></div>'),ds=p('<button type="button"><div class="uno-bpywdh"><p class="uno-98yf80"> </p> <p class="uno-42pivu"> </p></div> <input type="checkbox" class="uno-5onsv4"/></button>'),ps=p('<div class="uno-o40niy"><div class="uno-iuhcpm"><h3 class="uno-0lb4rh"> </h3> <button type="button" class="uno-phh4jd"> </button></div> <div class="uno-fb55wk"></div></div>'),vs=p('<div><div class="uno-iuhcpm"><h2 class="uno-iyer7g">Select Zip Files to Process</h2> <div class="uno-13hhk0"><div class="uno-13hhk0"><label class="uno-6exdwe"><input type="checkbox" class="uno-tpxhk2"/> <span class="uno-ok9xip">Hide completed (local)</span></label> <label class="uno-6exdwe"><input type="checkbox" class="uno-tpxhk2"/> <span class="uno-ok9xip">Hide restored (sheet)</span></label></div> <button type="button" class="uno-f45w65"> </button></div></div> <div class="uno-o40niy"><button type="button" class="uno-14oovc"> </button> <!></div> <div class="uno-1dfxdr"><p class="uno-ok9xip"> </p> <!></div> <div class="uno-yjimjk"></div> <button type="button" class="uno-3s4o5e"> </button></div>');function gs(Ie,t){tt(t,!0);let n=Be(t,"guidedState",7),r=Be(t,"class",3,"");const h=vt(Wt),I=Qt;let l=D(!0),R=D(!0),S=D(""),L=D(!1);function H(z){n().selectedZipFiles.indexOf(z)>=0?n().selectedZipFiles=n().selectedZipFiles.filter(we=>we!==z):n().selectedZipFiles=[...n().selectedZipFiles,z]}function X(z){const te=Array.from(n().zipFilesByMangaFolder.get(z)??[]);if(te.every(ie=>n().selectedZipFiles.includes(ie.file)))n().selectedZipFiles=n().selectedZipFiles.filter(ie=>!te.some(ge=>ge.file===ie));else{const ie=te.map(ge=>ge.file).filter(ge=>!n().selectedZipFiles.includes(ge));n().selectedZipFiles=[...n().selectedZipFiles,...ie]}}const q=le(()=>{const z=[];for(const te of e(M).values())for(const we of te)z.push(we.file);return z});function ae(){const z=e(q);if(z.every(we=>n().selectedZipFiles.includes(we)))n().selectedZipFiles=n().selectedZipFiles.filter(we=>!z.includes(we));else{const we=z.filter(ie=>!n().selectedZipFiles.includes(ie));n().selectedZipFiles=[...n().selectedZipFiles,...we]}}const Y=le(()=>{const z=e(q);return z.length>0&&z.every(te=>n().selectedZipFiles.includes(te))}),A=le(()=>h.allLegacyIds);let M=D(Je(new Map)),ne=D(!1),B=0,K=D(0),ve=D(0),_e=D(0);je(()=>{const z=e(l),te=e(R),we=n().zipFilesByMangaFolder,ie=++B;c(ne,!0),I.load().then(()=>{ie===B&&(async()=>{const ge=new Map;let de=0,se=0,be=0;for(const[W,V]of we.entries())if(z||te){const Q=[];for(const ye of V){const Ge=kt(ye.file.name);if(!Ge){Q.push(ye);continue}let g=!1,_=!1;te&&(_=await I.isRestoredByLegacyId(Ge)),z&&(g=e(A)&&e(A).includes(Ge)),g&&_?be++:_?se++:g?de++:Q.push(ye)}Q.length>0&&ge.set(W,Q)}else ge.set(W,Array.from(V));ie===B&&(c(M,ge,!0),c(K,de,!0),c(ve,se,!0),c(_e,be,!0),c(ne,!1))})()})});function Se(z){const te=new Set,we=z.split(`
`).map(ie=>ie.trim()).filter(ie=>ie.length>0);for(const ie of we){const ge=/MD-(\d+)/i,de=ie.match(ge);if(de){te.add(de[1]);continue}const se=/^(\d+)$/,be=ie.match(se);be&&te.add(be[1])}return te}function fe(){const z=Se(e(S));if(z.size===0)return;const te=[];for(const ie of n().zipFiles){const ge=kt(ie.file.name);ge&&z.has(ge)&&te.push(ie.file)}const we=te.filter(ie=>!n().selectedZipFiles.includes(ie));n().selectedZipFiles=[...n().selectedZipFiles,...we],c(S,""),c(L,!1)}var me=vs(),U=s(me),J=i(s(U),2),F=s(J),re=s(F),ce=s(re);ft(ce),ce.__change=z=>{c(l,z.target.checked,!0)},pt(2),a(re);var w=i(re,2),m=s(w);ft(m),m.__change=z=>{c(R,z.target.checked,!0)},pt(2),a(w),a(F);var j=i(F,2);j.__click=ae;var Ce=s(j,!0);a(j),a(J),a(U);var he=i(U,2),Pe=s(he);Pe.__click=()=>{c(L,!e(L))};var ke=s(Pe);a(Pe);var Fe=i(Pe,2);{var Le=z=>{var te=os(),we=i(s(te),2);Pt(we);var ie=i(we,2),ge=s(ie);ge.__click=fe;var de=i(ge,2);de.__click=()=>{c(S,"")},a(ie),pt(2),a(te),P(se=>ge.disabled=se,[()=>!e(S).trim()]),Ft(we,()=>e(S),se=>c(S,se)),u(z,te)};x(Fe,z=>{e(L)&&z(Le)})}a(he);var E=i(he,2),k=s(E),oe=s(k);a(k);var ue=i(k,2);{var Ee=z=>{var te=ns();u(z,te)},Ne=z=>{var te=Ue(),we=We(te);{var ie=ge=>{const de=le(()=>e(K)+e(ve)+e(_e));var se=Ue(),be=We(se);{var W=V=>{var Q=us(),ye=s(Q),Ge=s(ye);a(ye);var g=i(ye,2),_=s(g);{var T=C=>{var G=is(),v=s(G);a(G),P(()=>y(v,`Completed: ${e(K)??""}`)),u(C,G)};x(_,C=>{e(l)&&e(K)>0&&C(T)})}var o=i(_,2);{var d=C=>{var G=ls(),v=s(G);a(G),P(()=>y(v,`Restored: ${e(ve)??""}`)),u(C,G)};x(o,C=>{e(R)&&e(ve)>0&&C(d)})}var f=i(o,2);{var b=C=>{var G=cs(),v=s(G);a(G),P(()=>y(v,`Both: ${e(_e)??""}`)),u(C,G)};x(f,C=>{e(_e)>0&&C(b)})}a(g),a(Q),P(()=>y(Ge,`Total hidden: ${e(de)??""} zip file${e(de)===1?"":"s"}`)),u(V,Q)};x(be,V=>{e(de)>0&&V(W)})}u(ge,se)};x(we,ge=>{(e(l)||e(R))&&ge(ie)},!0)}u(z,te)};x(ue,z=>{e(ne)?z(Ee):z(Ne,!1)})}a(E);var Ae=i(E,2);He(Ae,21,()=>Array.from(e(M).entries()),Xe,(z,te)=>{var we=le(()=>Bt(e(te),2));let ie=()=>e(we)[0],ge=()=>e(we)[1];var de=ps(),se=s(de),be=s(se),W=s(be,!0);a(be);var V=i(be,2);V.__click=()=>X(ie());var Q=s(V);a(V),a(se);var ye=i(se,2);He(ye,21,ge,Xe,(Ge,g)=>{const _=le(()=>n().selectedZipFiles.includes(e(g).file));var T=ds();T.__click=()=>H(e(g).file);var o=s(T),d=s(o),f=s(d,!0);a(d);var b=i(d,2),C=s(b);a(b),a(o);var G=i(o,2);ft(G),a(T),P(v=>{Oe(T,1,`uno-ik4adi ${e(_)?"uno-1k75dk":""}`),y(f,e(g).file.name),y(C,`Size: ${v??""} MB`),wt(G,e(_))},[()=>(e(g).file.size/(1024*1024)).toFixed(2)]),u(Ge,T)}),a(ye),a(de),P(Ge=>{y(W,ie()),y(Q,`${Ge??""} (${ge().length??""})`)},[()=>ge().every(Ge=>n().selectedZipFiles.includes(Ge.file))?"Deselect All":"Select All"]),u(z,de)}),a(Ae);var Ze=i(Ae,2);Ze.__click=function(...z){t.onDone?.apply(this,z)};var Ke=s(Ze);a(Ze),a(me),P(()=>{Oe(me,1,`uno-grwdkw ${r()??""}`),wt(ce,e(l)),wt(m,e(R)),y(Ce,e(Y)?"Deselect All":"Select All"),y(ke,`${e(L)?"Hide":"Show"} Batch Select by Legacy IDs`),y(oe,`${n().selectedZipFiles.length??""} of ${e(q).length??""} visible zip file${e(q).length===1?"":"s"} selected`),Ze.disabled=n().selectedZipFiles.length===0,y(Ke,`Continue to Processing (${n().selectedZipFiles.length??""} selected)`)}),u(Ie,me),at()}lt(["change","click"]);var hs=p('<p class="uno-a54tpo"> </p>'),fs=p('<div class="uno-cqccui"><p class="uno-nsysfu"> </p> <span> </span></div> <!>',1),ms=p('<p class="uno-b7m48p">No zip file selected</p>'),_s=p('<button type="button" class="uno-qm31yq"> </button>'),bs=p('<p class="uno-b7m48p">No more zip files to process</p>'),ys=p("<div><!></div>"),Is=p('<p class="uno-b7m48p">All zip files have been completed</p>'),ws=p('<button type="button" class="uno-4y4l6m"> </button>'),xs=p('<div class="uno-2db0z0"><h3 class="uno-tniapq"> </h3> <div class="uno-ouywhe"></div></div>'),Ss=p('<button type="button" class="uno-qy4bc0"> </button>'),Cs=p('<div class="uno-2db0z0"><h3 class="uno-9iz2qs"> </h3> <div class="uno-ouywhe"></div></div>'),Ns=p('<div><div class="uno-0ia1w6 border-surface-hover"><h2 class="uno-1c2kr2">Zip Processing</h2> <div class="uno-cqccui"><span class="uno-d1zaof">Automation (experimental): <span> </span></span> <button type="button"> </button></div></div> <div class="uno-usvt4c"><div class="uno-cqccui"><span class="uno-4ezlml"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-1l1bmy"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-e545zy"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-mg1fk7"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-ip18dj"></span> <span class="uno-b7m48p"> </span></div></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Current Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Next Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Select Zip File</h3> <!></div> <!> <!></div>');function As(Ie,t){tt(t,!0);let n=Be(t,"guidedState",7),r=Be(t,"class",3,"");const h=vt(Lt);if(!h)throw new Error("MangaProcessingTabs must be used within a component that provides AutomationState context");function I(){if(n().moveToNextZip()){const W=n().currentZip;W&&t.onZipSelected(W.file)}}function l(W){const V=n().zipFiles.find(Q=>Q.file.name===W);if(V){const Q=n().zipFiles.findIndex(ye=>ye.file===V.file);Q>=0&&(n().currentZipIndex=Q,t.onZipSelected(V.file))}}function R(){h.enabled?h.disable():h.enable()}const S=le(()=>n().currentZip?.file.name??null),L=le(()=>n().warningZips.map(W=>W.file.name)),H=le(()=>n().errorZips.map(W=>W.file.name)),X=le(()=>n().unprocessedZips.map(W=>W.file.name)),q=le(()=>n().nextZip?.file.name??null),ae=le(()=>n().pendingZips.length===0&&(n().warningZips.length>0||n().errorZips.length>0));je(()=>{e(ae)&&h.isActive&&h.disable()});let Y=D(null);je(()=>{c(Y,n().currentZip?.file.name??null,!0)}),je(()=>{const W=e(Y);if(W){const V=n().currentZip?.file.name??null;W!==V&&l(W)}});const A=le(()=>({pending:n().pendingZips.length,warning:n().warningZips.length,error:n().errorZips.length,completed:n().completedZips.length,processing:n().processingZips.length}));var M=Ns(),ne=s(M),B=i(s(ne),2),K=s(B),ve=i(s(K)),_e=s(ve,!0);a(ve),a(K);var Se=i(K,2);Se.__click=R;var fe=s(Se,!0);a(Se),a(B),a(ne);var me=i(ne,2),U=s(me),J=i(s(U),2),F=s(J);a(J),a(U);var re=i(U,2),ce=i(s(re),2),w=s(ce);a(ce),a(re);var m=i(re,2),j=i(s(m),2),Ce=s(j);a(j),a(m);var he=i(m,2),Pe=i(s(he),2),ke=s(Pe);a(Pe),a(he);var Fe=i(he,2),Le=i(s(Fe),2),E=s(Le);a(Le),a(Fe),a(me);var k=i(me,2),oe=i(s(k),2);{var ue=W=>{var V=fs(),Q=We(V),ye=s(Q),Ge=s(ye,!0);a(ye);var g=i(ye,2),_=s(g,!0);a(g),a(Q);var T=i(Q,2);{var o=d=>{var f=hs(),b=s(f);a(f),P(()=>y(b,`Manga Folder: ${n().currentZip.mangaFolderName??""}`)),u(d,f)};x(T,d=>{n().currentZip&&d(o)})}P(()=>{y(Ge,e(S)),Oe(g,1,`uno-ielryd ${n().currentZip?.status===Ve.PROCESSING?"uno-kxa2ln":n().currentZip?.status===Ve.COMPLETED?"uno-b1425w":n().currentZip?.status===Ve.ERROR?"uno-isu16c":n().currentZip?.status===Ve.WARNING?"uno-enplrj":"uno-jwlzg2"}`),y(_,n().currentZip?.status??"UNKNOWN")}),u(W,V)},Ee=W=>{var V=ms();u(W,V)};x(oe,W=>{e(S)?W(ue):W(Ee,!1)})}a(k);var Ne=i(k,2),Ae=i(s(Ne),2);{var Ze=W=>{var V=_s();V.__click=I;var Q=s(V);a(V),P(()=>{V.disabled=h.enabled,y(Q,`Process: ${e(q)??""}`)}),u(W,V)},Ke=W=>{var V=bs();u(W,V)};x(Ae,W=>{e(q)?W(Ze):W(Ke,!1)})}a(Ne);var z=i(Ne,2),te=i(s(z),2);{var we=W=>{var V=ys(),Q=s(V);Sa(Q,{get items(){return e(X)},class:"uno-qbg2l1",get selectedItem(){return e(Y)},set selectedItem(ye){c(Y,ye,!0)}}),a(V),P(()=>Oe(V,1,da(h.enabled?"opacity-50 pointer-events-none":""))),u(W,V)},ie=W=>{var V=Is();u(W,V)};x(te,W=>{e(X).length>0?W(we):W(ie,!1)})}a(z);var ge=i(z,2);{var de=W=>{var V=xs(),Q=s(V),ye=s(Q);a(Q);var Ge=i(Q,2);He(Ge,21,()=>e(L),Xe,(g,_)=>{var T=ws();T.__click=()=>l(e(_));var o=s(T,!0);a(T),P(()=>{T.disabled=h.enabled,y(o,e(_))}),u(g,T)}),a(Ge),a(V),P(()=>y(ye,`‚ö†Ô∏è Warning Zips (${e(L).length??""})`)),u(W,V)};x(ge,W=>{e(L).length>0&&W(de)})}var se=i(ge,2);{var be=W=>{var V=Cs(),Q=s(V),ye=s(Q);a(Q);var Ge=i(Q,2);He(Ge,21,()=>e(H),Xe,(g,_)=>{var T=Ss();T.__click=()=>l(e(_));var o=s(T,!0);a(T),P(()=>{T.disabled=h.enabled,y(o,e(_))}),u(g,T)}),a(Ge),a(V),P(()=>y(ye,`‚ùå Error Zips (${e(H).length??""})`)),u(W,V)};x(se,W=>{e(H).length>0&&W(be)})}a(M),P(()=>{Oe(M,1,`uno-s0eao9 ${r()??""}`),Oe(ve,1,`uno-cvk0wv ${h.enabled?"uno-ikj4sb":"uno-je1lgh"}`),y(_e,h.enabled?"ON":"OFF"),Oe(Se,1,`uno-sv39f1 ${h.enabled?"uno-oxxvv6":"uno-dimr5c"}`),y(fe,h.enabled?"üîÑ Turn OFF":"‚ñ∂Ô∏è Turn ON"),y(F,`Pending: ${e(A).pending??""}`),y(w,`Processing: ${e(A).processing??""}`),y(Ce,`Warning: ${e(A).warning??""}`),y(ke,`Error: ${e(A).error??""}`),y(E,`Completed: ${e(A).completed??""}`)}),u(Ie,M),at()}lt(["click"]);var Es=p('<div class="uno-40a178"><p class="uno-707s42">No [XXXXX] patterns found in chapter paths.</p></div>'),Rs=p('<span class="uno-ouuw5g"> </span>'),Gs=p('<span class="uno-sn1qll">No groups assigned</span>'),Ts=p('<div class="uno-xq5l13"><span class="uno-elxrx7">Current groups:</span> <!></div>'),Ds=p("<option> </option>"),Ps=p('<div class="uno-5sf5p8"></div> <span>Assigning...</span>',1),Fs=p("<span>Assign</span>"),ks=p('<div class="uno-3u8hax"><div class="uno-foebq1"><div class="uno-3k1ps9"><span class="uno-q9t790"> </span> <span class="uno-elxrx7"> </span></div> <!></div> <div class="uno-3k1ps9"><select class="uno-04defk"><option>Select group...</option><!></select> <button type="button" class="uno-1ldvyy"><!></button></div></div>'),Ls=p('<div class="uno-j86ron"><p class="uno-3xkzo3"> </p> <div class="uno-eymfsi"></div></div>'),Ms=p(`<div><div class="uno-plb3a3"><h3 class="uno-rvu71q">Batch Group Assignment</h3> <button type="button" class="uno-m430kq"> </button></div> <p class="uno-707s42">Assign groups to multiple chapters based on [XXXXX] patterns found in their paths. Useful
		when groups have been renamed and automatic matching fails.</p> <!></div>`);function Ws(Ie,t){tt(t,!0);const n=vt(Mt);if(!n)throw new Error("BatchGroupAssignment must be used within a component that provides TargetingState context");let r=Be(t,"class",3,""),h=D(!1),I=Je(new rt),l=D(null);function R(){const M=new Map,ne=/\[([^\]]+)\]$/g;for(const B of t.chapters){const K=B.originalFolderPath;if(!K)continue;const ve=K.matchAll(ne);for(const _e of ve){const Se=_e[1];M.set(Se,(M.get(Se)||0)+1)}}return M}function S(M){return t.chapters.filter(ne=>ne.originalFolderPath?.includes(`[${M}]`)??!1)}async function L(M,ne){c(l,M,!0);try{const B=S(M);for(const K of B){K.associatedGroup.groupIds||(K.associatedGroup.groupIds=[]);const ve=new Ht(K.associatedGroup.groupIds);ve.has(ne)||(ve.add(ne),K.associatedGroup.groupIds=Array.from(ve))}await t.onGroupAssigned()}finally{c(l,null)}}var H=Ms(),X=s(H),q=i(s(X),2);q.__click=()=>{c(h,!e(h))};var ae=s(q);a(q),a(X);var Y=i(X,4);{var A=M=>{const ne=le(R),B=le(()=>Array.from(e(ne).entries()).sort((fe,me)=>me[1]-fe[1]));var K=Ue(),ve=We(K);{var _e=fe=>{var me=Es();u(fe,me)},Se=fe=>{var me=Ls(),U=s(me),J=s(U);a(U);var F=i(U,2);He(F,21,()=>e(B),Xe,(re,ce)=>{var w=le(()=>Bt(e(ce),2));let m=()=>e(w)[0],j=()=>e(w)[1];const Ce=le(()=>S(m())),he=le(()=>I.get(m())??null);var Pe=ks(),ke=s(Pe),Fe=s(ke),Le=s(Fe),E=s(Le);a(Le);var k=i(Le,2),oe=s(k);a(k),a(Fe);var ue=i(Fe,2);{var Ee=de=>{var se=Ts(),be=i(s(se),2);{var W=Q=>{var ye=Ue(),Ge=We(ye);He(Ge,17,()=>e(Ce)[0].associatedGroup.groupIds??[],Xe,(g,_)=>{const T=le(()=>n.availableScanGroups.find(f=>f.groupId===e(_)));var o=Rs(),d=s(o,!0);a(o),P(()=>y(d,e(T)?.groupName??e(_))),u(g,o)}),u(Q,ye)},V=Q=>{var ye=Gs();u(Q,ye)};x(be,Q=>{(e(Ce)[0].associatedGroup.groupIds?.length??0)>0?Q(W):Q(V,!1)})}a(se),u(de,se)};x(ue,de=>{e(Ce).length>0&&de(Ee)})}a(ke);var Ne=i(ke,2),Ae=s(Ne);Ae.__change=de=>{const se=de.target.value;I.set(m(),se||null)};var Ze=s(Ae);Ze.value=Ze.__value="";var Ke=i(Ze);He(Ke,17,()=>n.availableScanGroups,Xe,(de,se)=>{var be=Ds(),W=s(be,!0);a(be);var V={};P(()=>{y(W,e(se).groupName),V!==(V=e(se).groupId)&&(be.value=(be.__value=e(se).groupId)??"")}),u(de,be)}),a(Ae);var z;Ca(Ae);var te=i(Ae,2);te.__click=async()=>{e(he)&&(await L(m(),e(he)),I.set(m(),null))};var we=s(te);{var ie=de=>{var se=Ps();pt(2),u(de,se)},ge=de=>{var se=Fs();u(de,se)};x(we,de=>{e(l)===m()?de(ie):de(ge,!1)})}a(te),a(Ne),a(Pe),P(()=>{y(E,`[${m()??""}]`),y(oe,`(${j()??""} chapter${j()===1?"":"s"})`),Ae.disabled=e(l)===m(),z!==(z=e(he)??"")&&(Ae.value=(Ae.__value=e(he)??"")??"",Na(Ae,e(he)??"")),te.disabled=!e(he)||e(l)===m()}),u(re,Pe)}),a(F),a(me),P(()=>y(J,`Found ${e(B).length??""} unique pattern${e(B).length===1?"":"s"}:`)),u(fe,me)};x(ve,fe=>{e(B).length===0?fe(_e):fe(Se,!1)})}u(M,K)};x(Y,M=>{e(h)&&M(A)})}a(H),P(()=>{Oe(H,1,`uno-gwfhej ${r()??""}`),y(ae,`${e(h)?"Hide":"Show"} Batch Assign`)}),u(Ie,H),at()}lt(["click","change"]);var Os=p(`<p class="uno-8xr74j">‚ö†Ô∏è Waiting for series ID - Automation will skip this zip. Please select a series
				above.</p>`),zs=p('<p class="uno-8xr74j">‚ö†Ô∏è Ready with warnings - Automation will skip this zip. You can still upload manually.</p>'),Us=p("<p> </p>"),Zs=p("<p>‚Ä¢ Chapter dump lookup failed</p>"),Vs=p("<p> </p>"),qs=p("<p> </p>"),js=p("<p> </p>"),Bs=p("<p> </p>"),Ys=p("<p> </p>"),Hs=p("<p> </p>"),Xs=p("<p> </p>"),Ks=p('<div><!> <div class="uno-wp9zkq"><!> <!> <!> <!> <!> <!> <!> <!> <!></div></div>');function Js(Ie,t){tt(t,!0);let n=Be(t,"class",3,"");var r=Ue(),h=We(r);{var I=l=>{var R=Ks(),S=s(R);{var L=w=>{var m=Os();u(w,m)},H=w=>{var m=zs();u(w,m)};x(S,w=>{t.hasSeriesId?w(H,!1):w(L)})}var X=i(S,2),q=s(X);{var ae=w=>{var m=Us(),j=s(m);a(m),P(()=>y(j,`‚Ä¢ ${t.duplicateCount??""} duplicate chapter${t.duplicateCount===1?"":"s"} detected`)),u(w,m)};x(q,w=>{t.duplicateCount>0&&w(ae)})}var Y=i(q,2);{var A=w=>{var m=Zs();u(w,m)};x(Y,w=>{t.dumpLookupFailed&&t.dumpLookupFailedGroups.length===0&&t.dumpLookupFailedTitles===0&&w(A)})}var M=i(Y,2);{var ne=w=>{var m=Vs(),j=s(m);a(m),P(Ce=>y(j,`‚Ä¢ ${t.dumpLookupFailedGroups.length??""} group${t.dumpLookupFailedGroups.length===1?"":"s"} failed to lookup: ${Ce??""}`),[()=>t.dumpLookupFailedGroups.join(", ")]),u(w,m)};x(M,w=>{t.dumpLookupFailedGroups.length>0&&w(ne)})}var B=i(M,2);{var K=w=>{var m=qs(),j=s(m);a(m),P(()=>y(j,`‚Ä¢ ${t.dumpLookupFailedTitles??""} chapter title${t.dumpLookupFailedTitles===1?"":"s"} failed
					to resolve`)),u(w,m)};x(B,w=>{t.dumpLookupFailedTitles>0&&w(K)})}var ve=i(B,2);{var _e=w=>{var m=js(),j=s(m);a(m),P(()=>y(j,`‚Ä¢ ${t.partialGroupMatchesCount??""} chapter${t.partialGroupMatchesCount===1?"":"s"} with
					partial group match (matched 1 group, assigned all groups for release)`)),u(w,m)};x(ve,w=>{t.partialGroupMatchesCount>0&&w(_e)})}var Se=i(ve,2);{var fe=w=>{var m=Bs(),j=s(m);a(m),P(()=>y(j,`‚Ä¢ ${t.chaptersWithNoGroups??""} chapter${t.chaptersWithNoGroups===1?"":"s"} with no groups
					assigned`)),u(w,m)};x(Se,w=>{t.chaptersWithNoGroups>0&&w(fe)})}var me=i(Se,2);{var U=w=>{var m=Ys(),j=s(m);a(m),P(()=>y(j,`‚Ä¢ ${t.chaptersWithNoValidGroups??""} chapter${t.chaptersWithNoValidGroups===1?"":"s"} with
					no valid groups found`)),u(w,m)};x(me,w=>{t.chaptersWithNoValidGroups>0&&w(U)})}var J=i(me,2);{var F=w=>{var m=Hs(),j=s(m);a(m),P(()=>y(j,`‚Ä¢ ${t.chaptersWithNoChapterInfo??""} chapter${t.chaptersWithNoChapterInfo===1?"":"s"} not
					found in chapter dump`)),u(w,m)};x(J,w=>{t.chaptersWithNoChapterInfo>0&&w(F)})}var re=i(J,2);{var ce=w=>{var m=Xs(),j=s(m);a(m),P(()=>y(j,`‚Ä¢ ${t.chaptersWithVolumeMismatch??""} chapter${t.chaptersWithVolumeMismatch===1?"":"s"} with
					volume mismatch (volume corrected)`)),u(w,m)};x(re,w=>{t.chaptersWithVolumeMismatch>0&&w(ce)})}a(X),a(R),P(()=>Oe(R,1,`uno-th3lk3 ${n()??""}`)),u(l,R)};x(h,l=>{t.processingStep===O.READY_WARNING&&l(I)})}u(Ie,r),at()}var Qs=p('<div class="uno-4vtap6"><div class="uno-2b5jsa"><div class="uno-odv1cq"><p class="uno-mum1sz"> </p></div> <p class="uno-8gw4qb">Matched group: <span class="uno-ln01bh"> </span> </p></div></div>'),$s=p(`<div><div class="uno-qqu7xf"><p class="uno-wox1hl"> </p> <p class="uno-yk3blt">The following chapters matched only 1 group from the source, but the release has
				multiple groups. All groups for the release have been assigned automatically.</p></div> <div class="uno-4fudli"></div></div>`);function er(Ie,t){tt(t,!0);let n=Be(t,"class",3,"");var r=Ue(),h=We(r);{var I=l=>{var R=$s(),S=s(R),L=s(S),H=s(L);a(L),pt(2),a(S);var X=i(S,2);He(X,21,()=>t.partialGroupMatches,Xe,(q,ae)=>{let Y=()=>e(ae).chapter,A=()=>e(ae).matchedGroup,M=()=>e(ae).allGroups;var ne=Qs(),B=s(ne),K=s(B),ve=s(K),_e=s(ve);a(ve),a(K);var Se=i(K,2),fe=i(s(Se)),me=s(fe,!0);a(fe);var U=i(fe);a(Se),a(B),a(ne),P(J=>{y(_e,`Vol. ${Y().chapterVolume??"N/A"??""} Ch. ${Y().chapterNumber??"N/A"??""} - ${(Y().chapterTitle||Y().originalFolderPath||"Untitled")??""}`),y(me,A()),y(U,` | Assigned all
							groups: ${J??""}`)},[()=>M().join(", ")]),u(q,ne)}),a(X),a(R),P(()=>{Oe(R,1,`uno-ppslzy ${n()??""}`),y(H,`‚ö†Ô∏è Warning: ${t.partialGroupMatches.length??""} chapter${t.partialGroupMatches.length===1?"":"s"} with partial group match`)}),u(l,R)};x(h,l=>{t.partialGroupMatches.length>0&&l(I)})}u(Ie,r),at()}var tr=p('<span class="uno-n7jei2">Removed</span>'),ar=p('<div class="uno-4s4v5p"></div>'),sr=p('<div class="uno-l2wi0s"></div>'),rr=p('<div><div class="uno-sjk4st"><div class="uno-7w2kl9"><p class="uno-xwb9bu"> </p> <!></div> <p class="uno-van4zu"> </p></div> <button type="button"><!></button></div>'),or=p(`<div><div class="uno-6i8q4z"><div class="uno-j3nx8a"><p class="uno-5p4ous"> </p> <p class="uno-wsi2l8">The following chapters already exist on WeebDex with matching groups. You can mark
					them as removed to skip uploading.</p></div> <button type="button" class="uno-ftnnd4" title="Mark all duplicate chapters as removed">Removed duplicate chapters</button></div> <div class="uno-v098o1"></div></div>`);function nr(Ie,t){tt(t,!0);let n=Be(t,"class",3,"");var r=Ue(),h=We(r);{var I=l=>{var R=or(),S=s(R),L=s(S),H=s(L),X=s(H);a(H),pt(2),a(L);var q=i(L,2);q.__click=function(...Y){t.onMarkAllRemoved?.apply(this,Y)},a(S);var ae=i(S,2);He(ae,21,()=>t.duplicateChapters,Xe,(Y,A)=>{let M=()=>e(A).chapter,ne=()=>e(A).existingGroups;var B=rr(),K=s(B),ve=s(K),_e=s(ve),Se=s(_e);a(_e);var fe=i(_e,2);{var me=m=>{var j=tr();u(m,j)};x(fe,m=>{M().isDeleted&&m(me)})}a(ve);var U=i(ve,2),J=s(U);a(U),a(K);var F=i(K,2);F.__click=()=>t.onToggleRemoved(M());var re=s(F);{var ce=m=>{var j=ar();u(m,j)},w=m=>{var j=sr();u(m,j)};x(re,m=>{M().isDeleted?m(ce):m(w,!1)})}a(F),a(B),P(m=>{Oe(B,1,`uno-dtx7bh ${M().isDeleted?"uno-4fnq3q":""}`),y(Se,`Vol. ${M().chapterVolume??"N/A"??""} Ch. ${M().chapterNumber??"N/A"??""} - ${(M().chapterTitle||M().originalFolderPath||"Untitled")??""}`),y(J,`Existing groups: ${m??""}`),Oe(F,1,`uno-rt9zmx ${M().isDeleted?"uno-p6q3jv":"uno-8e0in3"}`),mt(F,"title",M().isDeleted?"Restore chapter":"Mark as removed")},[()=>ne().join(", ")]),u(Y,B)}),a(ae),a(R),P(()=>{Oe(R,1,`uno-taxi8p ${n()??""}`),y(X,`‚ö†Ô∏è Warning: ${t.duplicateChapters.length??""} duplicate chapter${t.duplicateChapters.length===1?"":"s"} detected`)}),u(l,R)};x(h,l=>{t.duplicateChapters.length>0&&l(I)})}u(Ie,r),at()}lt(["click"]);var ir=p('<span class="uno-lzl9l3 svelte-m4i47p">Removed</span>'),lr=p('<button type="button" class="uno-lj049g svelte-m4i47p" title="Edit volume and chapter" aria-label="Edit volume and chapter"><div class="uno-smkhzc svelte-m4i47p"></div></button>'),cr=p('<div class="uno-7qt2lg svelte-m4i47p"><div class="uno-m5mbjf svelte-m4i47p"></div> <span class="svelte-m4i47p">Restore</span></div>'),ur=p('<div class="uno-7qt2lg svelte-m4i47p"><div class="uno-9z7ooq svelte-m4i47p"></div> <span class="svelte-m4i47p">Remove</span></div>'),dr=p('<span class="uno-2et217 svelte-m4i47p"> </span>'),pr=p('<div class="uno-v66o3i svelte-m4i47p"><span class="uno-bwkz4u svelte-m4i47p">‚ö†Ô∏è</span> <span class="uno-bwkz4u svelte-m4i47p"> </span></div>'),vr=p('<div class="uno-5omaek svelte-m4i47p"></div>'),gr=p('<div class="uno-58lieu svelte-m4i47p">Loading combinations...</div>'),hr=p('<div class="uno-58lieu svelte-m4i47p">No volume/chapter combinations available</div>'),fr=p('<button type="button"><div class="uno-l6o6ga svelte-m4i47p"><span class="svelte-m4i47p"> </span></div></button>'),mr=p('<div class="uno-iqadiw svelte-m4i47p" role="presentation"><div class="uno-k7cjbm svelte-m4i47p"><!></div></div>'),_r=p('<div><div class="uno-rzokcw svelte-m4i47p"><div class="uno-n4d6p5 svelte-m4i47p"><span class="uno-upv063 svelte-m4i47p"> </span> <!> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Vol:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Ch:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div> <!> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Pages:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div></div> <button type="button"><!></button></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Title:</span> <div class="uno-aqzn48 svelte-m4i47p"><!> <!></div></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Groups:</span> <!></div> <div class="uno-v66o3i svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Path:</span> <span class="uno-1bjyzi svelte-m4i47p"> </span></div> <!></div> <!>',1);function br(Ie,t){tt(t,!0);const n=vt(Mt);if(!n)throw new Error("GuidedChapterEditor must be used within a component that provides TargetingState context");let r=Be(t,"chapter",7),h=Be(t,"class",3,""),I=Be(t,"hasWarning",3,!1),l=Be(t,"warningText",3,null),R=D(!1),S=D(Je([])),L=D(!1),H=D(null),X=D(null),q=D(null),ae=D(null),Y=D(null);function A(){r().isDeleted=!r().isDeleted}async function M(){if(!e(R)){e(H)&&c(ae,e(H).getBoundingClientRect(),!0),c(R,!0),c(L,!0);try{const g=r().associatedSeries?.seriesId;if(!g){console.warn("No series ID available for chapter"),c(R,!1);return}await xt.load(),c(S,await xt.getUniqueVolumeChapterCombinations(g),!0),c(Y,_e(),!0)}catch(g){console.error("Failed to load volume/chapter combinations:",g)}finally{c(L,!1)}}}function ne(){c(R,!1),c(q,null),c(ae,null),c(Y,null)}function B(g,_){const T=_?.includes("[no group]")??!1;if(_&&!T){const d=Kt.findGroupInString(g,_);if(d){const f=g.groupTitles[d.primaryName];if(f&&f.trim()!=="")return f}}if(T&&g.ungroupedTitles.length>0||g.ungroupedTitles.length>0)return g.ungroupedTitles[0];const o=Object.keys(g.groupTitles);return o.length>0?g.groupTitles[o[0]]:null}function K(g){r().manuallyEditedFields.has("volume")||(r().originalFieldValues.has("volume")||r().originalFieldValues.set("volume",r().chapterVolume),r().manuallyEditedFields.add("volume")),r().manuallyEditedFields.has("chapter")||(r().originalFieldValues.has("chapter")||r().originalFieldValues.set("chapter",r().chapterNumber),r().manuallyEditedFields.add("chapter")),r().manuallyEditedFields.has("title")||(r().originalFieldValues.has("title")||r().originalFieldValues.set("title",r().chapterTitle),r().manuallyEditedFields.add("title")),r().chapterVolume=g.volume||null,r().chapterNumber=g.chapter||null,r().chapterTitle=B(g.info,r().originalFolderPath),ne()}function ve(g){const _=g.volume||"N/A",T=g.chapter||"N/A",o=B(g.info,r().originalFolderPath),d=o?` - ${o}`:"",f=g.info.groups.length>0?` [${Ga.formatGroups(g.info.groups)}]`:"";return`Vol ${_}, Ch ${T}${d}${f}`}function _e(){if(e(S).length===0)return null;const g=r().associatedGroup.groupIds??[],_=new Map;for(const o of n.availableScanGroups)_.set(o.groupId,o.groupName);const T=g.map(o=>_.get(o)).filter(o=>o!==void 0);return Xt.findBestMatchingCombinationIndex(e(S),r().chapterVolume,r().chapterNumber,T)}function Se(){if(!e(X)||e(Y)===null)return;const g=e(Y);requestAnimationFrame(()=>{const _=e(X)?.querySelectorAll("button[data-combination-index]");_&&g!==null&&_[g]&&_[g].scrollIntoView({behavior:"auto",block:"center"})})}function fe(){if(!e(ae))return;const g=e(ae),_=window.innerHeight,T=window.innerWidth,o=4,d=256;let f=d;if(e(X)){const $=e(X).getBoundingClientRect().height;f=Math.min($,d)}const b=_-g.bottom-o,C=g.top-o,G=b<d&&C>b;let v;G?(v=g.top-f-o,v<o&&(v=o)):(v=g.bottom+o,v+f>_&&(v=Math.max(o,_-f-o)));let N=g.left;const Z=320,Re=Math.min(400,T-o*2),pe=Math.max(Z,Math.min(Re,g.width));N+pe>T-o&&(N=T-pe-o),N<o&&(N=o),c(q,{top:v,left:N,width:pe},!0)}je(()=>{if(e(R)){if(!e(ae)){c(q,null);return}requestAnimationFrame(()=>{requestAnimationFrame(()=>{fe()})});const g=()=>fe(),_=o=>{const d=o.target;e(X)&&!e(X).contains(d)&&e(H)&&!e(H).contains(d)&&ne()},T=setTimeout(()=>{window.addEventListener("resize",g),document.addEventListener("click",_,!0)},10);return()=>{clearTimeout(T),window.removeEventListener("resize",g),document.removeEventListener("click",_,!0)}}else c(q,null)}),je(()=>{e(R)&&e(X)&&requestAnimationFrame(()=>{fe()})}),je(()=>{if(e(R)&&!e(L)&&e(S).length>0&&e(Y)!==null){const g=setTimeout(()=>{Se()},100);return()=>clearTimeout(g)}});var me=_r(),U=We(me),J=s(U),F=s(J),re=s(F),ce=s(re);a(re);var w=i(re,2);{var m=g=>{var _=ir();u(g,_)};x(w,g=>{r().isDeleted&&g(m)})}var j=i(w,2),Ce=i(s(j),2),he=s(Ce,!0);a(Ce),a(j);var Pe=i(j,2),ke=i(s(Pe),2),Fe=s(ke,!0);a(ke),a(Pe);var Le=i(Pe,2);{var E=g=>{var _=lr();_.__click=T=>{T.stopPropagation(),M()},It(_,T=>c(H,T),()=>e(H)),u(g,_)};x(Le,g=>{r().associatedSeries?.seriesId&&g(E)})}var k=i(Le,2),oe=i(s(k),2),ue=s(oe,!0);a(oe),a(k),a(F);var Ee=i(F,2);Ee.__click=A;var Ne=s(Ee);{var Ae=g=>{var _=cr();u(g,_)},Ze=g=>{var _=ur();u(g,_)};x(Ne,g=>{r().isDeleted?g(Ae):g(Ze,!1)})}a(Ee),a(J);var Ke=i(J,2),z=i(s(Ke),2),te=s(z);Aa(te,{textClass:"text-sm text-app font-medium",fieldName:"title",get chapter(){return r()},get value(){return r().chapterTitle},set value(g){r().chapterTitle=g}});var we=i(te,2);{var ie=g=>{var _=dr(),T=s(_);a(_),P(()=>y(T,`(${(r().originalFolderPath||"Untitled")??""})`)),u(g,_)};x(we,g=>{r().chapterTitle||g(ie)})}a(z),a(Ke);var ge=i(Ke,2),de=i(s(ge),2);Ea(de,{fieldName:"groups",get chapter(){return r()},get groups(){return r().associatedGroup},set groups(g){r().associatedGroup=g}}),a(ge);var se=i(ge,2),be=i(s(se),2),W=s(be,!0);a(be),a(se);var V=i(se,2);{var Q=g=>{var _=vr();He(_,21,l,Xe,(T,o)=>{var d=pr(),f=i(s(d),2),b=s(f,!0);a(f),a(d),P(()=>y(b,e(o))),u(T,d)}),a(_),u(g,_)};x(V,g=>{I()&&l()&&l().length>0&&g(Q)})}a(U);var ye=i(U,2);{var Ge=g=>{var _=mr();_.__click=b=>b.stopPropagation();var T=s(_),o=s(T);{var d=b=>{var C=gr();u(b,C)},f=b=>{var C=Ue(),G=We(C);{var v=Z=>{var Re=hr();u(Z,Re)},N=Z=>{var Re=Ue(),pe=We(Re);He(pe,17,()=>e(S),Xe,($,ee,xe,De)=>{const Te=le(()=>r().chapterVolume===e(ee).volume&&r().chapterNumber===e(ee).chapter),ze=le(()=>e(Y)===xe&&!e(Te));var Me=fr();mt(Me,"data-combination-index",xe),Me.__click=()=>K(e(ee));var Ye=s(Me),Qe=s(Ye),st=s(Qe,!0);a(Qe),a(Ye),a(Me),P($e=>{Oe(Me,1,`uno-57cq3c ${e(Te)?"uno-q0nniz":e(ze)?"uno-79qo06":"uno-ut3eki"}`,"svelte-m4i47p"),y(st,$e)},[()=>ve(e(ee))]),u($,Me)}),u(Z,Re)};x(G,Z=>{e(S).length===0?Z(v):Z(N,!1)},!0)}u(b,C)};x(o,b=>{e(L)?b(d):b(f,!1)})}a(T),a(_),It(_,b=>c(X,b),()=>e(X)),P(()=>Ra(_,`top: ${e(q).top??""}px; left: ${e(q).left??""}px; width: ${e(q).width??""}px;`)),u(g,_)};x(ye,g=>{e(R)&&e(q)&&g(Ge)})}P(()=>{Oe(U,1,`uno-3rf4hu ${r().isDeleted?"uno-d3zfvr":I()?"uno-ctlglj":""} ${h()??""}`,"svelte-m4i47p"),y(ce,`#${t.index+1}`),y(he,r().chapterVolume??"N/A"),y(Fe,r().chapterNumber??"N/A"),y(ue,r().pages.length),Oe(Ee,1,`uno-lto8ne ${r().isDeleted?"uno-ld06wt":"uno-far8pd"}`,"svelte-m4i47p"),mt(Ee,"title",r().isDeleted?"Restore chapter":"Mark as removed"),y(W,r().originalFolderPath)}),u(Ie,me),at()}lt(["click"]);var yr=p('<label class="uno-bmx1o0"><input type="checkbox" class="uno-5batcv"/> <span class="uno-tbmxpn"> </span></label>'),Ir=p('<label><input type="checkbox" class="uno-5batcv"/> <span class="uno-tf1cji"> </span></label>'),wr=p('<button type="button" class="uno-hoocn8 border-app/30 hover:bg-app/5" title="Clear warning type filter">Clear filter</button>'),xr=p('<p class="uno-yid3fu"> </p>'),Sr=p('<div class="uno-jgbjl6"><div class="uno-uj5buu"><span class="uno-yid3fu">Filter by warning type:</span> <!> <!></div> <!></div>'),Cr=p('<p class="uno-mrqm4a"><!></p>'),Nr=p('<div><div class="uno-jgbjl6"><div class="uno-obx9be"><h3 class="uno-rbmvnf"> </h3> <!></div> <!></div> <div class="uno-p3sz26"><!></div></div>');function Ar(Ie,t){tt(t,!0);const n={[qe.NO_GROUPS]:"No Groups",[qe.NO_VALID_GROUPS]:"No Valid Groups",[qe.NO_CHAPTER_INFO]:"No Chapter Info",[qe.NO_MATCHING_GROUP]:"No Matching Group",[qe.VOLUME_MISMATCH]:"Volume Mismatch",[qe.PARTIAL_GROUP_MATCH]:"Partial Group Match",[qe.TITLE_RESOLUTION_NOT_FOUND]:"Title Resolution Not Found",[qe.DUPLICATE_CHAPTER]:"Duplicate Chapter"},r=Object.values(qe);let h=Be(t,"showOnlyWarnings",15,!1),I=Be(t,"class",3,""),l=D(Je(new Set));je(()=>{h()||c(l,new Set,!0)});function R(U){e(l).has(U)?e(l).delete(U):e(l).add(U),c(l,new Set(e(l)),!0)}function S(){c(l,new Set,!0)}function L(U){if(!h()&&e(l).size===0)return!0;if(h()&&e(l).size===0)return t.chapterHasWarning(U);if(e(l).size>0){const J=t.getChapterWarningReasons(U);return!J||J.length===0?!1:J.some(F=>e(l).has(F))}return!0}const H=le(()=>t.chapters.filter((U,J)=>L(J))),X=le(()=>()=>{const U=new Map;return t.chapters.forEach((J,F)=>{const re=t.getChapterWarningReasons(F);re&&re.forEach(ce=>{U.set(ce,(U.get(ce)||0)+1)})}),U});var q=Nr(),ae=s(q),Y=s(ae),A=s(Y),M=s(A);a(A);var ne=i(A,2);{var B=U=>{var J=yr(),F=s(J);ft(F);var re=i(F,2),ce=s(re);a(re),a(J),P(()=>y(ce,`Show only warnings (${t.chaptersWithWarningsCount??""})`)),Ta(F,h),u(U,J)};x(ne,U=>{t.chaptersWithWarningsCount>0&&U(B)})}a(Y);var K=i(Y,2);{var ve=U=>{var J=Sr(),F=s(J),re=i(s(F),2);He(re,17,()=>r,Xe,(Ce,he)=>{const Pe=le(()=>e(X)().get(e(he))||0);var ke=Ue(),Fe=We(ke);{var Le=E=>{var k=Ir(),oe=s(k);ft(oe),oe.__change=()=>R(e(he));var ue=i(oe,2),Ee=s(ue);a(ue),a(k),P((Ne,Ae)=>{Oe(k,1,`uno-56qn75 border-app/30 hover:bg-app/5 ${Ne??""}`),wt(oe,Ae),y(Ee,`${n[e(he)]??""} (${e(Pe)??""})`)},[()=>e(l).has(e(he))?"bg-primary/20 border-primary":"",()=>e(l).has(e(he))]),u(E,k)};x(Fe,E=>{e(Pe)>0&&E(Le)})}u(Ce,ke)});var ce=i(re,2);{var w=Ce=>{var he=wr();he.__click=S,u(Ce,he)};x(ce,Ce=>{e(l).size>0&&Ce(w)})}a(F);var m=i(F,2);{var j=Ce=>{var he=xr(),Pe=s(he);a(he),P(ke=>y(Pe,`Showing ${e(H).length??""} chapter${e(H).length===1?"":"s"} with:
						${ke??""}`),[()=>Array.from(e(l)).map(ke=>n[ke]).join(", ")]),u(Ce,he)};x(m,Ce=>{e(l).size>0&&Ce(j)})}a(J),u(U,J)};x(K,U=>{h()&&t.chaptersWithWarningsCount>0&&U(ve)})}a(ae);var _e=i(ae,2),Se=s(_e);{var fe=U=>{var J=Cr(),F=s(J);{var re=w=>{var m=zt("No chapters with selected warning types to display");u(w,m)},ce=w=>{var m=zt("No chapters with warnings to display");u(w,m)};x(F,w=>{e(l).size>0?w(re):w(ce,!1)})}a(J),u(U,J)},me=U=>{var J=Ue(),F=We(J);He(F,17,()=>e(H),Xe,(re,ce)=>{const w=le(()=>t.chapters.indexOf(e(ce)));{let m=le(()=>t.chapterHasWarning(e(w))),j=le(()=>t.getChapterWarningText(e(w)));br(re,{get index(){return e(w)},get chapter(){return e(ce)},get hasWarning(){return e(m)},get warningText(){return e(j)}})}}),u(U,J)};x(Se,U=>{e(H).length===0&&(h()||e(l).size>0)?U(fe):U(me,!1)})}a(_e),a(q),P(()=>{Oe(q,1,`uno-jgbjl6 ${I()??""}`),y(M,`Detected Chapters (${t.chapters.length??""})`)}),u(Ie,q),at()}lt(["change","click"]);var Er=p('<p class="uno-8520et"> </p>'),Rr=p('<div class="uno-vsugad"><div class="uno-pj4440"></div> <p class="uno-hw2z5w"> </p> <!></div>'),Gr=p(`<div class="uno-hemz07"><div class="uno-ns83sq"><p class="uno-0zsd1s"> </p></div> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Series Selection (Required)</h3> <!> <!> <!></div> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Group Selection</h3> <p class="uno-hw2z5w">Groups are automatically loaded from the chapter dump. You can manually add additional
					groups here if needed.</p> <!> <!></div> <!> <!> <!> <!> <!> <button type="button" class="uno-d93lfx"> </button></div>`),Tr=p('<div class="uno-6nb6x4"><p class="uno-dillda">‚úì Upload completed successfully!</p></div>'),Dr=p('<div><h2 class="uno-67n1yz"> </h2> <!></div>');function Pr(Ie,t){tt(t,!0),pa({useWebWorkers:!1});let n=Be(t,"class",3,"");const r=new Da;yt(Mt,r);const h=vt(Jt);if(!h)throw new Error("MangaProcessor must be used within a component that provides ApiAuthContext");const I=vt(Lt);let l=D(Je(O.LOADING)),R=D(null),S=D(Je([])),L=D(!1),H=D(null),X=D(null),q=D(null),ae=D(!1),Y=D(Je([])),A=D(Je(new rt)),M=D(!1);const ne=["jpg","jpeg","png","gif","webp","cbz","zip","xml"],B={DUPLICATE_CHAPTER:o=>`Duplicate chapter: A chapter with the same volume and chapter number already exists with groups: ${o.length>0?o.join(", "):"Unknown groups"}`},K={[O.LOADING]:"Loading manga folder...",[O.EXTRACTING]:"Extracting zip files...",[O.SERIES_LOOKUP]:"Looking up series ID...",[O.APPLYING_REGEX]:"Applying regex patterns...",[O.CHAPTER_LOOKUP]:"Loading chapter dump...",[O.LOADING_GROUPS]:"Loading groups...",[O.APPLYING_GROUPS]:"Applying groups to chapters...",[O.APPLYING_TITLES]:"Applying changes from dump...",[O.READY]:"",[O.READY_WARNING]:"",[O.UPLOADING]:"",[O.COMPLETED]:""},ve=o=>Za.isNoGroupPath(o.originalFolderPath);je(()=>{t.zipFile&&(c(q,null),c(ae,!1),c(Y,[],!0),c(A,new rt,!0),_e())});async function _e(){try{if(await me(),await U(),!r.seriesId){c(l,O.READY_WARNING,!0);return}c(l,O.APPLYING_REGEX,!0),await J(),await F(),await re(),await ce(),await Ce(),Ae()?c(l,O.READY_WARNING,!0):c(l,O.READY,!0)}catch(o){console.error("Error in processing pipeline:",o),t.guidedState.setZipStatus(t.zipFile,Ve.ERROR),c(l,O.READY_WARNING,!0),t.onProcessingComplete("error")}}async function Se(o){const d=o.name.split(".").pop()?.toLowerCase();if(!(d==="cbz")&&!(d==="zip"))throw new Error(`Unsupported archive format: ${d}`);console.log(`Extracting ${d} file:`,o.name);const C=new va(new ga(o)),G=await C.getEntries(),v=[],N=o.name.replace(/\.(cbz|zip)$/i,""),Z=o.webkitRelativePath||o.name,Re=G.filter(ee=>{if(!ee.filename||ee.directory)return!1;const xe=ee.filename.split(".").pop()?.toLowerCase();return xe&&ne.includes(xe)}),pe=Re.length;let $=0;for(const ee of Re){$++;const xe=ee.filename,De=xe.split("/").pop()??xe;c(H,`${xe} (${$} / ${pe})`);const Te=xe.split(".").pop()?.toLowerCase()??"";if(ee.directory)continue;const ze=new TransformStream,Me=new Response(ze.readable).blob();await ee.getData(ze.writable);let Ye=await Me;if(!Ye.type){const $e=fe(Te);Ye=new Blob([Ye],{type:$e})}const Qe=Z.includes("/")?`${Z.split("/").slice(0,-1).join("/")}/${N}/${xe}`:`${N}/${xe}`,st=new File([Ye],De,{type:Ye.type});Object.defineProperty(st,"webkitRelativePath",{value:Qe,writable:!1,enumerable:!0,configurable:!0}),v.push(st)}return await C.close(),c(H,null),v}function fe(o){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp"}[o]||"application/octet-stream"}async function me(){c(l,O.LOADING,!0),r.reset(),c(l,O.EXTRACTING,!0);let o=[];try{o=await Se(t.zipFile)}catch(f){throw console.error(`Error extracting ${t.zipFile.name}:`,f),f}c(R,Pa(o),!0);const d=as(e(R));c(S,await Promise.all(d.map(async f=>{const b=ss(f.name),C=rs(f.name),G=f.files.filter(v=>v.type===Fa.CHAPTER_PAGE).map((v,N)=>new ka(v.file.name,N,v.file,La.NOT_STARTED,0,null,null,!1,v.type));return new Ma(f.path,null,b,C,new Zt,new Wa,G,Gt.NOT_STARTED,0,null,null,f,!1,"en")})),!0),e(S).sort((f,b)=>{if(f.chapterVolume&&b.chapterVolume){const C=String(f.chapterVolume).localeCompare(String(b.chapterVolume),void 0,{numeric:!0,sensitivity:"base"});if(C!==0)return C}else{if(f.chapterVolume)return-1;if(b.chapterVolume)return 1}return f.chapterNumber&&b.chapterNumber?String(f.chapterNumber).localeCompare(String(b.chapterNumber),void 0,{numeric:!0,sensitivity:"base"}):f.chapterNumber?-1:b.chapterNumber?1:0}),r.chapterStates=e(S)}async function U(){c(l,O.SERIES_LOOKUP,!0);const o=kt(t.zipFile.name);if(o)try{await ut.load();const d=await ut.getWeebdexIdFromLegacyId(o);d?(r.seriesId=d,console.log(`Auto-detected series ID from MD-####: ${o} -> ${d}`)):console.log(`No WeebDex ID found for MangaDex ID: ${o}`)}catch(d){console.warn(`Failed to lookup WeebDex ID for MangaDex ID ${o}:`,d)}r.seriesId&&r.chapterStates.forEach(d=>{d.associatedSeries||(d.associatedSeries=new Zt),d.associatedSeries.seriesId=r.seriesId??""})}async function J(){c(l,O.CHAPTER_LOOKUP,!0),r.seriesId&&await xt.load()}async function F(){if(c(l,O.LOADING_GROUPS,!0),!r.seriesId)return;if(!await xt.hasSeriesEntries(r.seriesId)){console.warn("No entries found in chapter dump for this series"),c(ae,!0);return}const d=await Kt.getSeriesGroups(r.seriesId);if(d.length===0){console.log("No groups found in chapter dump, but series has entries (likely all ungrouped)"),r.availableScanGroups=[];return}const f=[],b=[];for(const C of d)try{const G=await Oa(C.primaryName);if(G.data){const v=G.data.find(N=>Xt.groupMatches(C,N.name));if(v){const N=new za;N.groupId=v.id,N.groupName=v.name,f.push(N)}else b.push(C.primaryName)}else b.push(C.primaryName)}catch(G){console.warn(`Failed to lookup group "${C.primaryName}":`,G),b.push(C.primaryName)}c(Y,b,!0),b.length>0&&c(ae,!0),r.availableScanGroups=f}async function re(){c(l,O.APPLYING_GROUPS,!0),await m()}async function ce(){if(c(l,O.APPLYING_TITLES,!0),!r.seriesId)return;await j()>0&&c(ae,!0)}je(()=>{r.seriesId&&(e(l)===O.READY||e(l)===O.READY_WARNING)&&r.seriesId!==e(q)&&(c(q,r.seriesId,!0),w())});async function w(){try{if(await U(),!r.seriesId)return;c(l,O.APPLYING_REGEX,!0),await J(),await F(),await re(),await ce(),await Ce(),Ae()?c(l,O.READY_WARNING,!0):c(l,O.READY,!0)}catch(o){console.error("Error in processing pipeline:",o),c(l,O.READY_WARNING,!0)}}async function m(){r.seriesId&&await Vt.applyGroupsToChapters(r.chapterStates,r.availableScanGroups,r.seriesId)}async function j(){if(!r.seriesId)return 0;const o=r.seriesId,d=new Map,f=new Map;for(let v=0;v<r.chapterStates.length;v++){const N=r.chapterStates[v];d.set(v,N),f.set(v,N.chapterVolume)}const b=r.chapterStates.map(v=>{const N=v.chapterTitle===void 0||v.chapterTitle===null||v.chapterTitle===""?null:v.chapterTitle;return{chapterVolume:v.chapterVolume,chapterNumber:v.chapterNumber,originalFolderPath:v.originalFolderPath,groupIds:v.associatedGroup.groupIds??[],currentTitle:N}}),C=new Map;for(let v=0;v<b.length;v++)C.set(b[v],v);const G=await Vt.applyChangesFromDump(b,r.availableScanGroups,o,{useFallbackMatching:!0,isNoGroupChapter:v=>{const N=C.get(v);if(N===void 0)return!1;const Z=d.get(N);return Z?ve(Z):!1}});for(let v=0;v<G.results.length;v++){const N=G.results[v],Z=d.get(v);if(!Z)continue;const pe=(e(A).get(v)??[]).filter(ee=>ee.reason===qe.DUPLICATE_CHAPTER);if((N.status===qt.SUCCESS||N.status===qt.NO_CHANGES)&&N.changes){const{volume:ee,title:xe,additionalGroupIds:De}=N.changes;if(ee!==void 0){const Te=f.get(v)??Z.chapterVolume;Z.chapterVolume=ee,N.resolutionResult?.usedFallback&&(Z.manuallyEditedFields.has("volume")||(Z.originalFieldValues.has("volume")||Z.originalFieldValues.set("volume",Te),Z.manuallyEditedFields.add("volume")))}if(xe!==void 0&&(Z.chapterTitle=xe),De.length>0){const Te=new Ht(Z.associatedGroup.groupIds??[]);for(const ze of De)Te.add(ze);Z.associatedGroup.groupIds=Array.from(Te)}}const $=[...pe,...N.warnings];$.length>0?e(A).set(v,$):e(A).delete(v)}return G.failedCount}async function Ce(){if(r.seriesId)try{const o=await Ua(r.seriesId),d=new Map;for(const G of o.chapters){const v=G.volume||"none",N=G.chapter||"none",Z=`${v}:${N}`;d.set(Z,G)}const f=G=>{if(!o.groups)return!1;for(const v of G){const N=o.groups[v];if(N&&N.name==="No Group"&&!N.id)return!0}return!1},b=G=>{const v=new Set;if(o.groups)for(const N of G){const Z=o.groups[N];Z&&Z.id&&v.add(Z.id)}return v},C=(G,v,N)=>{if(G.size===0)return N&&v.size===0;if(N)return!1;for(const Z of G)if(v.has(Z))return!0;return!1};for(let G=0;G<r.chapterStates.length;G++){const v=r.chapterStates[G],N=v.chapterVolume||"none",Z=v.chapterNumber||"none",Re=`${N}:${Z}`,pe=d.get(Re),ee=(e(A).get(G)??[]).filter(xe=>xe.reason!==qe.DUPLICATE_CHAPTER);if(pe&&pe.entries&&Object.keys(pe.entries).length>0){const xe=new Set(v.associatedGroup.groupIds??[]);let De=null;for(const Te of Object.values(pe.entries)){const ze=b(Te.groups),Me=f(Te.groups);if(C(xe,ze,Me)){De=Te;break}}if(De){const Te=b(De.groups),ze=f(De.groups),Me=[];ze&&Me.push("No Group");for(const Ye of Te){const Qe=o.groups?.find(st=>st.id===Ye);Qe?Me.push(`${Qe.name} (${Qe.id})`):Me.push(`Unknown Group (${Ye})`)}ee.push({reason:qe.DUPLICATE_CHAPTER,note:B.DUPLICATE_CHAPTER(Me.length>0?Me:["Unknown groups"])})}}ee.length>0?e(A).set(G,ee):e(A).delete(G)}}catch(o){console.error("Error checking for duplicates:",o)}}function he(o){if(e(l)!==O.UPLOADING)return;c(l,O.COMPLETED,!0);const d=o?"success":"error";t.guidedState.setZipStatus(t.zipFile,o?Ve.COMPLETED:Ve.ERROR),o&&r.seriesId?t.onProcessingComplete(d,r.seriesId):t.onProcessingComplete(d)}function Pe(o){const d=o.note.match(/groups: (.+)$/);return d?d[1].split(", ").filter(f=>f!=="Unknown groups"):[]}function ke(o){const d=o.note.match(/Matched "(.+?)" but release has \d+ groups: (.+)$/);return d?{matchedGroup:d[1],allGroups:d[2].split(", ")}:null}const Fe=le(()=>e(S).map((o,d)=>{const b=(e(A).get(d)??[]).find(C=>C.note.includes("Duplicate chapter:"));return b?{chapter:o,existingGroups:Pe(b)}:null}).filter(o=>o!==null)),Le=le(()=>e(S).map((o,d)=>{const b=(e(A).get(d)??[]).find(C=>C.reason===qe.PARTIAL_GROUP_MATCH);if(b){const C=ke(b);if(C)return{chapter:o,matchedGroup:C.matchedGroup,allGroups:C.allGroups}}return null}).filter(o=>o!==null)),E=le(()=>Array.from(e(A).values()).filter(o=>o.some(d=>d.reason===qe.TITLE_RESOLUTION_NOT_FOUND)).length),k=le(()=>Array.from(e(A).values()).filter(o=>o.some(d=>d.reason===qe.NO_GROUPS)).length),oe=le(()=>Array.from(e(A).values()).filter(o=>o.some(d=>d.reason===qe.NO_VALID_GROUPS)).length),ue=le(()=>Array.from(e(A).values()).filter(o=>o.some(d=>d.reason===qe.NO_CHAPTER_INFO)).length),Ee=le(()=>Array.from(e(A).values()).filter(o=>o.some(d=>d.reason===qe.VOLUME_MISMATCH)).length);function Ne(){const o=e(E)>0||e(Y).length>0;e(ae)!==o&&c(ae,o,!0)}function Ae(){let o=!1;for(const[d,f]of e(A))if(f.length>0){o=!0;break}return o||e(Fe).length>0||e(ae)||e(Y).length>0||e(E)>0||e(Le).length>0}function Ze(o){return e(A).has(o)&&(e(A).get(o)?.length??0)>0}async function Ke(){r.seriesId&&(await m(),await j(),await Ce())}function z(o){const d=e(A).get(o);return!d||d.length===0?null:d.map(f=>f.note)}function te(o){const d=e(A).get(o);return!d||d.length===0?null:d.map(f=>f.reason)}function we(){return{hasDuplicates:e(Fe).length>0,duplicateCount:e(Fe).length,dumpLookupFailed:e(ae),failedGroups:e(Y).length,failedTitles:e(E),partialGroupMatches:e(Le).length}}function ie(){return e(l)===O.READY&&(e(q)===r.seriesId||!r.seriesId)}je(()=>{if(!I?.isActive)return;const d=e(l),f=r.seriesId,b=e(q),C=d===O.READY||d===O.READY_WARNING;if(!C)return;console.log("Automation: Effect triggered, checking state",{step:d,seriesId:f,lastSeriesId:b,shouldCheck:C});const G=setTimeout(()=>{ge()},500);return()=>clearTimeout(G)});async function ge(){if(!I?.isActive){console.log("Automation: Not active");return}if(e(l)===O.READY_WARNING){console.log("Automation: READY_WARNING state detected, marking as warning and skipping"),t.guidedState.setZipStatus(t.zipFile,Ve.WARNING),t.onProcessingComplete("warning");return}if(!ie()){console.log("Automation: Not ready",{step:e(l),seriesId:r.seriesId,lastProcessedSeriesId:e(q)});return}console.log("Automation: Checking zip file",t.zipFile.name);const o=t.guidedState.pendingZips,d=t.guidedState.warningZips.length>0||t.guidedState.errorZips.length>0;if(o.length===0&&d){console.log("Automation: Disabling - only warnings/errors remain"),I.disable();return}console.log("Automation: No issues, starting upload",{canStartUpload:e(se),hasSeriesId:!!r.seriesId,nonDeletedChapters:e(be).length}),e(se)&&r.seriesId&&e(be).length>0?de()?console.log("Automation: Upload started successfully"):(console.warn("Automation: Failed to start upload, marking as error"),t.guidedState.setZipStatus(t.zipFile,Ve.ERROR),t.onProcessingComplete("error")):(console.warn("Automation: Missing requirements for upload",{canStartUpload:e(se),hasSeriesId:!!r.seriesId,nonDeletedChapters:e(be).length}),t.guidedState.setZipStatus(t.zipFile,Ve.WARNING),t.onProcessingComplete("warning"))}function de(){return h.apiToken?r.seriesId?r.chapterStates.length===0?(alert("No chapters to upload"),!1):!e(se)||e(be).length===0?!1:(c(l,O.UPLOADING,!0),t.guidedState.setZipStatus(t.zipFile,Ve.PROCESSING),!0):(alert("Please set a series ID first"),!1):(alert("Please set up API authentication first"),!1)}je(()=>{if(e(l)===O.UPLOADING&&I?.isActive&&e(X)){const o=setTimeout(()=>{console.log("Automation: Triggering upload via UploaderOrchestrator"),e(X)?.startUpload()},200);return()=>clearTimeout(o)}});const se=le(()=>e(l)===O.READY||e(l)===O.READY_WARNING),be=le(()=>e(S).filter(o=>!o.isDeleted)),W=le(()=>Array.from(e(A).values()).filter(o=>o.length>0).length);je(()=>{if(e(l)===O.UPLOADING&&e(X)){const o=e(X).getUploaderStatus();if(o===Ut.PAUSED){console.log("MangaProcessor: Detected PAUSED status, stopping automation"),I?.isActive&&I.disable(),t.guidedState.setZipStatus(t.zipFile,Ve.ERROR),he(!1);return}if(o===Ut.STOPPED){console.log("MangaProcessor: Detected STOPPED status, stopping automation"),I?.isActive&&I.disable(),t.guidedState.setZipStatus(t.zipFile,Ve.ERROR),he(!1);return}}}),je(()=>{if(e(l)===O.UPLOADING&&e(S).length>0){const o=e(S).every(f=>f.status===Gt.COMPLETED||f.isDeleted),d=e(S).some(f=>!f.isDeleted);if(o&&d){const b=!e(S).some(C=>!C.isDeleted&&C.status===Gt.FAILED);t.guidedState.setZipStatus(t.zipFile,b?Ve.COMPLETED:Ve.ERROR),he(b)}}}),je(()=>{const o=e(l);if(!(o!==O.READY&&o!==O.READY_WARNING)){e(A).size,e(Fe).length,e(Y).length,e(Le).length,e(E);for(const[d,f]of e(A)){f.length;for(const b of f);}Ne(),Ae()?c(l,O.READY_WARNING,!0):c(l,O.READY,!0)}});var V={hasIssues:Ae,chapterHasWarning:Ze,getChapterWarningText:z,getChapterWarningReasons:te,getIssueDetails:we,isReady:ie,startUpload:de},Q=Dr(),ye=s(Q),Ge=s(ye);a(ye);var g=i(ye,2);{var _=o=>{var d=Rr(),f=i(s(d),2),b=s(f,!0);a(f);var C=i(f,2);{var G=v=>{var N=Er(),Z=s(N);a(N),P(()=>y(Z,`Processing: ${e(H)??""}`)),u(v,N)};x(C,v=>{e(H)&&v(G)})}a(d),P(()=>y(b,K[e(l)])),u(o,d)},T=o=>{var d=Ue(),f=We(d);{var b=G=>{var v=Gr(),N=s(v),Z=s(N),Re=s(Z);a(Z),a(N);var pe=i(N,2),$=i(s(pe),2);Va($,{});var ee=i($,2);ha(ee,{});var xe=i(ee,2);qa(xe,{}),a(pe);var De=i(pe,2),Te=i(s(De),4);fa(Te,{});var ze=i(Te,2);ma(ze,{}),a(De);var Me=i(De,2);Ws(Me,{get chapters(){return e(S)},onGroupAssigned:Ke});var Ye=i(Me,2);{let et=le(()=>!!r.seriesId);Js(Ye,{get processingStep(){return e(l)},get hasSeriesId(){return e(et)},get duplicateCount(){return e(Fe).length},get dumpLookupFailed(){return e(ae)},get dumpLookupFailedGroups(){return e(Y)},get dumpLookupFailedTitles(){return e(E)},get partialGroupMatchesCount(){return e(Le).length},get chaptersWithNoGroups(){return e(k)},get chaptersWithNoValidGroups(){return e(oe)},get chaptersWithNoChapterInfo(){return e(ue)},get chaptersWithVolumeMismatch(){return e(Ee)}})}var Qe=i(Ye,2);er(Qe,{get partialGroupMatches(){return e(Le)}});var st=i(Qe,2);nr(st,{get duplicateChapters(){return e(Fe)},onMarkAllRemoved:()=>{for(const{chapter:et}of e(Fe))et.isDeleted=!0},onToggleRemoved:et=>{et.isDeleted=!et.isDeleted}});var $e=i(st,2);Ar($e,{get chapters(){return e(S)},get chaptersWithWarningsCount(){return e(W)},chapterHasWarning:Ze,getChapterWarningText:z,getChapterWarningReasons:te,get showOnlyWarnings(){return e(M)},set showOnlyWarnings(et){c(M,et,!0)}});var ot=i($e,2);ot.__click=de;var _t=s(ot);a(ot),a(v),P(()=>{y(Re,`Found ${e(S).length??""} chapter${e(S).length===1?"":"s"} from deepest folders`),ot.disabled=!e(se)||!r.seriesId||e(be).length===0,y(_t,`Start Upload (${e(be).length??""} of ${e(S).length??""} chapters)`)}),u(G,v)},C=G=>{var v=Ue(),N=We(v);{var Z=pe=>{It(_a(pe,{onDone:he,get busy(){return e(L)},set busy($){c(L,$,!0)}}),$=>c(X,$,!0),()=>e(X))},Re=pe=>{var $=Ue(),ee=We($);{var xe=De=>{var Te=Tr();u(De,Te)};x(ee,De=>{e(l)===O.COMPLETED&&De(xe)},!0)}u(pe,$)};x(N,pe=>{e(l)===O.UPLOADING?pe(Z):pe(Re,!1)},!0)}u(G,v)};x(f,G=>{e(l)===O.READY||e(l)===O.READY_WARNING?G(b):G(C,!1)},!0)}u(o,d)};x(g,o=>{e(l)===O.LOADING||e(l)===O.EXTRACTING||e(l)===O.SERIES_LOOKUP||e(l)===O.APPLYING_REGEX||e(l)===O.CHAPTER_LOOKUP||e(l)===O.LOADING_GROUPS||e(l)===O.APPLYING_GROUPS||e(l)===O.APPLYING_TITLES?o(_):o(T,!1)})}return a(Q),P(()=>{Oe(Q,1,`uno-hemz07 ${n()??""}`),y(Ge,`Processing: ${t.zipFile.name??""}`)}),u(Ie,Q),at(V)}lt(["click"]);var Fr=p('<span class="uno-eibvyk"></span>'),kr=p('<span class="uno-wwd276"></span>'),Lr=p('<div class="uno-ym9lva"><div class="uno-oiviaa">Will fetch from:</div> <div class="uno-ftiv42"> </div></div>'),Mr=p('<div class="uno-r9mqt0"> </div>'),Wr=p('<div class="uno-ap0fh2"> </div>'),Or=p(`<div class="uno-pevota"><label for="sheet-url" class="uno-q52u3c">Restored IDs Sheet URL:</label> <p class="uno-ap0fh2">Paste a Google Sheets URL here. It will be automatically converted to CSV format for
						loading. The sheet must be publicly accessible or shared with "Anyone with the link".</p> <input id="sheet-url" type="text" placeholder="https://docs.google.com/spreadsheets/d/.../edit#gid=0" class="uno-3eiegh"/> <!> <div class="uno-w2kq3w"><button type="button" class="uno-qr8ujc"> </button> <button type="button" class="uno-m5t56d">Cancel</button></div> <!> <!></div>`),zr=p("<option> </option>"),Ur=p('<button type="button" class="uno-77n21i" title="Delete selected session">Delete Session</button>'),Zr=p('<div class="uno-4n7jiu"><div class="uno-s1ovsw"><div class="uno-xbq30h"><label for="session-selector" class="uno-q52u3c">Select Session:</label> <select id="session-selector" class="uno-ggu5iv"><option>-- Select a session --</option><!></select></div> <!></div></div>'),Vr=p('<div class="uno-4n7jiu"><div class="uno-kjj903"><button type="button" class="uno-m5t56d" title="Copy CSV to clipboard">Copy CSV</button></div> <textarea readonly="" class="uno-afv8at"></textarea></div>'),qr=p('<div class="uno-q4g9cd">Loading restored status...</div>'),jr=p('<div class="uno-9rtpct"> </div>'),Br=p('<span class="uno-5c220y" title="Marked as restored in spreadsheet">Restored</span>'),Yr=p('<span class="uno-p0fdl0" title="In spreadsheet but not marked as restored">In Sheet</span>'),Hr=p('<span class="uno-r3s6qi" title="Not yet in spreadsheet">Local Only</span>'),Xr=p('<div class="uno-jq88zy"><div class="uno-3f1aqr"> </div> <!> <!></div>'),Kr=p('<div class="uno-18xidu"> </div>'),Jr=p('<div class="uno-ky3e2b"><div class="uno-twa61r"><!></div></div>'),Qr=p('<div class="uno-4n7jiu"><div class="uno-y8jeae"><p class="uno-q52u3c"> </p> <div class="uno-w2kq3w"><button type="button" class="uno-m5t56d" title="Copy all IDs to clipboard">Copy IDs</button> <button type="button" class="uno-m5t56d" title="Show CSV format (includes weebdex ID and legacy ID)"> </button></div></div> <!></div>'),$r=p('<p class="uno-q4g9cd">Please select a session to view IDs</p>'),eo=p('<p class="uno-q4g9cd">No completed IDs found</p>'),to=p('<span class="uno-q4g9cd"> </span>'),ao=p('<div class="uno-pevota"><label for="import-text" class="uno-q52u3c">Paste legacy IDs (one per line, or CSV format):</label> <textarea id="import-text" placeholder="12345 67890 or CSV: legacy_id 12345,67890" class="uno-afv8at"></textarea> <div class="uno-pnwugo"><button type="button" class="uno-qr8ujc"> </button> <!></div></div>'),so=p('<div class="uno-4n7jiu"><button type="button" class="uno-6bd4j8"> </button> <!></div> <div class="uno-pnwugo"><label for="view-mode" class="uno-q4g9cd">View Mode:</label> <button type="button">Per Session</button> <button type="button">All Combined</button></div> <!> <!> <div class="uno-4n7jiu"><button type="button" class="uno-6bd4j8"> </button> <!></div> <div class="uno-w2kq3w"><button type="button" class="uno-m5t56d">Refresh</button> <button type="button" class="uno-ecwkht">Clear All</button></div>',1),ro=p('<div class="uno-5pp2az"><button type="button" class="uno-vyqybb"><span class="uno-hus6d6"><!></span> <h3 class="uno-mg3nnt">Completed WeebDex IDs</h3></button> <!></div>');function oo(Ie,t){tt(t,!0);let n=D("per-session"),r=D(null),h=D(!1),I=D(!1),l=D(!1),R=D(""),S=D(!1),L=D(null),H=D(Je([])),X=D(!1),q=D(!1),ae=D(""),Y=D(!1);const A=vt(Wt),M=le(()=>A.sessions),ne=le(()=>A.allCombinedIds),B=Qt;je(()=>{e(q)&&c(ae,B.sheetUrl,!0)}),je(()=>{const E=Se();if(E.length===0){c(H,[],!0);return}c(X,!0),Promise.all(E.map(async k=>{const oe=k.weebdexId?await B.isRestoredByWeebdexId(k.weebdexId):k.legacyId?await B.isRestoredByLegacyId(k.legacyId):!1,ue=k.weebdexId?await B.existsInSpreadsheet(k.weebdexId):k.legacyId?await B.existsInSpreadsheetByLegacyId(k.legacyId):!1;return{entry:k,isRestored:oe,inSpreadsheet:ue}})).then(k=>{c(H,k,!0),c(X,!1)})});function K(E){if(E.startsWith("imported-")){const k=E.replace("imported-",""),oe=Number.parseInt(k,10);if(!Number.isNaN(oe))try{return`Imported: ${new Date(oe).toLocaleString()}`}catch{return E}return E}try{return new Date(E).toLocaleString()}catch{return E}}function ve(E){typeof navigator>"u"||!navigator.clipboard||navigator.clipboard.writeText(E).catch(k=>{console.error("Failed to copy to clipboard:",k)})}function _e(){return e(n)==="all-combined"?e(ne):e(r)?A.getSessionIds(e(r)):[]}function Se(){if(e(n)==="all-combined"){const E=new Map;for(const k of e(M))for(const oe of k.ids)E.has(oe.weebdexId)||E.set(oe.weebdexId,oe);return Array.from(E.values()).sort((k,oe)=>k.weebdexId.localeCompare(oe.weebdexId))}else if(e(r)){const E=e(M).find(k=>k.timestamp===e(r));return E?[...E.ids]:[]}return[]}function fe(){const E=Se(),k=["weebdex_id","legacy_id"],oe=E.map(Ne=>[Ne.weebdexId,Ne.legacyId||""]);function ue(Ne){return Ne.includes(",")||Ne.includes('"')||Ne.includes(`
`)?`"${Ne.replace(/"/g,'""')}"`:Ne}return[k.map(ue).join(","),...oe.map(Ne=>Ne.map(ue).join(","))].join(`
`)}function me(){c(I,!e(I))}function U(){const E=fe();ve(E)}function J(E){const k=E.split(`
`),oe=[];for(const ue of k)if(ue.includes(",")){const Ee=ue.split(",");for(const Ne of Ee){const Ae=Ne.trim();Ae&&Ae.toLowerCase()!=="legacy_id"&&Ae.toLowerCase()!=="weebdex_id"&&oe.push(Ae)}}else{const Ee=ue.trim();Ee&&oe.push(Ee)}return oe.filter(ue=>ue.length>0)}async function F(){if(e(R).trim()){c(S,!0),c(L,null);try{const E=J(e(R));if(E.length===0){c(L,{imported:0,failed:0},!0),c(S,!1);return}const k=await A.importLegacyIds(E);if(c(L,k,!0),k.imported>0){c(R,""),c(n,"per-session");const oe=A.sessions.find(ue=>ue.timestamp.startsWith("imported-"));oe&&c(r,oe.timestamp,!0)}}catch(E){console.error("Import failed:",E),c(L,{imported:0,failed:J(e(R)).length},!0)}finally{c(S,!1)}}}function re(){if(e(n)==="all-combined")return`All Combined IDs (${e(ne).length} unique)`;if(e(r)){const E=e(M).find(k=>k.timestamp===e(r));return E?`${K(e(r))} (${E.ids.length} IDs)`:"No session selected"}return"Select a session"}async function ce(){c(Y,!0);try{B.setSheetUrl(e(ae)),await B.reload(),c(q,!1)}catch(E){console.error("Failed to load sheet:",E)}finally{c(Y,!1)}}function w(E){if(!E.trim())return null;const k=/https:\/\/docs\.google\.com\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/,oe=E.match(k);if(!oe)return null;const ue=oe[1],Ee=E.match(/[#&]gid=(\d+)/),Ne=Ee?Ee[1]:"0";return`https://docs.google.com/spreadsheets/d/${ue}/export?format=csv&gid=${Ne}`}var m=ro(),j=s(m);j.__click=()=>{c(h,!e(h))};var Ce=s(j),he=s(Ce);{var Pe=E=>{var k=Fr();u(E,k)},ke=E=>{var k=kr();u(E,k)};x(he,E=>{e(h)?E(Pe):E(ke,!1)})}a(Ce),pt(2),a(j);var Fe=i(j,2);{var Le=E=>{var k=so(),oe=We(k),ue=s(oe);ue.__click=()=>{c(q,!e(q))};var Ee=s(ue,!0);a(ue);var Ne=i(ue,2);{var Ae=_=>{var T=Or(),o=i(s(T),4);ft(o);var d=i(o,2);{var f=$=>{var ee=Lr(),xe=i(s(ee),2),De=s(xe,!0);a(xe),a(ee),P(Te=>y(De,Te),[()=>w(e(ae))]),u($,ee)};x(d,$=>{w(e(ae))&&$(f)})}var b=i(d,2),C=s(b);C.__click=ce;var G=s(C,!0);a(C);var v=i(C,2);v.__click=()=>{c(q,!1)},a(b);var N=i(b,2);{var Z=$=>{var ee=Mr(),xe=s(ee);a(ee),P(()=>y(xe,`Error: ${B.loadError.message??""}`)),u($,ee)};x(N,$=>{B.loadError&&$(Z)})}var Re=i(N,2);{var pe=$=>{var ee=Wr(),xe=s(ee);a(ee),P(()=>y(xe,`Current URL: ${B.sheetUrl??""}`)),u($,ee)};x(Re,$=>{B.sheetUrl&&$(pe)})}a(T),P(()=>{o.disabled=e(Y),C.disabled=e(Y),y(G,e(Y)?"Loading...":"Save & Load Sheet"),v.disabled=e(Y)}),Ft(o,()=>e(ae),$=>c(ae,$)),u(_,T)};x(Ne,_=>{e(q)&&_(Ae)})}a(oe);var Ze=i(oe,2),Ke=i(s(Ze),2);Ke.__click=()=>{c(n,"per-session"),c(r,null)};var z=i(Ke,2);z.__click=()=>{c(n,"all-combined"),c(r,null)},a(Ze);var te=i(Ze,2);{var we=_=>{var T=Zr(),o=s(T),d=s(o),f=i(s(d),2);f.__change=N=>{c(r,N.target.value||null,!0)};var b=s(f);b.value=b.__value="";var C=i(b);He(C,17,()=>e(M),Xe,(N,Z)=>{var Re=zr(),pe=s(Re);a(Re);var $={};P(ee=>{y(pe,`${ee??""} (${e(Z).ids.length??""} IDs)`),$!==($=e(Z).timestamp)&&(Re.value=(Re.__value=e(Z).timestamp)??"")},[()=>K(e(Z).timestamp)]),u(N,Re)}),a(f),a(d);var G=i(d,2);{var v=N=>{var Z=Ur();Z.__click=()=>{if(!e(r))return;const Re=e(M).find($=>$.timestamp===e(r)),pe=Re?K(e(r)):"this session";confirm(`Are you sure you want to delete ${pe}? This will remove ${Re?.ids.length||0} ID(s). This cannot be undone.`)&&(A.deleteSession(e(r)),c(r,null))},u(N,Z)};x(G,N=>{e(r)&&N(v)})}a(o),a(T),u(_,T)};x(te,_=>{e(n)==="per-session"&&_(we)})}var ie=i(te,2);{var ge=_=>{var T=Qr(),o=s(T),d=s(o),f=s(d,!0);a(d);var b=i(d,2),C=s(b);C.__click=()=>ve(_e().join(`
`));var G=i(C,2);G.__click=me;var v=s(G,!0);a(G),a(b),a(o);var N=i(o,2);{var Z=pe=>{var $=Vr(),ee=s($),xe=s(ee);xe.__click=U,a(ee);var De=i(ee,2);Pt(De),De.__click=Te=>Te.target.select(),a($),P((Te,ze)=>{ca(De,Te),mt(De,"rows",ze)},[fe,()=>Math.min(fe().split(`
`).length+2,20)]),u(pe,$)},Re=pe=>{var $=Jr(),ee=s($),xe=s(ee);{var De=ze=>{var Me=qr();u(ze,Me)},Te=ze=>{var Me=Ue(),Ye=We(Me);{var Qe=$e=>{var ot=Ue(),_t=We(ot);He(_t,17,()=>e(H),Xe,(et,bt)=>{let dt=()=>e(bt).entry,St=()=>e(bt).isRestored,$t=()=>e(bt).inSpreadsheet;var Ct=Xr(),Nt=s(Ct),ea=s(Nt,!0);a(Nt);var Ot=i(Nt,2);{var ta=nt=>{var ct=jr(),At=s(ct);a(ct),P(()=>y(At,`(${dt().legacyId??""})`)),u(nt,ct)};x(Ot,nt=>{dt().legacyId&&nt(ta)})}var aa=i(Ot,2);{var sa=nt=>{var ct=Br();u(nt,ct)},ra=nt=>{var ct=Ue(),At=We(ct);{var oa=gt=>{var Et=Yr();u(gt,Et)},na=gt=>{var Et=Hr();u(gt,Et)};x(At,gt=>{$t()?gt(oa):gt(na,!1)},!0)}u(nt,ct)};x(aa,nt=>{St()?nt(sa):nt(ra,!1)})}a(Ct),P(()=>y(ea,dt().weebdexId)),u(et,Ct)}),u($e,ot)},st=$e=>{var ot=Ue(),_t=We(ot);He(_t,17,_e,Xe,(et,bt)=>{var dt=Kr(),St=s(dt,!0);a(dt),P(()=>y(St,e(bt))),u(et,dt)}),u($e,ot)};x(Ye,$e=>{e(H).length>0?$e(Qe):$e(st,!1)},!0)}u(ze,Me)};x(xe,ze=>{e(X)?ze(De):ze(Te,!1)})}a(ee),a($),u(pe,$)};x(N,pe=>{e(I)?pe(Z):pe(Re,!1)})}a(T),P(pe=>{y(f,pe),y(v,e(I)?"Hide CSV":"Show CSV")},[re]),u(_,T)},de=_=>{var T=Ue(),o=We(T);{var d=b=>{var C=$r();u(b,C)},f=b=>{var C=eo();u(b,C)};x(o,b=>{e(n)==="per-session"&&!e(r)?b(d):b(f,!1)},!0)}u(_,T)};x(ie,_=>{(e(n)==="all-combined"||e(r))&&_e().length>0?_(ge):_(de,!1)})}var se=i(ie,2),be=s(se);be.__click=()=>{c(l,!e(l)),e(l)&&c(L,null)};var W=s(be,!0);a(be);var V=i(be,2);{var Q=_=>{var T=ao(),o=i(s(T),2);Pt(o),mt(o,"rows",6);var d=i(o,2),f=s(d);f.__click=F;var b=s(f,!0);a(f);var C=i(f,2);{var G=v=>{var N=to(),Z=s(N);a(N),P(()=>y(Z,`Imported: ${e(L).imported??""}, Failed: ${e(L).failed??""}`)),u(v,N)};x(C,v=>{e(L)&&v(G)})}a(d),a(T),P(v=>{o.disabled=e(S),f.disabled=v,y(b,e(S)?"Importing...":"Import")},[()=>e(S)||!e(R).trim()]),Ft(o,()=>e(R),v=>c(R,v)),u(_,T)};x(V,_=>{e(l)&&_(Q)})}a(se);var ye=i(se,2),Ge=s(ye);Ge.__click=()=>A.loadData();var g=i(Ge,2);g.__click=()=>{confirm("Are you sure you want to clear all completed IDs from localStorage? This cannot be undone.")&&A.clearAll()},a(ye),P(()=>{y(Ee,e(q)?"Hide Sheet Settings":"Configure Sheet URL"),Oe(Ke,1,`uno-r9todb ${e(n)==="per-session"?"uno-qv685z":"uno-7i144e"}`),Oe(z,1,`uno-r9todb ${e(n)==="all-combined"?"uno-qv685z":"uno-7i144e"}`),y(W,e(l)?"Hide Import":"Import Legacy IDs")}),u(E,k)};x(Fe,E=>{e(h)&&E(Le)})}a(m),u(Ie,m),at()}lt(["click","change"]);var no=p('<div class="uno-j48514"><p class="uno-5v04yw">No zip file selected. Use the tabs above to select a zip file to process.</p></div>'),io=p('<div class="uno-eeu1av"><!> <!></div>'),lo=p('<div class="uno-pb4e2u"><div class="uno-k0pcvl"><h1 class="uno-kryzyj">Guided Zip Manga Uploader</h1> <div class="uno-skt2gn"><button type="button" class="uno-q7l7gr">Simple Mode</button> <button type="button" class="uno-q7l7gr">Chapter Editor</button> <!></div></div> <a target="_blank" class="uno-6zhxse">Tutorial & Docs</a> <!> <!> <!></div>');function So(Ie,t){tt(t,!0);const n=new ba,r=new Ia,h=new es;yt(ya,n),yt(Lt,r),yt(Wt,h),yt(Jt,new Ya);let I=D(null),l=D(null),R=D(null);ia(()=>{c(R,new Date().toISOString(),!0)});function S(){n.workflowStep=ht.SELECTING_MANGA_FOLDERS}function L(){if(n.workflowStep=ht.PROCESSING_MANGA,n.selectedZipFiles.length>0){const F=n.selectedZipFiles[0],re=n.zipFiles.findIndex(ce=>ce.file===F);re>=0&&(n.currentZipIndex=re,c(I,F,!0))}}function H(F){c(I,F,!0)}async function X(F,re){const ce=n.currentZip;if(ce&&(F==="success"?(n.setZipStatus(ce.file,Ve.COMPLETED),re&&e(R)&&await h.addCompletedId(e(R),re)):F==="warning"?n.setZipStatus(ce.file,Ve.WARNING):F==="error"&&n.setZipStatus(ce.file,Ve.ERROR)),n.moveToNextZip()){const w=n.currentZip;w&&c(I,w.file,!0)}else c(I,null)}function q(){e(l)&&e(l).startUpload()}const ae=le(()=>n.workflowStep!==ht.PROCESSING_MANGA);var Y=lo(),A=s(Y),M=i(s(A),2),ne=s(M);ne.__click=()=>jt(Rt("/"));var B=i(ne,2);B.__click=()=>jt(Rt("/chapter-editor"));var K=i(B,2);ja(K,{}),a(M),a(A);var ve=i(A,2),_e=i(ve,2);{var Se=F=>{Ba(F,{})};x(_e,F=>{e(ae)&&F(Se)})}var fe=i(_e,2);oo(fe,{});var me=i(fe,2);{var U=F=>{Qa(F,{get guidedState(){return n},onDone:S,class:"uno-zgouyr"})},J=F=>{var re=Ue(),ce=We(re);{var w=j=>{gs(j,{get guidedState(){return n},onDone:L,class:"uno-l0uum8"})},m=j=>{var Ce=Ue(),he=We(Ce);{var Pe=ke=>{var Fe=io(),Le=s(Fe);As(Le,{get guidedState(){return n},onZipSelected:H,onAutomationRequestUpload:q,get mangaProcessorRef(){return e(l)},class:"uno-wgeun8"});var E=i(Le,2);{var k=ue=>{It(Pr(ue,{get guidedState(){return n},get zipFile(){return e(I)},onProcessingComplete:X,class:"uno-wgeun8"}),Ee=>c(l,Ee,!0),()=>e(l))},oe=ue=>{var Ee=no();u(ue,Ee)};x(E,ue=>{e(I)?ue(k):ue(oe,!1)})}a(Fe),u(ke,Fe)};x(he,ke=>{n.workflowStep===ht.PROCESSING_MANGA&&ke(Pe)},!0)}u(j,Ce)};x(ce,j=>{n.workflowStep===ht.SELECTING_MANGA_FOLDERS?j(w):j(m,!1)},!0)}u(F,re)};x(me,F=>{n.workflowStep===ht.SELECTING_ROOT_FOLDER?F(U):F(J,!1)})}a(Y),P(F=>mt(ve,"href",F),[()=>Rt("/docs")]),u(Ie,Y),at()}lt(["click"]);export{So as component,xo as universal};
