import{f as v,a as u,c as Me,t as Tt}from"../chunks/CEbVEvWq.js";import{o as Jt}from"../chunks/DG6bnxrc.js";import{O as et,S as s,U as i,J as e,I as W,K as c,T as a,Q as O,R as tt,G as Kt,M as Ke,aJ as pt,u as Ye,aI as de,af as dt,aK as At,P as De,aL as Wt,aC as ft}from"../chunks/DISrue0C.js";import{d as nt}from"../chunks/BWz26xft.js";import{i as x}from"../chunks/DqJZiQ1o.js";import{r as mt,a as bt,s as ht,b as Qt}from"../chunks/eICFcUV5.js";import{p as qe,b as _t}from"../chunks/CepRIdbm.js";import{s as w}from"../chunks/DHKgQpv7.js";import{s as Fe,a as $t,c as ea,r as St}from"../chunks/DQEw4H9t.js";import{M as ze,a as Rt,b as M,c as ta,U as Pt,Z as aa,B as sa,S as ra,T as na,d as oa,e as ia,G as la,g as ua,A as ca,f as gt}from"../chunks/BVJds55N.js";import{q as Ot,r as ot,v as da,w as pa,e as He,i as Xe,b as zt,D as va,t as Gt,x as ga,y as ha,z as Zt,T as fa,a as ma,A as _a,c as yt,B as Vt,G as ba,E as Ut,W as Ue,f as ya,k as Ia,F as wa,H as xa,I as Sa,J as Ca,K as Na,L as Ft,C as Aa,M as Ct,s as Ea,S as Ra,g as kt,h as Lt,N as Ga,U as Da,o as Ta,p as Pa,m as Fa,n as ka}from"../chunks/CsFz_V2l.js";import{b as jt,A as La}from"../chunks/CEv-pqVm.js";import{g as Mt}from"../chunks/6d9TIk4-.js";const Ma=!0,ln=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ma},Symbol.toStringTag,{value:"Module"}));var Wa=v('<div class="uno-4maolu"><div class="uno-senp7v"></div> <p class="uno-l6h9uf">Scanning folder structure...</p></div>'),Oa=v('<div class="uno-laclbo"><p class="uno-dl0t86"> </p></div>'),za=v('<div class="uno-tm086o"><button><h1 class="uno-brv6u2">Select Root Folder</h1> <p class="uno-l6h9uf">Select the folder containing manga subfolders with .zip files</p> <input class="uno-qya2ty" type="file"/></button> <!> <!></div>');function Za(be,t){et(t,!0);let o=qe(t,"guidedState",7),r=qe(t,"class",3,""),h=W(null),I=W(!1);async function l(E){c(I,!0);const z=E.target,ie=Array.from(z.files??[]),ae=[];for(const $ of ie){const ye=($.webkitRelativePath||$.name).split("/").filter(Boolean);if(ye.length>=2){const we=ye[0],me=ye[0],ge=$.name.split(".").pop()?.toLowerCase();(ge==="zip"||ge==="cbz")&&ae.push({file:$,mangaFolderName:we,mangaFolderPath:me})}}o().rootFolderFiles=ie,o().zipFiles=ae.map($=>({...$,status:ze.PENDING})),c(I,!1),t.onDone()}function N(E){e(h)?.click()}var S=za(),L=s(S);L.__click=N;var X=i(s(L),4);X.webkitdirectory=!0,X.multiple=!0,X.__change=l,_t(X,E=>c(h,E),()=>e(h)),a(L);var J=i(L,2);{var q=E=>{var z=Wa();u(E,z)};x(J,E=>{e(I)&&E(q)})}var re=i(J,2);{var Q=E=>{var z=Oa(),ie=s(z),ae=s(ie);a(ie),a(z),O(()=>w(ae,`Found ${o().zipFiles.length??""} zip file${o().zipFiles.length===1?"":"s"}`)),u(E,z)};x(re,E=>{o().zipFiles.length>0&&E(Q)})}a(S),O(()=>{Fe(L,1,`uno-a4tqjo ${r()??""}`),L.disabled=e(I)}),u(be,S),tt()}nt(["click","change"]);class Va{#e=W(null);get legacyToWeebdexMap(){return e(this.#e)}set legacyToWeebdexMap(t){c(this.#e,t,!0)}#t=W(null);get weebdexToLegacyMap(){return e(this.#t)}set weebdexToLegacyMap(t){c(this.#t,t,!0)}#a=W(!1);get isLoading(){return e(this.#a)}set isLoading(t){c(this.#a,t,!0)}#s=W(null);get loadError(){return e(this.#s)}set loadError(t){c(this.#s,t,!0)}loadPromise=null;async load(){if(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)return;if(this.loadPromise)return this.loadPromise;this.isLoading=!0,this.loadError=null;let t,o;this.loadPromise=new Promise((r,h)=>{t=r,o=h});try{const r=$t("/weebdex_lookup.csv"),h=await fetch(r);if(!h.ok)throw new Error(`Failed to fetch CSV: ${h.status} ${h.statusText}`);const I=await h.text(),{legacyToWeebdex:l,weebdexToLegacy:N}=this.parseCSV(I);this.legacyToWeebdexMap=l,this.weebdexToLegacyMap=N,t()}catch(r){this.loadError=r instanceof Error?r:new Error("Unknown error loading CSV"),o(this.loadError)}finally{this.isLoading=!1}return this.loadPromise}async ensureLoaded(){if(!(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)){if(this.loadPromise){await this.loadPromise;return}await this.load()}}parseCSV(t){const o=Ot(t,{columns:!0,skip_empty_lines:!0,trim:!0}),r=new ot,h=new ot;for(const I of o){const l=I.weebdex_id?.trim()||"",N=I.legacy_id?.trim()||"";l&&N&&(r.set(N,l),h.set(l,N))}return{legacyToWeebdex:r,weebdexToLegacy:h}}async getWeebdexIdFromLegacyId(t){return await this.ensureLoaded(),this.legacyToWeebdexMap===null?null:this.legacyToWeebdexMap.get(t)||null}async getLegacyIdFromWeebdexId(t){return await this.ensureLoaded(),this.weebdexToLegacyMap===null?null:this.weebdexToLegacyMap.get(t)||null}}const ut=new Va,Nt="completedWeebdexIds",rt="completedWeebdexIdsV2";class Ua{#e=W(Ke([]));get _sessions(){return e(this.#e)}set _sessions(t){c(this.#e,t,!0)}#t=W(Ke([]));get _allCombinedIds(){return e(this.#t)}set _allCombinedIds(t){c(this.#t,t,!0)}#a=W(Ke([]));get _allLegacyIds(){return e(this.#a)}set _allLegacyIds(t){c(this.#a,t,!0)}constructor(){this.migrateIfNeeded().then(()=>{this.loadData()}),this.loadData()}get sessions(){return this._sessions}get allCombinedIds(){return this._allCombinedIds}get allLegacyIds(){return this._allLegacyIds}async migrateIfNeeded(){if(typeof window>"u"||localStorage.getItem(rt))return;const t=localStorage.getItem(Nt);if(t)try{const o=JSON.parse(t),r={};await ut.load();for(const[h,I]of Object.entries(o)){const l=[];for(const N of I){const S=await ut.getLegacyIdFromWeebdexId(N);l.push({weebdexId:N,legacyId:S})}r[h]=l}localStorage.setItem(rt,JSON.stringify(r)),localStorage.removeItem(Nt)}catch(o){console.error("Failed to migrate completed IDs:",o)}}async addCompletedId(t,o){if(!(typeof window>"u"))try{await ut.load();const r=await ut.getLegacyIdFromWeebdexId(o),h=JSON.parse(localStorage.getItem(rt)||"{}");h[t]||(h[t]=[]),h[t].some(l=>l.weebdexId===o)||(h[t].push({weebdexId:o,legacyId:r}),localStorage.setItem(rt,JSON.stringify(h)),this.loadData())}catch(r){console.error("Failed to save weebdex ID to localStorage:",r)}}loadData(){if(!(typeof window>"u"))try{const t=JSON.parse(localStorage.getItem(rt)||"{}");this._sessions=Object.entries(t).map(([h,I])=>({timestamp:h,ids:[...I]})).sort((h,I)=>I.timestamp.localeCompare(h.timestamp));const o=[],r=[];for(const h of this._sessions)for(const I of h.ids)o.includes(I.weebdexId)||o.push(I.weebdexId),I.legacyId&&!r.includes(I.legacyId)&&r.push(I.legacyId);this._allCombinedIds=o.sort(),this._allLegacyIds=r.sort()}catch(t){console.error("Failed to load completed IDs from localStorage:",t),this._sessions=[],this._allCombinedIds=[],this._allLegacyIds=[]}}deleteSession(t){if(!(typeof window>"u"))try{const o=JSON.parse(localStorage.getItem(rt)||"{}");o[t]&&(delete o[t],localStorage.setItem(rt,JSON.stringify(o)),this.loadData())}catch(o){console.error("Failed to delete session:",o)}}clearAll(){typeof window>"u"||(localStorage.removeItem(rt),localStorage.removeItem(Nt),this.loadData())}getSessionIds(t){return this._sessions.find(r=>r.timestamp===t)?.ids.map(r=>r.weebdexId)||[]}async importLegacyIds(t){if(typeof window>"u")return{imported:0,failed:0};try{await ut.load();const r=`imported-${Date.now()}`,h=JSON.parse(localStorage.getItem(rt)||"{}");h[r]||(h[r]=[]);let I=0,l=0;for(const N of t){const S=N.trim();if(S)try{const L=await ut.getWeebdexIdFromLegacyId(S);L?h[r].some(J=>J.weebdexId===L)||(h[r].push({weebdexId:L,legacyId:S}),I++):l++}catch(L){console.error(`Failed to lookup weebdex ID for legacy ID ${S}:`,L),l++}}return I>0&&(localStorage.setItem(rt,JSON.stringify(h)),this.loadData()),{imported:I,failed:l}}catch(o){return console.error("Failed to import legacy IDs:",o),{imported:0,failed:t.length}}}}const Dt=Kt();class ja{#e=W(null);get _data(){return e(this.#e)}set _data(t){c(this.#e,t,!0)}#t=W(null);get _legacyIdMap(){return e(this.#t)}set _legacyIdMap(t){c(this.#t,t,!0)}#a=W(Ke([]));get _allRestoredWeebdexIds(){return e(this.#a)}set _allRestoredWeebdexIds(t){c(this.#a,t,!0)}#s=W(Ke([]));get _allRestoredLegacyIds(){return e(this.#s)}set _allRestoredLegacyIds(t){c(this.#s,t,!0)}#r=W(!1);get isLoading(){return e(this.#r)}set isLoading(t){c(this.#r,t,!0)}#n=W(null);get loadError(){return e(this.#n)}set loadError(t){c(this.#n,t,!0)}loadPromise=null;constructor(){this.load()}get allRestoredWeebdexIds(){return this._allRestoredWeebdexIds}get allRestoredLegacyIds(){return this._allRestoredLegacyIds}async load(){if(this._data!==null&&this._legacyIdMap!==null)return;if(this.loadPromise)return this.loadPromise;this.isLoading=!0,this.loadError=null;let t,o;this.loadPromise=new Promise((r,h)=>{t=r,o=h});try{this._data=new ot,this._legacyIdMap=new ot,this._allRestoredWeebdexIds=[],this._allRestoredLegacyIds=[],t();return}catch(r){this.loadError=r instanceof Error?r:new Error("Unknown error loading restored IDs CSV"),o(this.loadError)}finally{this.isLoading=!1}return this.loadPromise}async ensureLoaded(){if(!(this._data!==null&&this._legacyIdMap!==null)){if(this.loadPromise){await this.loadPromise;return}await this.load()}}parseCSV(t){const o=Ot(t,{columns:!0,skip_empty_lines:!0,trim:!0}),r=new ot,h=new ot,I=[],l=[];for(const N of o){const S=N.weebdex_id?.trim()||"",L=N.legacy_mangadex_id?.trim()||"",X=N.mangadex_id?.trim()||"",J=N.restored?.trim().toUpperCase()==="TRUE";if(S){const q={mangadexId:X,weebdexId:S,legacyMangadexId:L,restored:J};r.set(S,q),L&&h.set(L,q),J&&(I.push(S),L&&l.push(L))}}return{data:r,legacyIdMap:h,restoredWeebdexIds:I.sort(),restoredLegacyIds:l.sort()}}async isRestoredByWeebdexId(t){return await this.ensureLoaded(),this._data===null?!1:this._data.get(t)?.restored??!1}async isRestoredByLegacyId(t){return await this.ensureLoaded(),this._legacyIdMap===null?!1:this._legacyIdMap.get(t)?.restored??!1}async getEntryByWeebdexId(t){return await this.ensureLoaded(),this._data===null?null:this._data.get(t)||null}async getEntryByLegacyId(t){return await this.ensureLoaded(),this._legacyIdMap===null?null:this._legacyIdMap.get(t)||null}async existsInSpreadsheet(t){return await this.ensureLoaded(),this._data===null?!1:this._data.has(t)}async existsInSpreadsheetByLegacyId(t){return await this.ensureLoaded(),this._legacyIdMap===null?!1:this._legacyIdMap.has(t)}}const qt=new ja;function qa(be){const t=da(be,0);return pa(be,t,0,[])}function Ba(be,t="v(\\d+)"){const o=new RegExp(t,"i"),r=be.match(o);return r&&r[1]?r[1].replace(/^0+/,"")||"0":null}function Ya(be,t="c(\\d+(?:\\.\\d+){0,2})"){const o=new RegExp(t,"i"),r=be.match(o);if(r&&r[1]){const h=r[1];if(h.includes(".")){const I=h.split(".");return[I[0].replace(/^0+/,"")||"0",...I.slice(1)].join(".")}else return h.replace(/^0+/,"")||"0"}return null}function Et(be){const t=/MD-(\d+)/i,o=be.match(t);return o?o[1]:null}var Ha=v(`<div class="uno-x7vsh7"><label for="legacy-id-input" class="uno-kd6uvm">Batch Select by Legacy IDs (MD-#### format, one per line)</label> <textarea id="legacy-id-input" placeholder="MD-12345 MD-67890 12345 67890" class="uno-rlhew9 bg-background focus:ring-primary"></textarea> <div class="uno-qdzwro"><button type="button" class="uno-kaum0q">Select Matching Files</button> <button type="button" class="uno-lisxcn">Clear</button></div> <p class="uno-42pivu">Enter legacy IDs in MD-#### format (e.g., "MD-12345") or just the numeric part (e.g.,
					"12345"). One ID per line. Matching zip files will be selected.</p></div>`),Xa=v('<p class="uno-t17h6o">Filtering zip files...</p>'),Ja=v("<span> </span>"),Ka=v("<span> </span>"),Qa=v("<span> </span>"),$a=v('<div class="uno-1dfxdr"><p class="uno-t17h6o"> </p> <div class="uno-f3g7m9"><!> <!> <!></div></div>'),es=v('<button type="button"><div class="uno-bpywdh"><p class="uno-98yf80"> </p> <p class="uno-42pivu"> </p></div> <input type="checkbox" class="uno-5onsv4"/></button>'),ts=v('<div class="uno-o40niy"><div class="uno-iuhcpm"><h3 class="uno-0lb4rh"> </h3> <button type="button" class="uno-phh4jd"> </button></div> <div class="uno-fb55wk"></div></div>'),as=v('<div><div class="uno-iuhcpm"><h2 class="uno-iyer7g">Select Zip Files to Process</h2> <div class="uno-13hhk0"><div class="uno-13hhk0"><label class="uno-6exdwe"><input type="checkbox" class="uno-tpxhk2"/> <span class="uno-ok9xip">Hide completed (local)</span></label> <label class="uno-6exdwe"><input type="checkbox" class="uno-tpxhk2"/> <span class="uno-ok9xip">Hide restored (sheet)</span></label></div> <button type="button" class="uno-f45w65"> </button></div></div> <div class="uno-o40niy"><button type="button" class="uno-14oovc"> </button> <!></div> <div class="uno-1dfxdr"><p class="uno-ok9xip"> </p> <!></div> <div class="uno-yjimjk"></div> <button type="button" class="uno-3s4o5e"> </button></div>');function ss(be,t){et(t,!0);let o=qe(t,"guidedState",7),r=qe(t,"class",3,"");const h=pt(Dt),I=qt;let l=W(!0),N=W(!0),S=W(""),L=W(!1);function X(V){o().selectedZipFiles.indexOf(V)>=0?o().selectedZipFiles=o().selectedZipFiles.filter(_e=>_e!==V):o().selectedZipFiles=[...o().selectedZipFiles,V]}function J(V){const te=Array.from(o().zipFilesByMangaFolder.get(V)??[]);if(te.every(ue=>o().selectedZipFiles.includes(ue.file)))o().selectedZipFiles=o().selectedZipFiles.filter(ue=>!te.some(Y=>Y.file===ue));else{const ue=te.map(Y=>Y.file).filter(Y=>!o().selectedZipFiles.includes(Y));o().selectedZipFiles=[...o().selectedZipFiles,...ue]}}const q=de(()=>{const V=[];for(const te of e(z).values())for(const _e of te)V.push(_e.file);return V});function re(){const V=e(q);if(V.every(_e=>o().selectedZipFiles.includes(_e)))o().selectedZipFiles=o().selectedZipFiles.filter(_e=>!V.includes(_e));else{const _e=V.filter(ue=>!o().selectedZipFiles.includes(ue));o().selectedZipFiles=[...o().selectedZipFiles,..._e]}}const Q=de(()=>{const V=e(q);return V.length>0&&V.every(te=>o().selectedZipFiles.includes(te))}),E=de(()=>h.allLegacyIds);let z=W(Ke(new Map)),ie=W(!1),ae=0,$=W(0),pe=W(0),ye=W(0);Ye(()=>{const V=e(l),te=e(N),_e=o().zipFilesByMangaFolder,ue=++ae;c(ie,!0),I.load().then(()=>{ue===ae&&(async()=>{const Y=new Map;let B=0,U=0,ne=0;for(const[C,A]of _e.entries())if(V||te){const j=[];for(const ce of A){const fe=Et(ce.file.name);if(!fe){j.push(ce);continue}let p=!1,b=!1;te&&(b=await I.isRestoredByLegacyId(fe)),V&&(p=e(E)&&e(E).includes(fe)),p&&b?ne++:b?U++:p?B++:j.push(ce)}j.length>0&&Y.set(C,j)}else Y.set(C,Array.from(A));ue===ae&&(c(z,Y,!0),c($,B,!0),c(pe,U,!0),c(ye,ne,!0),c(ie,!1))})()})});function we(V){const te=new Set,_e=V.split(`
`).map(ue=>ue.trim()).filter(ue=>ue.length>0);for(const ue of _e){const Y=/MD-(\d+)/i,B=ue.match(Y);if(B){te.add(B[1]);continue}const U=/^(\d+)$/,ne=ue.match(U);ne&&te.add(ne[1])}return te}function me(){const V=we(e(S));if(V.size===0)return;const te=[];for(const ue of o().zipFiles){const Y=Et(ue.file.name);Y&&V.has(Y)&&te.push(ue.file)}const _e=te.filter(ue=>!o().selectedZipFiles.includes(ue));o().selectedZipFiles=[...o().selectedZipFiles,..._e],c(S,""),c(L,!1)}var ge=as(),Z=s(ge),K=i(s(Z),2),R=s(K),se=s(R),ve=s(se);mt(ve),ve.__change=V=>{c(l,V.target.checked,!0)},dt(2),a(se);var y=i(se,2),m=s(y);mt(m),m.__change=V=>{c(N,V.target.checked,!0)},dt(2),a(y),a(R);var H=i(R,2);H.__click=re;var xe=s(H,!0);a(H),a(K),a(Z);var _=i(Z,2),P=s(_);P.__click=()=>{c(L,!e(L))};var ee=s(P);a(P);var le=i(P,2);{var Se=V=>{var te=Ha(),_e=i(s(te),2);At(_e);var ue=i(_e,2),Y=s(ue);Y.__click=me;var B=i(Y,2);B.__click=()=>{c(S,"")},a(ue),dt(2),a(te),O(U=>Y.disabled=U,[()=>!e(S).trim()]),zt(_e,()=>e(S),U=>c(S,U)),u(V,te)};x(le,V=>{e(L)&&V(Se)})}a(_);var he=i(_,2),Ce=s(he),We=s(Ce);a(Ce);var ke=i(Ce,2);{var Le=V=>{var te=Xa();u(V,te)},Ze=V=>{var te=Me(),_e=De(te);{var ue=Y=>{const B=de(()=>e($)+e(pe)+e(ye));var U=Me(),ne=De(U);{var C=A=>{var j=$a(),ce=s(j),fe=s(ce);a(ce);var p=i(ce,2),b=s(p);{var F=T=>{var G=Ja(),g=s(G);a(G),O(()=>w(g,`Completed: ${e($)??""}`)),u(T,G)};x(b,T=>{e(l)&&e($)>0&&T(F)})}var n=i(b,2);{var d=T=>{var G=Ka(),g=s(G);a(G),O(()=>w(g,`Restored: ${e(pe)??""}`)),u(T,G)};x(n,T=>{e(N)&&e(pe)>0&&T(d)})}var f=i(n,2);{var D=T=>{var G=Qa(),g=s(G);a(G),O(()=>w(g,`Both: ${e(ye)??""}`)),u(T,G)};x(f,T=>{e(ye)>0&&T(D)})}a(p),a(j),O(()=>w(fe,`Total hidden: ${e(B)??""} zip file${e(B)===1?"":"s"}`)),u(A,j)};x(ne,A=>{e(B)>0&&A(C)})}u(Y,U)};x(_e,Y=>{(e(l)||e(N))&&Y(ue)},!0)}u(V,te)};x(ke,V=>{e(ie)?V(Le):V(Ze,!1)})}a(he);var Ne=i(he,2);He(Ne,21,()=>Array.from(e(z).entries()),Xe,(V,te)=>{var _e=de(()=>Wt(e(te),2));let ue=()=>e(_e)[0],Y=()=>e(_e)[1];var B=ts(),U=s(B),ne=s(U),C=s(ne,!0);a(ne);var A=i(ne,2);A.__click=()=>J(ue());var j=s(A);a(A),a(U);var ce=i(U,2);He(ce,21,Y,Xe,(fe,p)=>{const b=de(()=>o().selectedZipFiles.includes(e(p).file));var F=es();F.__click=()=>X(e(p).file);var n=s(F),d=s(n),f=s(d,!0);a(d);var D=i(d,2),T=s(D);a(D),a(n);var G=i(n,2);mt(G),a(F),O(g=>{Fe(F,1,`uno-ik4adi ${e(b)?"uno-1k75dk":""}`),w(f,e(p).file.name),w(T,`Size: ${g??""} MB`),bt(G,e(b))},[()=>(e(p).file.size/(1024*1024)).toFixed(2)]),u(fe,F)}),a(ce),a(B),O(fe=>{w(C,ue()),w(j,`${fe??""} (${Y().length??""})`)},[()=>Y().every(fe=>o().selectedZipFiles.includes(fe.file))?"Deselect All":"Select All"]),u(V,B)}),a(Ne);var je=i(Ne,2);je.__click=function(...V){t.onDone?.apply(this,V)};var Qe=s(je);a(je),a(ge),O(()=>{Fe(ge,1,`uno-grwdkw ${r()??""}`),bt(ve,e(l)),bt(m,e(N)),w(xe,e(Q)?"Deselect All":"Select All"),w(ee,`${e(L)?"Hide":"Show"} Batch Select by Legacy IDs`),w(We,`${o().selectedZipFiles.length??""} of ${e(q).length??""} visible zip file${e(q).length===1?"":"s"} selected`),je.disabled=o().selectedZipFiles.length===0,w(Qe,`Continue to Processing (${o().selectedZipFiles.length??""} selected)`)}),u(be,ge),tt()}nt(["change","click"]);var rs=v('<p class="uno-a54tpo"> </p>'),ns=v('<div class="uno-cqccui"><p class="uno-nsysfu"> </p> <span> </span></div> <!>',1),os=v('<p class="uno-b7m48p">No zip file selected</p>'),is=v('<button type="button" class="uno-qm31yq"> </button>'),ls=v('<p class="uno-b7m48p">No more zip files to process</p>'),us=v("<div><!></div>"),cs=v('<p class="uno-b7m48p">All zip files have been completed</p>'),ds=v('<button type="button" class="uno-4y4l6m"> </button>'),ps=v('<div class="uno-2db0z0"><h3 class="uno-tniapq"> </h3> <div class="uno-ouywhe"></div></div>'),vs=v('<button type="button" class="uno-qy4bc0"> </button>'),gs=v('<div class="uno-2db0z0"><h3 class="uno-9iz2qs"> </h3> <div class="uno-ouywhe"></div></div>'),hs=v('<div><div class="uno-0ia1w6 border-surface-hover"><h2 class="uno-1c2kr2">Zip Processing</h2> <div class="uno-cqccui"><span class="uno-d1zaof">Automation (experimental): <span> </span></span> <button type="button"> </button></div></div> <div class="uno-usvt4c"><div class="uno-cqccui"><span class="uno-4ezlml"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-1l1bmy"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-e545zy"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-mg1fk7"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-ip18dj"></span> <span class="uno-b7m48p"> </span></div></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Current Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Next Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Select Zip File</h3> <!></div> <!> <!></div>');function fs(be,t){et(t,!0);let o=qe(t,"guidedState",7),r=qe(t,"class",3,"");const h=pt(Rt);if(!h)throw new Error("MangaProcessingTabs must be used within a component that provides AutomationState context");function I(){if(o().moveToNextZip()){const C=o().currentZip;C&&t.onZipSelected(C.file)}}function l(C){const A=o().zipFiles.find(j=>j.file.name===C);if(A){const j=o().zipFiles.findIndex(ce=>ce.file===A.file);j>=0&&(o().currentZipIndex=j,t.onZipSelected(A.file))}}function N(){h.enabled?h.disable():h.enable()}const S=de(()=>o().currentZip?.file.name??null),L=de(()=>o().warningZips.map(C=>C.file.name)),X=de(()=>o().errorZips.map(C=>C.file.name)),J=de(()=>o().unprocessedZips.map(C=>C.file.name)),q=de(()=>o().nextZip?.file.name??null),re=de(()=>o().pendingZips.length===0&&(o().warningZips.length>0||o().errorZips.length>0));Ye(()=>{e(re)&&h.isActive&&h.disable()});let Q=W(null);Ye(()=>{c(Q,o().currentZip?.file.name??null,!0)}),Ye(()=>{const C=e(Q);if(C){const A=o().currentZip?.file.name??null;C!==A&&l(C)}});const E=de(()=>({pending:o().pendingZips.length,warning:o().warningZips.length,error:o().errorZips.length,completed:o().completedZips.length,processing:o().processingZips.length}));var z=hs(),ie=s(z),ae=i(s(ie),2),$=s(ae),pe=i(s($)),ye=s(pe,!0);a(pe),a($);var we=i($,2);we.__click=N;var me=s(we,!0);a(we),a(ae),a(ie);var ge=i(ie,2),Z=s(ge),K=i(s(Z),2),R=s(K);a(K),a(Z);var se=i(Z,2),ve=i(s(se),2),y=s(ve);a(ve),a(se);var m=i(se,2),H=i(s(m),2),xe=s(H);a(H),a(m);var _=i(m,2),P=i(s(_),2),ee=s(P);a(P),a(_);var le=i(_,2),Se=i(s(le),2),he=s(Se);a(Se),a(le),a(ge);var Ce=i(ge,2),We=i(s(Ce),2);{var ke=C=>{var A=ns(),j=De(A),ce=s(j),fe=s(ce,!0);a(ce);var p=i(ce,2),b=s(p,!0);a(p),a(j);var F=i(j,2);{var n=d=>{var f=rs(),D=s(f);a(f),O(()=>w(D,`Manga Folder: ${o().currentZip.mangaFolderName??""}`)),u(d,f)};x(F,d=>{o().currentZip&&d(n)})}O(()=>{w(fe,e(S)),Fe(p,1,`uno-ielryd ${o().currentZip?.status===ze.PROCESSING?"uno-kxa2ln":o().currentZip?.status===ze.COMPLETED?"uno-b1425w":o().currentZip?.status===ze.ERROR?"uno-isu16c":o().currentZip?.status===ze.WARNING?"uno-enplrj":"uno-jwlzg2"}`),w(b,o().currentZip?.status??"UNKNOWN")}),u(C,A)},Le=C=>{var A=os();u(C,A)};x(We,C=>{e(S)?C(ke):C(Le,!1)})}a(Ce);var Ze=i(Ce,2),Ne=i(s(Ze),2);{var je=C=>{var A=is();A.__click=I;var j=s(A);a(A),O(()=>{A.disabled=h.enabled,w(j,`Process: ${e(q)??""}`)}),u(C,A)},Qe=C=>{var A=ls();u(C,A)};x(Ne,C=>{e(q)?C(je):C(Qe,!1)})}a(Ze);var V=i(Ze,2),te=i(s(V),2);{var _e=C=>{var A=us(),j=s(A);va(j,{get items(){return e(J)},class:"uno-qbg2l1",get selectedItem(){return e(Q)},set selectedItem(ce){c(Q,ce,!0)}}),a(A),O(()=>Fe(A,1,ea(h.enabled?"opacity-50 pointer-events-none":""))),u(C,A)},ue=C=>{var A=cs();u(C,A)};x(te,C=>{e(J).length>0?C(_e):C(ue,!1)})}a(V);var Y=i(V,2);{var B=C=>{var A=ps(),j=s(A),ce=s(j);a(j);var fe=i(j,2);He(fe,21,()=>e(L),Xe,(p,b)=>{var F=ds();F.__click=()=>l(e(b));var n=s(F,!0);a(F),O(()=>{F.disabled=h.enabled,w(n,e(b))}),u(p,F)}),a(fe),a(A),O(()=>w(ce,`‚ö†Ô∏è Warning Zips (${e(L).length??""})`)),u(C,A)};x(Y,C=>{e(L).length>0&&C(B)})}var U=i(Y,2);{var ne=C=>{var A=gs(),j=s(A),ce=s(j);a(j);var fe=i(j,2);He(fe,21,()=>e(X),Xe,(p,b)=>{var F=vs();F.__click=()=>l(e(b));var n=s(F,!0);a(F),O(()=>{F.disabled=h.enabled,w(n,e(b))}),u(p,F)}),a(fe),a(A),O(()=>w(ce,`‚ùå Error Zips (${e(X).length??""})`)),u(C,A)};x(U,C=>{e(X).length>0&&C(ne)})}a(z),O(()=>{Fe(z,1,`uno-s0eao9 ${r()??""}`),Fe(pe,1,`uno-cvk0wv ${h.enabled?"uno-ikj4sb":"uno-je1lgh"}`),w(ye,h.enabled?"ON":"OFF"),Fe(we,1,`uno-sv39f1 ${h.enabled?"uno-oxxvv6":"uno-dimr5c"}`),w(me,h.enabled?"üîÑ Turn OFF":"‚ñ∂Ô∏è Turn ON"),w(R,`Pending: ${e(E).pending??""}`),w(y,`Processing: ${e(E).processing??""}`),w(xe,`Warning: ${e(E).warning??""}`),w(ee,`Error: ${e(E).error??""}`),w(he,`Completed: ${e(E).completed??""}`)}),u(be,z),tt()}nt(["click"]);var ms=v('<div class="uno-40a178"><p class="uno-707s42">No [XXXXX] patterns found in chapter paths.</p></div>'),_s=v('<span class="uno-ouuw5g"> </span>'),bs=v('<span class="uno-sn1qll">No groups assigned</span>'),ys=v('<div class="uno-xq5l13"><span class="uno-elxrx7">Current groups:</span> <!></div>'),Is=v("<option> </option>"),ws=v('<div class="uno-5sf5p8"></div> <span>Assigning...</span>',1),xs=v("<span>Assign</span>"),Ss=v('<div class="uno-3u8hax"><div class="uno-foebq1"><div class="uno-3k1ps9"><span class="uno-q9t790"> </span> <span class="uno-elxrx7"> </span></div> <!></div> <div class="uno-3k1ps9"><select class="uno-04defk"><option>Select group...</option><!></select> <button type="button" class="uno-1ldvyy"><!></button></div></div>'),Cs=v('<div class="uno-j86ron"><p class="uno-3xkzo3"> </p> <div class="uno-eymfsi"></div></div>'),Ns=v(`<div><div class="uno-plb3a3"><h3 class="uno-rvu71q">Batch Group Assignment</h3> <button type="button" class="uno-m430kq"> </button></div> <p class="uno-707s42">Assign groups to multiple chapters based on [XXXXX] patterns found in their paths. Useful
		when groups have been renamed and automatic matching fails.</p> <!></div>`);function As(be,t){et(t,!0);const o=pt(Gt);if(!o)throw new Error("BatchGroupAssignment must be used within a component that provides TargetingState context");let r=qe(t,"class",3,""),h=W(!1),I=Ke(new ot),l=W(null);function N(){const z=new Map,ie=/\[([^\]]+)\]$/g;for(const ae of t.chapters){const $=ae.originalFolderPath;if(!$)continue;const pe=$.matchAll(ie);for(const ye of pe){const we=ye[1];z.set(we,(z.get(we)||0)+1)}}return z}function S(z){return t.chapters.filter(ie=>ie.originalFolderPath?.includes(`[${z}]`)??!1)}async function L(z,ie){c(l,z,!0);try{const ae=S(z);for(const $ of ae){$.associatedGroup.groupIds||($.associatedGroup.groupIds=[]);const pe=new Zt($.associatedGroup.groupIds);pe.has(ie)||(pe.add(ie),$.associatedGroup.groupIds=Array.from(pe))}await t.onGroupAssigned()}finally{c(l,null)}}var X=Ns(),J=s(X),q=i(s(J),2);q.__click=()=>{c(h,!e(h))};var re=s(q);a(q),a(J);var Q=i(J,4);{var E=z=>{const ie=de(N),ae=de(()=>Array.from(e(ie).entries()).sort((me,ge)=>ge[1]-me[1]));var $=Me(),pe=De($);{var ye=me=>{var ge=ms();u(me,ge)},we=me=>{var ge=Cs(),Z=s(ge),K=s(Z);a(Z);var R=i(Z,2);He(R,21,()=>e(ae),Xe,(se,ve)=>{var y=de(()=>Wt(e(ve),2));let m=()=>e(y)[0],H=()=>e(y)[1];const xe=de(()=>S(m())),_=de(()=>I.get(m())??null);var P=Ss(),ee=s(P),le=s(ee),Se=s(le),he=s(Se);a(Se);var Ce=i(Se,2),We=s(Ce);a(Ce),a(le);var ke=i(le,2);{var Le=B=>{var U=ys(),ne=i(s(U),2);{var C=j=>{var ce=Me(),fe=De(ce);He(fe,17,()=>e(xe)[0].associatedGroup.groupIds??[],Xe,(p,b)=>{const F=de(()=>o.availableScanGroups.find(f=>f.groupId===e(b)));var n=_s(),d=s(n,!0);a(n),O(()=>w(d,e(F)?.groupName??e(b))),u(p,n)}),u(j,ce)},A=j=>{var ce=bs();u(j,ce)};x(ne,j=>{(e(xe)[0].associatedGroup.groupIds?.length??0)>0?j(C):j(A,!1)})}a(U),u(B,U)};x(ke,B=>{e(xe).length>0&&B(Le)})}a(ee);var Ze=i(ee,2),Ne=s(Ze);Ne.__change=B=>{const U=B.target.value;I.set(m(),U||null)};var je=s(Ne);je.value=je.__value="";var Qe=i(je);He(Qe,17,()=>o.availableScanGroups,Xe,(B,U)=>{var ne=Is(),C=s(ne,!0);a(ne);var A={};O(()=>{w(C,e(U).groupName),A!==(A=e(U).groupId)&&(ne.value=(ne.__value=e(U).groupId)??"")}),u(B,ne)}),a(Ne);var V;ga(Ne);var te=i(Ne,2);te.__click=async()=>{e(_)&&(await L(m(),e(_)),I.set(m(),null))};var _e=s(te);{var ue=B=>{var U=ws();dt(2),u(B,U)},Y=B=>{var U=xs();u(B,U)};x(_e,B=>{e(l)===m()?B(ue):B(Y,!1)})}a(te),a(Ze),a(P),O(()=>{w(he,`[${m()??""}]`),w(We,`(${H()??""} chapter${H()===1?"":"s"})`),Ne.disabled=e(l)===m(),V!==(V=e(_)??"")&&(Ne.value=(Ne.__value=e(_)??"")??"",ha(Ne,e(_)??"")),te.disabled=!e(_)||e(l)===m()}),u(se,P)}),a(R),a(ge),O(()=>w(K,`Found ${e(ae).length??""} unique pattern${e(ae).length===1?"":"s"}:`)),u(me,ge)};x(pe,me=>{e(ae).length===0?me(ye):me(we,!1)})}u(z,$)};x(Q,z=>{e(h)&&z(E)})}a(X),O(()=>{Fe(X,1,`uno-gwfhej ${r()??""}`),w(re,`${e(h)?"Hide":"Show"} Batch Assign`)}),u(be,X),tt()}nt(["click","change"]);var Es=v(`<p class="uno-8xr74j">‚ö†Ô∏è Waiting for series ID - Automation will skip this zip. Please select a series
				above.</p>`),Rs=v('<p class="uno-8xr74j">‚ö†Ô∏è Ready with warnings - Automation will skip this zip. You can still upload manually.</p>'),Gs=v("<p> </p>"),Ds=v("<p>‚Ä¢ Chapter dump lookup failed</p>"),Ts=v("<p> </p>"),Ps=v("<p> </p>"),Fs=v("<p> </p>"),ks=v("<p> </p>"),Ls=v("<p> </p>"),Ms=v("<p> </p>"),Ws=v("<p> </p>"),Os=v('<div><!> <div class="uno-wp9zkq"><!> <!> <!> <!> <!> <!> <!> <!> <!></div></div>');function zs(be,t){et(t,!0);let o=qe(t,"class",3,"");var r=Me(),h=De(r);{var I=l=>{var N=Os(),S=s(N);{var L=y=>{var m=Es();u(y,m)},X=y=>{var m=Rs();u(y,m)};x(S,y=>{t.hasSeriesId?y(X,!1):y(L)})}var J=i(S,2),q=s(J);{var re=y=>{var m=Gs(),H=s(m);a(m),O(()=>w(H,`‚Ä¢ ${t.duplicateCount??""} duplicate chapter${t.duplicateCount===1?"":"s"} detected`)),u(y,m)};x(q,y=>{t.duplicateCount>0&&y(re)})}var Q=i(q,2);{var E=y=>{var m=Ds();u(y,m)};x(Q,y=>{t.dumpLookupFailed&&t.dumpLookupFailedGroups.length===0&&t.dumpLookupFailedTitles===0&&y(E)})}var z=i(Q,2);{var ie=y=>{var m=Ts(),H=s(m);a(m),O(xe=>w(H,`‚Ä¢ ${t.dumpLookupFailedGroups.length??""} group${t.dumpLookupFailedGroups.length===1?"":"s"} failed to lookup: ${xe??""}`),[()=>t.dumpLookupFailedGroups.join(", ")]),u(y,m)};x(z,y=>{t.dumpLookupFailedGroups.length>0&&y(ie)})}var ae=i(z,2);{var $=y=>{var m=Ps(),H=s(m);a(m),O(()=>w(H,`‚Ä¢ ${t.dumpLookupFailedTitles??""} chapter title${t.dumpLookupFailedTitles===1?"":"s"} failed
					to resolve`)),u(y,m)};x(ae,y=>{t.dumpLookupFailedTitles>0&&y($)})}var pe=i(ae,2);{var ye=y=>{var m=Fs(),H=s(m);a(m),O(()=>w(H,`‚Ä¢ ${t.partialGroupMatchesCount??""} chapter${t.partialGroupMatchesCount===1?"":"s"} with
					partial group match (matched 1 group, assigned all groups for release)`)),u(y,m)};x(pe,y=>{t.partialGroupMatchesCount>0&&y(ye)})}var we=i(pe,2);{var me=y=>{var m=ks(),H=s(m);a(m),O(()=>w(H,`‚Ä¢ ${t.chaptersWithNoGroups??""} chapter${t.chaptersWithNoGroups===1?"":"s"} with no groups
					assigned`)),u(y,m)};x(we,y=>{t.chaptersWithNoGroups>0&&y(me)})}var ge=i(we,2);{var Z=y=>{var m=Ls(),H=s(m);a(m),O(()=>w(H,`‚Ä¢ ${t.chaptersWithNoValidGroups??""} chapter${t.chaptersWithNoValidGroups===1?"":"s"} with
					no valid groups found`)),u(y,m)};x(ge,y=>{t.chaptersWithNoValidGroups>0&&y(Z)})}var K=i(ge,2);{var R=y=>{var m=Ms(),H=s(m);a(m),O(()=>w(H,`‚Ä¢ ${t.chaptersWithNoChapterInfo??""} chapter${t.chaptersWithNoChapterInfo===1?"":"s"} not
					found in chapter dump`)),u(y,m)};x(K,y=>{t.chaptersWithNoChapterInfo>0&&y(R)})}var se=i(K,2);{var ve=y=>{var m=Ws(),H=s(m);a(m),O(()=>w(H,`‚Ä¢ ${t.chaptersWithVolumeMismatch??""} chapter${t.chaptersWithVolumeMismatch===1?"":"s"} with
					volume mismatch (volume corrected)`)),u(y,m)};x(se,y=>{t.chaptersWithVolumeMismatch>0&&y(ve)})}a(J),a(N),O(()=>Fe(N,1,`uno-th3lk3 ${o()??""}`)),u(l,N)};x(h,l=>{t.processingStep===M.READY_WARNING&&l(I)})}u(be,r),tt()}var Zs=v('<div class="uno-4vtap6"><div class="uno-2b5jsa"><div class="uno-odv1cq"><p class="uno-mum1sz"> </p></div> <p class="uno-8gw4qb">Matched group: <span class="uno-ln01bh"> </span> </p></div></div>'),Vs=v(`<div><div class="uno-qqu7xf"><p class="uno-wox1hl"> </p> <p class="uno-yk3blt">The following chapters matched only 1 group from the source, but the release has
				multiple groups. All groups for the release have been assigned automatically.</p></div> <div class="uno-4fudli"></div></div>`);function Us(be,t){et(t,!0);let o=qe(t,"class",3,"");var r=Me(),h=De(r);{var I=l=>{var N=Vs(),S=s(N),L=s(S),X=s(L);a(L),dt(2),a(S);var J=i(S,2);He(J,21,()=>t.partialGroupMatches,Xe,(q,re)=>{let Q=()=>e(re).chapter,E=()=>e(re).matchedGroup,z=()=>e(re).allGroups;var ie=Zs(),ae=s(ie),$=s(ae),pe=s($),ye=s(pe);a(pe),a($);var we=i($,2),me=i(s(we)),ge=s(me,!0);a(me);var Z=i(me);a(we),a(ae),a(ie),O(K=>{w(ye,`Vol. ${Q().chapterVolume??"N/A"??""} Ch. ${Q().chapterNumber??"N/A"??""} - ${(Q().chapterTitle||Q().originalFolderPath||"Untitled")??""}`),w(ge,E()),w(Z,` | Assigned all
							groups: ${K??""}`)},[()=>z().join(", ")]),u(q,ie)}),a(J),a(N),O(()=>{Fe(N,1,`uno-ppslzy ${o()??""}`),w(X,`‚ö†Ô∏è Warning: ${t.partialGroupMatches.length??""} chapter${t.partialGroupMatches.length===1?"":"s"} with partial group match`)}),u(l,N)};x(h,l=>{t.partialGroupMatches.length>0&&l(I)})}u(be,r),tt()}var js=v('<span class="uno-n7jei2">Removed</span>'),qs=v('<div class="uno-4s4v5p"></div>'),Bs=v('<div class="uno-l2wi0s"></div>'),Ys=v('<div><div class="uno-sjk4st"><div class="uno-7w2kl9"><p class="uno-xwb9bu"> </p> <!></div> <p class="uno-van4zu"> </p></div> <button type="button"><!></button></div>'),Hs=v(`<div><div class="uno-6i8q4z"><div class="uno-j3nx8a"><p class="uno-5p4ous"> </p> <p class="uno-wsi2l8">The following chapters already exist on WeebDex with matching groups. You can mark
					them as removed to skip uploading.</p></div> <button type="button" class="uno-ftnnd4" title="Mark all duplicate chapters as removed">Removed duplicate chapters</button></div> <div class="uno-v098o1"></div></div>`);function Xs(be,t){et(t,!0);let o=qe(t,"class",3,"");var r=Me(),h=De(r);{var I=l=>{var N=Hs(),S=s(N),L=s(S),X=s(L),J=s(X);a(X),dt(2),a(L);var q=i(L,2);q.__click=function(...Q){t.onMarkAllRemoved?.apply(this,Q)},a(S);var re=i(S,2);He(re,21,()=>t.duplicateChapters,Xe,(Q,E)=>{let z=()=>e(E).chapter,ie=()=>e(E).existingGroups;var ae=Ys(),$=s(ae),pe=s($),ye=s(pe),we=s(ye);a(ye);var me=i(ye,2);{var ge=m=>{var H=js();u(m,H)};x(me,m=>{z().isDeleted&&m(ge)})}a(pe);var Z=i(pe,2),K=s(Z);a(Z),a($);var R=i($,2);R.__click=()=>t.onToggleRemoved(z());var se=s(R);{var ve=m=>{var H=qs();u(m,H)},y=m=>{var H=Bs();u(m,H)};x(se,m=>{z().isDeleted?m(ve):m(y,!1)})}a(R),a(ae),O(m=>{Fe(ae,1,`uno-dtx7bh ${z().isDeleted?"uno-4fnq3q":""}`),w(we,`Vol. ${z().chapterVolume??"N/A"??""} Ch. ${z().chapterNumber??"N/A"??""} - ${(z().chapterTitle||z().originalFolderPath||"Untitled")??""}`),w(K,`Existing groups: ${m??""}`),Fe(R,1,`uno-rt9zmx ${z().isDeleted?"uno-p6q3jv":"uno-8e0in3"}`),ht(R,"title",z().isDeleted?"Restore chapter":"Mark as removed")},[()=>ie().join(", ")]),u(Q,ae)}),a(re),a(N),O(()=>{Fe(N,1,`uno-taxi8p ${o()??""}`),w(J,`‚ö†Ô∏è Warning: ${t.duplicateChapters.length??""} duplicate chapter${t.duplicateChapters.length===1?"":"s"} detected`)}),u(l,N)};x(h,l=>{t.duplicateChapters.length>0&&l(I)})}u(be,r),tt()}nt(["click"]);var Js=v('<span class="uno-lzl9l3 svelte-m4i47p">Removed</span>'),Ks=v('<button type="button" class="uno-lj049g svelte-m4i47p" title="Edit volume and chapter" aria-label="Edit volume and chapter"><div class="uno-smkhzc svelte-m4i47p"></div></button>'),Qs=v('<div class="uno-7qt2lg svelte-m4i47p"><div class="uno-m5mbjf svelte-m4i47p"></div> <span class="svelte-m4i47p">Restore</span></div>'),$s=v('<div class="uno-7qt2lg svelte-m4i47p"><div class="uno-9z7ooq svelte-m4i47p"></div> <span class="svelte-m4i47p">Remove</span></div>'),er=v('<span class="uno-2et217 svelte-m4i47p"> </span>'),tr=v('<div class="uno-v66o3i svelte-m4i47p"><span class="uno-bwkz4u svelte-m4i47p">‚ö†Ô∏è</span> <span class="uno-bwkz4u svelte-m4i47p"> </span></div>'),ar=v('<div class="uno-5omaek svelte-m4i47p"></div>'),sr=v('<div class="uno-58lieu svelte-m4i47p">Loading combinations...</div>'),rr=v('<div class="uno-58lieu svelte-m4i47p">No volume/chapter combinations available</div>'),nr=v('<button type="button"><div class="uno-l6o6ga svelte-m4i47p"><span class="svelte-m4i47p"> </span></div></button>'),or=v('<div class="uno-iqadiw svelte-m4i47p" role="presentation"><div class="uno-k7cjbm svelte-m4i47p"><!></div></div>'),ir=v('<div><div class="uno-rzokcw svelte-m4i47p"><div class="uno-n4d6p5 svelte-m4i47p"><span class="uno-upv063 svelte-m4i47p"> </span> <!> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Vol:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Ch:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div> <!> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Pages:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div></div> <button type="button"><!></button></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Title:</span> <div class="uno-aqzn48 svelte-m4i47p"><!> <!></div></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Groups:</span> <!></div> <div class="uno-v66o3i svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Path:</span> <span class="uno-1bjyzi svelte-m4i47p"> </span></div> <!></div> <!>',1);function lr(be,t){et(t,!0);const o=pt(Gt);if(!o)throw new Error("GuidedChapterEditor must be used within a component that provides TargetingState context");let r=qe(t,"chapter",7),h=qe(t,"class",3,""),I=qe(t,"hasWarning",3,!1),l=qe(t,"warningText",3,null),N=W(!1),S=W(Ke([])),L=W(!1),X=W(null),J=W(null),q=W(null),re=W(null),Q=W(null);function E(){r().isDeleted=!r().isDeleted}async function z(){if(!e(N)){e(X)&&c(re,e(X).getBoundingClientRect(),!0),c(N,!0),c(L,!0);try{const p=r().associatedSeries?.seriesId;if(!p){console.warn("No series ID available for chapter"),c(N,!1);return}await yt.load(),c(S,await yt.getUniqueVolumeChapterCombinations(p),!0),c(Q,ye(),!0)}catch(p){console.error("Failed to load volume/chapter combinations:",p)}finally{c(L,!1)}}}function ie(){c(N,!1),c(q,null),c(re,null),c(Q,null)}function ae(p,b){const F=b?.includes("[no group]")??!1;if(b&&!F){const d=Ut.findGroupInString(p,b);if(d){const f=p.groupTitles[d.primaryName];if(f&&f.trim()!=="")return f}}if(F&&p.ungroupedTitles.length>0||p.ungroupedTitles.length>0)return p.ungroupedTitles[0];const n=Object.keys(p.groupTitles);return n.length>0?p.groupTitles[n[0]]:null}function $(p){r().manuallyEditedFields.has("volume")||(r().originalFieldValues.has("volume")||r().originalFieldValues.set("volume",r().chapterVolume),r().manuallyEditedFields.add("volume")),r().manuallyEditedFields.has("chapter")||(r().originalFieldValues.has("chapter")||r().originalFieldValues.set("chapter",r().chapterNumber),r().manuallyEditedFields.add("chapter")),r().manuallyEditedFields.has("title")||(r().originalFieldValues.has("title")||r().originalFieldValues.set("title",r().chapterTitle),r().manuallyEditedFields.add("title")),r().chapterVolume=p.volume||null,r().chapterNumber=p.chapter||null,r().chapterTitle=ae(p.info,r().originalFolderPath),ie()}function pe(p){const b=p.volume||"N/A",F=p.chapter||"N/A",n=ae(p.info,r().originalFolderPath),d=n?` - ${n}`:"",f=p.info.groups.length>0?` [${ba.formatGroups(p.info.groups)}]`:"";return`Vol ${b}, Ch ${F}${d}${f}`}function ye(){if(e(S).length===0)return null;const p=r().associatedGroup.groupIds??[],b=new Map;for(const n of o.availableScanGroups)b.set(n.groupId,n.groupName);const F=p.map(n=>b.get(n)).filter(n=>n!==void 0);return Vt.findBestMatchingCombinationIndex(e(S),r().chapterVolume,r().chapterNumber,F)}function we(){if(!e(J)||e(Q)===null)return;const p=e(Q);requestAnimationFrame(()=>{const b=e(J)?.querySelectorAll("button[data-combination-index]");b&&p!==null&&b[p]&&b[p].scrollIntoView({behavior:"auto",block:"center"})})}function me(){if(!e(re))return;const p=e(re),b=window.innerHeight,F=window.innerWidth,n=4,d=256;let f=d;if(e(J)){const Ee=e(J).getBoundingClientRect().height;f=Math.min(Ee,d)}const D=b-p.bottom-n,T=p.top-n,G=D<d&&T>D;let g;G?(g=p.top-f-n,g<n&&(g=n)):(g=p.bottom+n,g+f>b&&(g=Math.max(n,b-f-n)));let k=p.left;const oe=320,Ve=Math.min(400,F-n*2),Ae=Math.max(oe,Math.min(Ve,p.width));k+Ae>F-n&&(k=F-Ae-n),k<n&&(k=n),c(q,{top:g,left:k,width:Ae},!0)}Ye(()=>{if(e(N)){if(!e(re)){c(q,null);return}requestAnimationFrame(()=>{requestAnimationFrame(()=>{me()})});const p=()=>me(),b=n=>{const d=n.target;e(J)&&!e(J).contains(d)&&e(X)&&!e(X).contains(d)&&ie()},F=setTimeout(()=>{window.addEventListener("resize",p),document.addEventListener("click",b,!0)},10);return()=>{clearTimeout(F),window.removeEventListener("resize",p),document.removeEventListener("click",b,!0)}}else c(q,null)}),Ye(()=>{e(N)&&e(J)&&requestAnimationFrame(()=>{me()})}),Ye(()=>{if(e(N)&&!e(L)&&e(S).length>0&&e(Q)!==null){const p=setTimeout(()=>{we()},100);return()=>clearTimeout(p)}});var ge=ir(),Z=De(ge),K=s(Z),R=s(K),se=s(R),ve=s(se);a(se);var y=i(se,2);{var m=p=>{var b=Js();u(p,b)};x(y,p=>{r().isDeleted&&p(m)})}var H=i(y,2),xe=i(s(H),2),_=s(xe,!0);a(xe),a(H);var P=i(H,2),ee=i(s(P),2),le=s(ee,!0);a(ee),a(P);var Se=i(P,2);{var he=p=>{var b=Ks();b.__click=F=>{F.stopPropagation(),z()},_t(b,F=>c(X,F),()=>e(X)),u(p,b)};x(Se,p=>{r().associatedSeries?.seriesId&&p(he)})}var Ce=i(Se,2),We=i(s(Ce),2),ke=s(We,!0);a(We),a(Ce),a(R);var Le=i(R,2);Le.__click=E;var Ze=s(Le);{var Ne=p=>{var b=Qs();u(p,b)},je=p=>{var b=$s();u(p,b)};x(Ze,p=>{r().isDeleted?p(Ne):p(je,!1)})}a(Le),a(K);var Qe=i(K,2),V=i(s(Qe),2),te=s(V);fa(te,{textClass:"text-sm text-app font-medium",fieldName:"title",get chapter(){return r()},get value(){return r().chapterTitle},set value(p){r().chapterTitle=p}});var _e=i(te,2);{var ue=p=>{var b=er(),F=s(b);a(b),O(()=>w(F,`(${(r().originalFolderPath||"Untitled")??""})`)),u(p,b)};x(_e,p=>{r().chapterTitle||p(ue)})}a(V),a(Qe);var Y=i(Qe,2),B=i(s(Y),2);ma(B,{fieldName:"groups",get chapter(){return r()},get groups(){return r().associatedGroup},set groups(p){r().associatedGroup=p}}),a(Y);var U=i(Y,2),ne=i(s(U),2),C=s(ne,!0);a(ne),a(U);var A=i(U,2);{var j=p=>{var b=ar();He(b,21,l,Xe,(F,n)=>{var d=tr(),f=i(s(d),2),D=s(f,!0);a(f),a(d),O(()=>w(D,e(n))),u(F,d)}),a(b),u(p,b)};x(A,p=>{I()&&l()&&l().length>0&&p(j)})}a(Z);var ce=i(Z,2);{var fe=p=>{var b=or();b.__click=D=>D.stopPropagation();var F=s(b),n=s(F);{var d=D=>{var T=sr();u(D,T)},f=D=>{var T=Me(),G=De(T);{var g=oe=>{var Ve=rr();u(oe,Ve)},k=oe=>{var Ve=Me(),Ae=De(Ve);He(Ae,17,()=>e(S),Xe,(Ee,Ie,Re,Pe)=>{const Ge=de(()=>r().chapterVolume===e(Ie).volume&&r().chapterNumber===e(Ie).chapter),Oe=de(()=>e(Q)===Re&&!e(Ge));var Te=nr();ht(Te,"data-combination-index",Re),Te.__click=()=>$(e(Ie));var Be=s(Te),Je=s(Be),$e=s(Je,!0);a(Je),a(Be),a(Te),O(it=>{Fe(Te,1,`uno-57cq3c ${e(Ge)?"uno-q0nniz":e(Oe)?"uno-79qo06":"uno-ut3eki"}`,"svelte-m4i47p"),w($e,it)},[()=>pe(e(Ie))]),u(Ee,Te)}),u(oe,Ve)};x(G,oe=>{e(S).length===0?oe(g):oe(k,!1)},!0)}u(D,T)};x(n,D=>{e(L)?D(d):D(f,!1)})}a(F),a(b),_t(b,D=>c(J,D),()=>e(J)),O(()=>_a(b,`top: ${e(q).top??""}px; left: ${e(q).left??""}px; width: ${e(q).width??""}px;`)),u(p,b)};x(ce,p=>{e(N)&&e(q)&&p(fe)})}O(()=>{Fe(Z,1,`uno-3rf4hu ${r().isDeleted?"uno-d3zfvr":I()?"uno-ctlglj":""} ${h()??""}`,"svelte-m4i47p"),w(ve,`#${t.index+1}`),w(_,r().chapterVolume??"N/A"),w(le,r().chapterNumber??"N/A"),w(ke,r().pages.length),Fe(Le,1,`uno-lto8ne ${r().isDeleted?"uno-ld06wt":"uno-far8pd"}`,"svelte-m4i47p"),ht(Le,"title",r().isDeleted?"Restore chapter":"Mark as removed"),w(C,r().originalFolderPath)}),u(be,ge),tt()}nt(["click"]);var ur=v('<label class="uno-bmx1o0"><input type="checkbox" class="uno-5batcv"/> <span class="uno-tbmxpn"> </span></label>'),cr=v('<label><input type="checkbox" class="uno-5batcv"/> <span class="uno-tf1cji"> </span></label>'),dr=v('<button type="button" class="uno-hoocn8 border-app/30 hover:bg-app/5" title="Clear warning type filter">Clear filter</button>'),pr=v('<p class="uno-yid3fu"> </p>'),vr=v('<div class="uno-jgbjl6"><div class="uno-uj5buu"><span class="uno-yid3fu">Filter by warning type:</span> <!> <!></div> <!></div>'),gr=v('<p class="uno-mrqm4a"><!></p>'),hr=v('<div><div class="uno-jgbjl6"><div class="uno-obx9be"><h3 class="uno-rbmvnf"> </h3> <!></div> <!></div> <div class="uno-p3sz26"><!></div></div>');function fr(be,t){et(t,!0);const o={[Ue.NO_GROUPS]:"No Groups",[Ue.NO_VALID_GROUPS]:"No Valid Groups",[Ue.NO_CHAPTER_INFO]:"No Chapter Info",[Ue.NO_MATCHING_GROUP]:"No Matching Group",[Ue.VOLUME_MISMATCH]:"Volume Mismatch",[Ue.PARTIAL_GROUP_MATCH]:"Partial Group Match",[Ue.TITLE_RESOLUTION_NOT_FOUND]:"Title Resolution Not Found",[Ue.DUPLICATE_CHAPTER]:"Duplicate Chapter"},r=Object.values(Ue);let h=qe(t,"showOnlyWarnings",15,!1),I=qe(t,"class",3,""),l=W(Ke(new Set));Ye(()=>{h()||c(l,new Set,!0)});function N(Z){e(l).has(Z)?e(l).delete(Z):e(l).add(Z),c(l,new Set(e(l)),!0)}function S(){c(l,new Set,!0)}function L(Z){if(!h()&&e(l).size===0)return!0;if(h()&&e(l).size===0)return t.chapterHasWarning(Z);if(e(l).size>0){const K=t.getChapterWarningReasons(Z);return!K||K.length===0?!1:K.some(R=>e(l).has(R))}return!0}const X=de(()=>t.chapters.filter((Z,K)=>L(K))),J=de(()=>()=>{const Z=new Map;return t.chapters.forEach((K,R)=>{const se=t.getChapterWarningReasons(R);se&&se.forEach(ve=>{Z.set(ve,(Z.get(ve)||0)+1)})}),Z});var q=hr(),re=s(q),Q=s(re),E=s(Q),z=s(E);a(E);var ie=i(E,2);{var ae=Z=>{var K=ur(),R=s(K);mt(R);var se=i(R,2),ve=s(se);a(se),a(K),O(()=>w(ve,`Show only warnings (${t.chaptersWithWarningsCount??""})`)),ya(R,h),u(Z,K)};x(ie,Z=>{t.chaptersWithWarningsCount>0&&Z(ae)})}a(Q);var $=i(Q,2);{var pe=Z=>{var K=vr(),R=s(K),se=i(s(R),2);He(se,17,()=>r,Xe,(xe,_)=>{const P=de(()=>e(J)().get(e(_))||0);var ee=Me(),le=De(ee);{var Se=he=>{var Ce=cr(),We=s(Ce);mt(We),We.__change=()=>N(e(_));var ke=i(We,2),Le=s(ke);a(ke),a(Ce),O((Ze,Ne)=>{Fe(Ce,1,`uno-56qn75 border-app/30 hover:bg-app/5 ${Ze??""}`),bt(We,Ne),w(Le,`${o[e(_)]??""} (${e(P)??""})`)},[()=>e(l).has(e(_))?"bg-primary/20 border-primary":"",()=>e(l).has(e(_))]),u(he,Ce)};x(le,he=>{e(P)>0&&he(Se)})}u(xe,ee)});var ve=i(se,2);{var y=xe=>{var _=dr();_.__click=S,u(xe,_)};x(ve,xe=>{e(l).size>0&&xe(y)})}a(R);var m=i(R,2);{var H=xe=>{var _=pr(),P=s(_);a(_),O(ee=>w(P,`Showing ${e(X).length??""} chapter${e(X).length===1?"":"s"} with:
						${ee??""}`),[()=>Array.from(e(l)).map(ee=>o[ee]).join(", ")]),u(xe,_)};x(m,xe=>{e(l).size>0&&xe(H)})}a(K),u(Z,K)};x($,Z=>{h()&&t.chaptersWithWarningsCount>0&&Z(pe)})}a(re);var ye=i(re,2),we=s(ye);{var me=Z=>{var K=gr(),R=s(K);{var se=y=>{var m=Tt("No chapters with selected warning types to display");u(y,m)},ve=y=>{var m=Tt("No chapters with warnings to display");u(y,m)};x(R,y=>{e(l).size>0?y(se):y(ve,!1)})}a(K),u(Z,K)},ge=Z=>{var K=Me(),R=De(K);He(R,17,()=>e(X),Xe,(se,ve)=>{const y=de(()=>t.chapters.indexOf(e(ve)));{let m=de(()=>t.chapterHasWarning(e(y))),H=de(()=>t.getChapterWarningText(e(y)));lr(se,{get index(){return e(y)},get chapter(){return e(ve)},get hasWarning(){return e(m)},get warningText(){return e(H)}})}}),u(Z,K)};x(we,Z=>{e(X).length===0&&(h()||e(l).size>0)?Z(me):Z(ge,!1)})}a(ye),a(q),O(()=>{Fe(q,1,`uno-jgbjl6 ${I()??""}`),w(z,`Detected Chapters (${t.chapters.length??""})`)}),u(be,q),tt()}nt(["change","click"]);var mr=v('<p class="uno-8520et"> </p>'),_r=v('<div class="uno-vsugad"><div class="uno-pj4440"></div> <p class="uno-hw2z5w"> </p> <!></div>'),br=v(`<div class="uno-hemz07"><div class="uno-ns83sq"><p class="uno-0zsd1s"> </p></div> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Series Selection (Required)</h3> <!> <!> <!></div> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Group Selection</h3> <p class="uno-hw2z5w">Groups are automatically loaded from the chapter dump. You can manually add additional
					groups here if needed.</p> <!> <!></div> <!> <!> <!> <!> <!> <button type="button" class="uno-d93lfx"> </button></div>`),yr=v('<div class="uno-6nb6x4"><p class="uno-dillda">‚úì Upload completed successfully!</p></div>'),Ir=v('<div><h2 class="uno-67n1yz"> </h2> <!></div>');function wr(be,t){et(t,!0),ta({useWebWorkers:!1});let o=qe(t,"class",3,"");const r=new Ia;ft(Gt,r);const h=pt(jt);if(!h)throw new Error("MangaProcessor must be used within a component that provides ApiAuthContext");const I=pt(Rt);let l=W(Ke(M.LOADING)),N=W(null),S=W(Ke([])),L=W(!1),X=W(null),J=W(null),q=W(null),re=W(!1),Q=W(Ke([])),E=W(Ke(new ot)),z=W(!1);const ie=["jpg","jpeg","png","gif","webp","cbz","zip","xml"],ae={DUPLICATE_CHAPTER:n=>`Duplicate chapter: A chapter with the same volume and chapter number already exists with groups: ${n.length>0?n.join(", "):"Unknown groups"}`},$={[M.LOADING]:"Loading manga folder...",[M.EXTRACTING]:"Extracting zip files...",[M.SERIES_LOOKUP]:"Looking up series ID...",[M.APPLYING_REGEX]:"Applying regex patterns...",[M.CHAPTER_LOOKUP]:"Loading chapter dump...",[M.LOADING_GROUPS]:"Loading groups...",[M.APPLYING_GROUPS]:"Applying groups to chapters...",[M.APPLYING_TITLES]:"Applying changes from dump...",[M.READY]:"",[M.READY_WARNING]:"",[M.UPLOADING]:"",[M.COMPLETED]:""},pe=n=>Da.isNoGroupPath(n.originalFolderPath);Ye(()=>{t.zipFile&&(c(q,null),c(re,!1),c(Q,[],!0),c(E,new ot,!0),ye())});async function ye(){try{if(await ge(),await Z(),!r.seriesId){c(l,M.READY_WARNING,!0);return}c(l,M.APPLYING_REGEX,!0),await K(),await R(),await se(),await ve(),await xe(),Ne()?c(l,M.READY_WARNING,!0):c(l,M.READY,!0)}catch(n){console.error("Error in processing pipeline:",n),t.guidedState.setZipStatus(t.zipFile,ze.ERROR),c(l,M.READY_WARNING,!0),t.onProcessingComplete("error")}}async function we(n){const d=n.name.split(".").pop()?.toLowerCase();if(!(d==="cbz")&&!(d==="zip"))throw new Error(`Unsupported archive format: ${d}`);console.log(`Extracting ${d} file:`,n.name);const T=new aa(new sa(n)),G=await T.getEntries(),g=[],k=n.name.replace(/\.(cbz|zip)$/i,""),oe=n.webkitRelativePath||n.name,Ve=G.filter(Ie=>{if(!Ie.filename||Ie.directory)return!1;const Re=Ie.filename.split(".").pop()?.toLowerCase();return Re&&ie.includes(Re)}),Ae=Ve.length;let Ee=0;for(const Ie of Ve){Ee++;const Re=Ie.filename,Pe=Re.split("/").pop()??Re;c(X,`${Re} (${Ee} / ${Ae})`);const Ge=Re.split(".").pop()?.toLowerCase()??"";if(Ie.directory)continue;const Oe=new TransformStream,Te=new Response(Oe.readable).blob();await Ie.getData(Oe.writable);let Be=await Te;if(!Be.type){const it=me(Ge);Be=new Blob([Be],{type:it})}const Je=oe.includes("/")?`${oe.split("/").slice(0,-1).join("/")}/${k}/${Re}`:`${k}/${Re}`,$e=new File([Be],Pe,{type:Be.type});Object.defineProperty($e,"webkitRelativePath",{value:Je,writable:!1,enumerable:!0,configurable:!0}),g.push($e)}return await T.close(),c(X,null),g}function me(n){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp"}[n]||"application/octet-stream"}async function ge(){c(l,M.LOADING,!0),r.reset(),c(l,M.EXTRACTING,!0);let n=[];try{n=await we(t.zipFile)}catch(f){throw console.error(`Error extracting ${t.zipFile.name}:`,f),f}c(N,wa(n),!0);const d=qa(e(N));c(S,await Promise.all(d.map(async f=>{const D=Ba(f.name),T=Ya(f.name),G=f.files.filter(g=>g.type===xa.CHAPTER_PAGE).map((g,k)=>new Sa(g.file.name,k,g.file,Ca.NOT_STARTED,0,null,null,!1,g.type));return new Na(f.path,null,D,T,new Ft,new Aa,G,Ct.NOT_STARTED,0,null,null,f,!1,"en")})),!0),e(S).sort((f,D)=>{if(f.chapterVolume&&D.chapterVolume){const T=String(f.chapterVolume).localeCompare(String(D.chapterVolume),void 0,{numeric:!0,sensitivity:"base"});if(T!==0)return T}else{if(f.chapterVolume)return-1;if(D.chapterVolume)return 1}return f.chapterNumber&&D.chapterNumber?String(f.chapterNumber).localeCompare(String(D.chapterNumber),void 0,{numeric:!0,sensitivity:"base"}):f.chapterNumber?-1:D.chapterNumber?1:0}),r.chapterStates=e(S)}async function Z(){c(l,M.SERIES_LOOKUP,!0);const n=Et(t.zipFile.name);if(n)try{await ut.load();const d=await ut.getWeebdexIdFromLegacyId(n);d?(r.seriesId=d,console.log(`Auto-detected series ID from MD-####: ${n} -> ${d}`)):console.log(`No WeebDex ID found for MangaDex ID: ${n}`)}catch(d){console.warn(`Failed to lookup WeebDex ID for MangaDex ID ${n}:`,d)}r.seriesId&&r.chapterStates.forEach(d=>{d.associatedSeries||(d.associatedSeries=new Ft),d.associatedSeries.seriesId=r.seriesId??""})}async function K(){c(l,M.CHAPTER_LOOKUP,!0),r.seriesId&&await yt.load()}async function R(){if(c(l,M.LOADING_GROUPS,!0),!r.seriesId)return;if(!await yt.hasSeriesEntries(r.seriesId)){console.warn("No entries found in chapter dump for this series"),c(re,!0);return}const d=await Ut.getSeriesGroups(r.seriesId);if(d.length===0){console.log("No groups found in chapter dump, but series has entries (likely all ungrouped)"),r.availableScanGroups=[];return}const f=[],D=[];for(const T of d)try{const G=await Ea(T.primaryName);if(G.data){const g=G.data.find(k=>Vt.groupMatches(T,k.name));if(g){const k=new Ra;k.groupId=g.id,k.groupName=g.name,f.push(k)}else D.push(T.primaryName)}else D.push(T.primaryName)}catch(G){console.warn(`Failed to lookup group "${T.primaryName}":`,G),D.push(T.primaryName)}c(Q,D,!0),D.length>0&&c(re,!0),r.availableScanGroups=f}async function se(){c(l,M.APPLYING_GROUPS,!0),await m()}async function ve(){if(c(l,M.APPLYING_TITLES,!0),!r.seriesId)return;await H()>0&&c(re,!0)}Ye(()=>{r.seriesId&&(e(l)===M.READY||e(l)===M.READY_WARNING)&&r.seriesId!==e(q)&&(c(q,r.seriesId,!0),y())});async function y(){try{if(await Z(),!r.seriesId)return;c(l,M.APPLYING_REGEX,!0),await K(),await R(),await se(),await ve(),await xe(),Ne()?c(l,M.READY_WARNING,!0):c(l,M.READY,!0)}catch(n){console.error("Error in processing pipeline:",n),c(l,M.READY_WARNING,!0)}}async function m(){r.seriesId&&await kt.applyGroupsToChapters(r.chapterStates,r.availableScanGroups,r.seriesId)}async function H(){if(!r.seriesId)return 0;const n=r.seriesId,d=new Map,f=new Map;for(let g=0;g<r.chapterStates.length;g++){const k=r.chapterStates[g];d.set(g,k),f.set(g,k.chapterVolume)}const D=r.chapterStates.map(g=>{const k=g.chapterTitle===void 0||g.chapterTitle===null||g.chapterTitle===""?null:g.chapterTitle;return{chapterVolume:g.chapterVolume,chapterNumber:g.chapterNumber,originalFolderPath:g.originalFolderPath,groupIds:g.associatedGroup.groupIds??[],currentTitle:k}}),T=new Map;for(let g=0;g<D.length;g++)T.set(D[g],g);const G=await kt.applyChangesFromDump(D,r.availableScanGroups,n,{useFallbackMatching:!0,isNoGroupChapter:g=>{const k=T.get(g);if(k===void 0)return!1;const oe=d.get(k);return oe?pe(oe):!1}});for(let g=0;g<G.results.length;g++){const k=G.results[g],oe=d.get(g);if(!oe)continue;const Ae=(e(E).get(g)??[]).filter(Ie=>Ie.reason===Ue.DUPLICATE_CHAPTER);if((k.status===Lt.SUCCESS||k.status===Lt.NO_CHANGES)&&k.changes){const{volume:Ie,title:Re,additionalGroupIds:Pe}=k.changes;if(Ie!==void 0){const Ge=f.get(g)??oe.chapterVolume;oe.chapterVolume=Ie,k.resolutionResult?.usedFallback&&(oe.manuallyEditedFields.has("volume")||(oe.originalFieldValues.has("volume")||oe.originalFieldValues.set("volume",Ge),oe.manuallyEditedFields.add("volume")))}if(Re!==void 0&&(oe.chapterTitle=Re),Pe.length>0){const Ge=new Zt(oe.associatedGroup.groupIds??[]);for(const Oe of Pe)Ge.add(Oe);oe.associatedGroup.groupIds=Array.from(Ge)}}const Ee=[...Ae,...k.warnings];Ee.length>0?e(E).set(g,Ee):e(E).delete(g)}return G.failedCount}async function xe(){if(r.seriesId)try{const n=await Ga(r.seriesId),d=new Map;for(const G of n.chapters){const g=G.volume||"none",k=G.chapter||"none",oe=`${g}:${k}`;d.set(oe,G)}const f=G=>{if(!n.groups)return!1;for(const g of G){const k=n.groups[g];if(k&&k.name==="No Group"&&!k.id)return!0}return!1},D=G=>{const g=new Set;if(n.groups)for(const k of G){const oe=n.groups[k];oe&&oe.id&&g.add(oe.id)}return g},T=(G,g,k)=>{if(G.size===0)return k&&g.size===0;if(k)return!1;for(const oe of G)if(g.has(oe))return!0;return!1};for(let G=0;G<r.chapterStates.length;G++){const g=r.chapterStates[G],k=g.chapterVolume||"none",oe=g.chapterNumber||"none",Ve=`${k}:${oe}`,Ae=d.get(Ve),Ie=(e(E).get(G)??[]).filter(Re=>Re.reason!==Ue.DUPLICATE_CHAPTER);if(Ae&&Ae.entries&&Object.keys(Ae.entries).length>0){const Re=new Set(g.associatedGroup.groupIds??[]);let Pe=null;for(const Ge of Object.values(Ae.entries)){const Oe=D(Ge.groups),Te=f(Ge.groups);if(T(Re,Oe,Te)){Pe=Ge;break}}if(Pe){const Ge=D(Pe.groups),Oe=f(Pe.groups),Te=[];Oe&&Te.push("No Group");for(const Be of Ge){const Je=n.groups?.find($e=>$e.id===Be);Je?Te.push(`${Je.name} (${Je.id})`):Te.push(`Unknown Group (${Be})`)}Ie.push({reason:Ue.DUPLICATE_CHAPTER,note:ae.DUPLICATE_CHAPTER(Te.length>0?Te:["Unknown groups"])})}}Ie.length>0?e(E).set(G,Ie):e(E).delete(G)}}catch(n){console.error("Error checking for duplicates:",n)}}function _(n){if(e(l)!==M.UPLOADING)return;c(l,M.COMPLETED,!0);const d=n?"success":"error";t.guidedState.setZipStatus(t.zipFile,n?ze.COMPLETED:ze.ERROR),n&&r.seriesId?t.onProcessingComplete(d,r.seriesId):t.onProcessingComplete(d)}function P(n){const d=n.note.match(/groups: (.+)$/);return d?d[1].split(", ").filter(f=>f!=="Unknown groups"):[]}function ee(n){const d=n.note.match(/Matched "(.+?)" but release has \d+ groups: (.+)$/);return d?{matchedGroup:d[1],allGroups:d[2].split(", ")}:null}const le=de(()=>e(S).map((n,d)=>{const D=(e(E).get(d)??[]).find(T=>T.note.includes("Duplicate chapter:"));return D?{chapter:n,existingGroups:P(D)}:null}).filter(n=>n!==null)),Se=de(()=>e(S).map((n,d)=>{const D=(e(E).get(d)??[]).find(T=>T.reason===Ue.PARTIAL_GROUP_MATCH);if(D){const T=ee(D);if(T)return{chapter:n,matchedGroup:T.matchedGroup,allGroups:T.allGroups}}return null}).filter(n=>n!==null)),he=de(()=>Array.from(e(E).values()).filter(n=>n.some(d=>d.reason===Ue.TITLE_RESOLUTION_NOT_FOUND)).length),Ce=de(()=>Array.from(e(E).values()).filter(n=>n.some(d=>d.reason===Ue.NO_GROUPS)).length),We=de(()=>Array.from(e(E).values()).filter(n=>n.some(d=>d.reason===Ue.NO_VALID_GROUPS)).length),ke=de(()=>Array.from(e(E).values()).filter(n=>n.some(d=>d.reason===Ue.NO_CHAPTER_INFO)).length),Le=de(()=>Array.from(e(E).values()).filter(n=>n.some(d=>d.reason===Ue.VOLUME_MISMATCH)).length);function Ze(){const n=e(he)>0||e(Q).length>0;e(re)!==n&&c(re,n,!0)}function Ne(){let n=!1;for(const[d,f]of e(E))if(f.length>0){n=!0;break}return n||e(le).length>0||e(re)||e(Q).length>0||e(he)>0||e(Se).length>0}function je(n){return e(E).has(n)&&(e(E).get(n)?.length??0)>0}async function Qe(){r.seriesId&&(await m(),await H(),await xe())}function V(n){const d=e(E).get(n);return!d||d.length===0?null:d.map(f=>f.note)}function te(n){const d=e(E).get(n);return!d||d.length===0?null:d.map(f=>f.reason)}function _e(){return{hasDuplicates:e(le).length>0,duplicateCount:e(le).length,dumpLookupFailed:e(re),failedGroups:e(Q).length,failedTitles:e(he),partialGroupMatches:e(Se).length}}function ue(){return e(l)===M.READY&&(e(q)===r.seriesId||!r.seriesId)}Ye(()=>{if(!I?.isActive)return;const d=e(l),f=r.seriesId,D=e(q),T=d===M.READY||d===M.READY_WARNING;if(!T)return;console.log("Automation: Effect triggered, checking state",{step:d,seriesId:f,lastSeriesId:D,shouldCheck:T});const G=setTimeout(()=>{Y()},500);return()=>clearTimeout(G)});async function Y(){if(!I?.isActive){console.log("Automation: Not active");return}if(e(l)===M.READY_WARNING){console.log("Automation: READY_WARNING state detected, marking as warning and skipping"),t.guidedState.setZipStatus(t.zipFile,ze.WARNING),t.onProcessingComplete("warning");return}if(!ue()){console.log("Automation: Not ready",{step:e(l),seriesId:r.seriesId,lastProcessedSeriesId:e(q)});return}console.log("Automation: Checking zip file",t.zipFile.name);const n=t.guidedState.pendingZips,d=t.guidedState.warningZips.length>0||t.guidedState.errorZips.length>0;if(n.length===0&&d){console.log("Automation: Disabling - only warnings/errors remain"),I.disable();return}console.log("Automation: No issues, starting upload",{canStartUpload:e(U),hasSeriesId:!!r.seriesId,nonDeletedChapters:e(ne).length}),e(U)&&r.seriesId&&e(ne).length>0?B()?console.log("Automation: Upload started successfully"):(console.warn("Automation: Failed to start upload, marking as error"),t.guidedState.setZipStatus(t.zipFile,ze.ERROR),t.onProcessingComplete("error")):(console.warn("Automation: Missing requirements for upload",{canStartUpload:e(U),hasSeriesId:!!r.seriesId,nonDeletedChapters:e(ne).length}),t.guidedState.setZipStatus(t.zipFile,ze.WARNING),t.onProcessingComplete("warning"))}function B(){return h.apiToken?r.seriesId?r.chapterStates.length===0?(alert("No chapters to upload"),!1):!e(U)||e(ne).length===0?!1:(c(l,M.UPLOADING,!0),t.guidedState.setZipStatus(t.zipFile,ze.PROCESSING),!0):(alert("Please set a series ID first"),!1):(alert("Please set up API authentication first"),!1)}Ye(()=>{if(e(l)===M.UPLOADING&&I?.isActive&&e(J)){const n=setTimeout(()=>{console.log("Automation: Triggering upload via UploaderOrchestrator"),e(J)?.startUpload()},200);return()=>clearTimeout(n)}});const U=de(()=>e(l)===M.READY||e(l)===M.READY_WARNING),ne=de(()=>e(S).filter(n=>!n.isDeleted)),C=de(()=>Array.from(e(E).values()).filter(n=>n.length>0).length);Ye(()=>{if(e(l)===M.UPLOADING&&e(J)){const n=e(J).getUploaderStatus();if(n===Pt.PAUSED){console.log("MangaProcessor: Detected PAUSED status, stopping automation"),I?.isActive&&I.disable(),t.guidedState.setZipStatus(t.zipFile,ze.ERROR),_(!1);return}if(n===Pt.STOPPED){console.log("MangaProcessor: Detected STOPPED status, stopping automation"),I?.isActive&&I.disable(),t.guidedState.setZipStatus(t.zipFile,ze.ERROR),_(!1);return}}}),Ye(()=>{if(e(l)===M.UPLOADING&&e(S).length>0){const n=e(S).every(f=>f.status===Ct.COMPLETED||f.isDeleted),d=e(S).some(f=>!f.isDeleted);if(n&&d){const D=!e(S).some(T=>!T.isDeleted&&T.status===Ct.FAILED);t.guidedState.setZipStatus(t.zipFile,D?ze.COMPLETED:ze.ERROR),_(D)}}}),Ye(()=>{const n=e(l);if(!(n!==M.READY&&n!==M.READY_WARNING)){e(E).size,e(le).length,e(Q).length,e(Se).length,e(he);for(const[d,f]of e(E)){f.length;for(const D of f);}Ze(),Ne()?c(l,M.READY_WARNING,!0):c(l,M.READY,!0)}});var A={hasIssues:Ne,chapterHasWarning:je,getChapterWarningText:V,getChapterWarningReasons:te,getIssueDetails:_e,isReady:ue,startUpload:B},j=Ir(),ce=s(j),fe=s(ce);a(ce);var p=i(ce,2);{var b=n=>{var d=_r(),f=i(s(d),2),D=s(f,!0);a(f);var T=i(f,2);{var G=g=>{var k=mr(),oe=s(k);a(k),O(()=>w(oe,`Processing: ${e(X)??""}`)),u(g,k)};x(T,g=>{e(X)&&g(G)})}a(d),O(()=>w(D,$[e(l)])),u(n,d)},F=n=>{var d=Me(),f=De(d);{var D=G=>{var g=br(),k=s(g),oe=s(k),Ve=s(oe);a(oe),a(k);var Ae=i(k,2),Ee=i(s(Ae),2);Ta(Ee,{});var Ie=i(Ee,2);ra(Ie,{});var Re=i(Ie,2);Pa(Re,{}),a(Ae);var Pe=i(Ae,2),Ge=i(s(Pe),4);na(Ge,{});var Oe=i(Ge,2);oa(Oe,{}),a(Pe);var Te=i(Pe,2);As(Te,{get chapters(){return e(S)},onGroupAssigned:Qe});var Be=i(Te,2);{let at=de(()=>!!r.seriesId);zs(Be,{get processingStep(){return e(l)},get hasSeriesId(){return e(at)},get duplicateCount(){return e(le).length},get dumpLookupFailed(){return e(re)},get dumpLookupFailedGroups(){return e(Q)},get dumpLookupFailedTitles(){return e(he)},get partialGroupMatchesCount(){return e(Se).length},get chaptersWithNoGroups(){return e(Ce)},get chaptersWithNoValidGroups(){return e(We)},get chaptersWithNoChapterInfo(){return e(ke)},get chaptersWithVolumeMismatch(){return e(Le)}})}var Je=i(Be,2);Us(Je,{get partialGroupMatches(){return e(Se)}});var $e=i(Je,2);Xs($e,{get duplicateChapters(){return e(le)},onMarkAllRemoved:()=>{for(const{chapter:at}of e(le))at.isDeleted=!0},onToggleRemoved:at=>{at.isDeleted=!at.isDeleted}});var it=i($e,2);fr(it,{get chapters(){return e(S)},get chaptersWithWarningsCount(){return e(C)},chapterHasWarning:je,getChapterWarningText:V,getChapterWarningReasons:te,get showOnlyWarnings(){return e(z)},set showOnlyWarnings(at){c(z,at,!0)}});var ct=i(it,2);ct.__click=B;var It=s(ct);a(ct),a(g),O(()=>{w(Ve,`Found ${e(S).length??""} chapter${e(S).length===1?"":"s"} from deepest folders`),ct.disabled=!e(U)||!r.seriesId||e(ne).length===0,w(It,`Start Upload (${e(ne).length??""} of ${e(S).length??""} chapters)`)}),u(G,g)},T=G=>{var g=Me(),k=De(g);{var oe=Ae=>{_t(ia(Ae,{onDone:_,get busy(){return e(L)},set busy(Ee){c(L,Ee,!0)}}),Ee=>c(J,Ee,!0),()=>e(J))},Ve=Ae=>{var Ee=Me(),Ie=De(Ee);{var Re=Pe=>{var Ge=yr();u(Pe,Ge)};x(Ie,Pe=>{e(l)===M.COMPLETED&&Pe(Re)},!0)}u(Ae,Ee)};x(k,Ae=>{e(l)===M.UPLOADING?Ae(oe):Ae(Ve,!1)},!0)}u(G,g)};x(f,G=>{e(l)===M.READY||e(l)===M.READY_WARNING?G(D):G(T,!1)},!0)}u(n,d)};x(p,n=>{e(l)===M.LOADING||e(l)===M.EXTRACTING||e(l)===M.SERIES_LOOKUP||e(l)===M.APPLYING_REGEX||e(l)===M.CHAPTER_LOOKUP||e(l)===M.LOADING_GROUPS||e(l)===M.APPLYING_GROUPS||e(l)===M.APPLYING_TITLES?n(b):n(F,!1)})}return a(j),O(()=>{Fe(j,1,`uno-hemz07 ${o()??""}`),w(fe,`Processing: ${t.zipFile.name??""}`)}),u(be,j),tt(A)}nt(["click"]);var xr=v('<span class="uno-eibvyk"></span>'),Sr=v('<span class="uno-wwd276"></span>'),Cr=v("<option> </option>"),Nr=v('<button type="button" class="uno-77n21i" title="Delete selected session">Delete Session</button>'),Ar=v('<div class="uno-4n7jiu"><div class="uno-s1ovsw"><div class="uno-xbq30h"><label for="session-selector" class="uno-q52u3c">Select Session:</label> <select id="session-selector" class="uno-ggu5iv"><option>-- Select a session --</option><!></select></div> <!></div></div>'),Er=v('<div class="uno-4n7jiu"><div class="uno-kjj903"><button type="button" class="uno-m5t56d" title="Copy CSV to clipboard">Copy CSV</button></div> <textarea readonly="" class="uno-afv8at"></textarea></div>'),Rr=v('<div class="uno-q4g9cd">Loading restored status...</div>'),Gr=v('<div class="uno-9rtpct"> </div>'),Dr=v('<span class="uno-5c220y" title="Marked as restored in spreadsheet">Restored</span>'),Tr=v('<span class="uno-p0fdl0" title="In spreadsheet but not marked as restored">In Sheet</span>'),Pr=v('<span class="uno-r3s6qi" title="Not yet in spreadsheet">Local Only</span>'),Fr=v('<div class="uno-jq88zy"><div class="uno-3f1aqr"> </div> <!> <!></div>'),kr=v('<div class="uno-18xidu"> </div>'),Lr=v('<div class="uno-ky3e2b"><div class="uno-twa61r"><!></div></div>'),Mr=v('<div class="uno-4n7jiu"><div class="uno-y8jeae"><p class="uno-q52u3c"> </p> <div class="uno-w2kq3w"><button type="button" class="uno-m5t56d" title="Copy all IDs to clipboard">Copy IDs</button> <button type="button" class="uno-m5t56d" title="Show CSV format (includes weebdex ID and legacy ID)"> </button></div></div> <!></div>'),Wr=v('<p class="uno-q4g9cd">Please select a session to view IDs</p>'),Or=v('<p class="uno-q4g9cd">No completed IDs found</p>'),zr=v('<span class="uno-q4g9cd"> </span>'),Zr=v('<div class="uno-pevota"><label for="import-text" class="uno-q52u3c">Paste legacy IDs (one per line, or CSV format):</label> <textarea id="import-text" placeholder="12345 67890 or CSV: legacy_id 12345,67890" class="uno-afv8at"></textarea> <div class="uno-pnwugo"><button type="button" class="uno-qr8ujc"> </button> <!></div></div>'),Vr=v('<div class="uno-pnwugo"><label for="view-mode" class="uno-q4g9cd">View Mode:</label> <button type="button">Per Session</button> <button type="button">All Combined</button></div> <!> <!> <div class="uno-4n7jiu"><button type="button" class="uno-6bd4j8"> </button> <!></div> <div class="uno-w2kq3w"><button type="button" class="uno-m5t56d">Refresh</button> <button type="button" class="uno-ecwkht">Clear All</button></div>',1),Ur=v('<div class="uno-5pp2az"><button type="button" class="uno-vyqybb"><span class="uno-hus6d6"><!></span> <h3 class="uno-mg3nnt">Completed WeebDex IDs</h3></button> <!></div>');function jr(be,t){et(t,!0);let o=W("per-session"),r=W(null),h=W(!1),I=W(!1),l=W(!1),N=W(""),S=W(!1),L=W(null),X=W(Ke([])),J=W(!1);const q=pt(Dt),re=de(()=>q.sessions),Q=de(()=>q.allCombinedIds),E=qt;Ye(()=>{const _=$();if(_.length===0){c(X,[],!0);return}c(J,!0),Promise.all(_.map(async P=>{const ee=P.weebdexId?await E.isRestoredByWeebdexId(P.weebdexId):P.legacyId?await E.isRestoredByLegacyId(P.legacyId):!1,le=P.weebdexId?await E.existsInSpreadsheet(P.weebdexId):P.legacyId?await E.existsInSpreadsheetByLegacyId(P.legacyId):!1;return{entry:P,isRestored:ee,inSpreadsheet:le}})).then(P=>{c(X,P,!0),c(J,!1)})});function z(_){if(_.startsWith("imported-")){const P=_.replace("imported-",""),ee=Number.parseInt(P,10);if(!Number.isNaN(ee))try{return`Imported: ${new Date(ee).toLocaleString()}`}catch{return _}return _}try{return new Date(_).toLocaleString()}catch{return _}}function ie(_){typeof navigator>"u"||!navigator.clipboard||navigator.clipboard.writeText(_).catch(P=>{console.error("Failed to copy to clipboard:",P)})}function ae(){return e(o)==="all-combined"?e(Q):e(r)?q.getSessionIds(e(r)):[]}function $(){if(e(o)==="all-combined"){const _=new Map;for(const P of e(re))for(const ee of P.ids)_.has(ee.weebdexId)||_.set(ee.weebdexId,ee);return Array.from(_.values()).sort((P,ee)=>P.weebdexId.localeCompare(ee.weebdexId))}else if(e(r)){const _=e(re).find(P=>P.timestamp===e(r));return _?[..._.ids]:[]}return[]}function pe(){const _=$(),P=["weebdex_id","legacy_id"],ee=_.map(he=>[he.weebdexId,he.legacyId||""]);function le(he){return he.includes(",")||he.includes('"')||he.includes(`
`)?`"${he.replace(/"/g,'""')}"`:he}return[P.map(le).join(","),...ee.map(he=>he.map(le).join(","))].join(`
`)}function ye(){c(I,!e(I))}function we(){const _=pe();ie(_)}function me(_){const P=_.split(`
`),ee=[];for(const le of P)if(le.includes(",")){const Se=le.split(",");for(const he of Se){const Ce=he.trim();Ce&&Ce.toLowerCase()!=="legacy_id"&&Ce.toLowerCase()!=="weebdex_id"&&ee.push(Ce)}}else{const Se=le.trim();Se&&ee.push(Se)}return ee.filter(le=>le.length>0)}async function ge(){if(e(N).trim()){c(S,!0),c(L,null);try{const _=me(e(N));if(_.length===0){c(L,{imported:0,failed:0},!0),c(S,!1);return}const P=await q.importLegacyIds(_);if(c(L,P,!0),P.imported>0){c(N,""),c(o,"per-session");const ee=q.sessions.find(le=>le.timestamp.startsWith("imported-"));ee&&c(r,ee.timestamp,!0)}}catch(_){console.error("Import failed:",_),c(L,{imported:0,failed:me(e(N)).length},!0)}finally{c(S,!1)}}}function Z(){if(e(o)==="all-combined")return`All Combined IDs (${e(Q).length} unique)`;if(e(r)){const _=e(re).find(P=>P.timestamp===e(r));return _?`${z(e(r))} (${_.ids.length} IDs)`:"No session selected"}return"Select a session"}var K=Ur(),R=s(K);R.__click=()=>{c(h,!e(h))};var se=s(R),ve=s(se);{var y=_=>{var P=xr();u(_,P)},m=_=>{var P=Sr();u(_,P)};x(ve,_=>{e(h)?_(y):_(m,!1)})}a(se),dt(2),a(R);var H=i(R,2);{var xe=_=>{var P=Vr(),ee=De(P),le=i(s(ee),2);le.__click=()=>{c(o,"per-session"),c(r,null)};var Se=i(le,2);Se.__click=()=>{c(o,"all-combined"),c(r,null)},a(ee);var he=i(ee,2);{var Ce=Y=>{var B=Ar(),U=s(B),ne=s(U),C=i(s(ne),2);C.__change=p=>{c(r,p.target.value||null,!0)};var A=s(C);A.value=A.__value="";var j=i(A);He(j,17,()=>e(re),Xe,(p,b)=>{var F=Cr(),n=s(F);a(F);var d={};O(f=>{w(n,`${f??""} (${e(b).ids.length??""} IDs)`),d!==(d=e(b).timestamp)&&(F.value=(F.__value=e(b).timestamp)??"")},[()=>z(e(b).timestamp)]),u(p,F)}),a(C),a(ne);var ce=i(ne,2);{var fe=p=>{var b=Nr();b.__click=()=>{if(!e(r))return;const F=e(re).find(d=>d.timestamp===e(r)),n=F?z(e(r)):"this session";confirm(`Are you sure you want to delete ${n}? This will remove ${F?.ids.length||0} ID(s). This cannot be undone.`)&&(q.deleteSession(e(r)),c(r,null))},u(p,b)};x(ce,p=>{e(r)&&p(fe)})}a(U),a(B),u(Y,B)};x(he,Y=>{e(o)==="per-session"&&Y(Ce)})}var We=i(he,2);{var ke=Y=>{var B=Mr(),U=s(B),ne=s(U),C=s(ne,!0);a(ne);var A=i(ne,2),j=s(A);j.__click=()=>ie(ae().join(`
`));var ce=i(j,2);ce.__click=ye;var fe=s(ce,!0);a(ce),a(A),a(U);var p=i(U,2);{var b=n=>{var d=Er(),f=s(d),D=s(f);D.__click=we,a(f);var T=i(f,2);At(T),T.__click=G=>G.target.select(),a(d),O((G,g)=>{Qt(T,G),ht(T,"rows",g)},[pe,()=>Math.min(pe().split(`
`).length+2,20)]),u(n,d)},F=n=>{var d=Lr(),f=s(d),D=s(f);{var T=g=>{var k=Rr();u(g,k)},G=g=>{var k=Me(),oe=De(k);{var Ve=Ee=>{var Ie=Me(),Re=De(Ie);He(Re,17,()=>e(X),Xe,(Pe,Ge)=>{let Oe=()=>e(Ge).entry,Te=()=>e(Ge).isRestored,Be=()=>e(Ge).inSpreadsheet;var Je=Fr(),$e=s(Je),it=s($e,!0);a($e);var ct=i($e,2);{var It=st=>{var lt=Gr(),wt=s(lt);a(lt),O(()=>w(wt,`(${Oe().legacyId??""})`)),u(st,lt)};x(ct,st=>{Oe().legacyId&&st(It)})}var at=i(ct,2);{var Bt=st=>{var lt=Dr();u(st,lt)},Yt=st=>{var lt=Me(),wt=De(lt);{var Ht=vt=>{var xt=Tr();u(vt,xt)},Xt=vt=>{var xt=Pr();u(vt,xt)};x(wt,vt=>{Be()?vt(Ht):vt(Xt,!1)},!0)}u(st,lt)};x(at,st=>{Te()?st(Bt):st(Yt,!1)})}a(Je),O(()=>w(it,Oe().weebdexId)),u(Pe,Je)}),u(Ee,Ie)},Ae=Ee=>{var Ie=Me(),Re=De(Ie);He(Re,17,ae,Xe,(Pe,Ge)=>{var Oe=kr(),Te=s(Oe,!0);a(Oe),O(()=>w(Te,e(Ge))),u(Pe,Oe)}),u(Ee,Ie)};x(oe,Ee=>{e(X).length>0?Ee(Ve):Ee(Ae,!1)},!0)}u(g,k)};x(D,g=>{e(J)?g(T):g(G,!1)})}a(f),a(d),u(n,d)};x(p,n=>{e(I)?n(b):n(F,!1)})}a(B),O(n=>{w(C,n),w(fe,e(I)?"Hide CSV":"Show CSV")},[Z]),u(Y,B)},Le=Y=>{var B=Me(),U=De(B);{var ne=A=>{var j=Wr();u(A,j)},C=A=>{var j=Or();u(A,j)};x(U,A=>{e(o)==="per-session"&&!e(r)?A(ne):A(C,!1)},!0)}u(Y,B)};x(We,Y=>{(e(o)==="all-combined"||e(r))&&ae().length>0?Y(ke):Y(Le,!1)})}var Ze=i(We,2),Ne=s(Ze);Ne.__click=()=>{c(l,!e(l)),e(l)&&c(L,null)};var je=s(Ne,!0);a(Ne);var Qe=i(Ne,2);{var V=Y=>{var B=Zr(),U=i(s(B),2);At(U),ht(U,"rows",6);var ne=i(U,2),C=s(ne);C.__click=ge;var A=s(C,!0);a(C);var j=i(C,2);{var ce=fe=>{var p=zr(),b=s(p);a(p),O(()=>w(b,`Imported: ${e(L).imported??""}, Failed: ${e(L).failed??""}`)),u(fe,p)};x(j,fe=>{e(L)&&fe(ce)})}a(ne),a(B),O(fe=>{U.disabled=e(S),C.disabled=fe,w(A,e(S)?"Importing...":"Import")},[()=>e(S)||!e(N).trim()]),zt(U,()=>e(N),fe=>c(N,fe)),u(Y,B)};x(Qe,Y=>{e(l)&&Y(V)})}a(Ze);var te=i(Ze,2),_e=s(te);_e.__click=()=>q.loadData();var ue=i(_e,2);ue.__click=()=>{confirm("Are you sure you want to clear all completed IDs from localStorage? This cannot be undone.")&&q.clearAll()},a(te),O(()=>{Fe(le,1,`uno-r9todb ${e(o)==="per-session"?"uno-qv685z":"uno-7i144e"}`),Fe(Se,1,`uno-r9todb ${e(o)==="all-combined"?"uno-qv685z":"uno-7i144e"}`),w(je,e(l)?"Hide Import":"Import Legacy IDs")}),u(_,P)};x(H,_=>{e(h)&&_(xe)})}a(K),u(be,K),tt()}nt(["click","change"]);var qr=v('<div class="uno-j48514"><p class="uno-5v04yw">No zip file selected. Use the tabs above to select a zip file to process.</p></div>'),Br=v('<div class="uno-eeu1av"><!> <!></div>'),Yr=v('<div class="uno-pb4e2u"><div class="uno-k0pcvl"><h1 class="uno-kryzyj">Guided Zip Manga Uploader</h1> <div class="uno-skt2gn"><button type="button" class="uno-q7l7gr">Simple Mode</button> <button type="button" class="uno-q7l7gr">Chapter Editor</button> <!></div></div> <a target="_blank" class="uno-6zhxse">Tutorial & Docs</a> <!> <!> <!></div>');function un(be,t){et(t,!0);const o=new la,r=new ca,h=new Ua;ft(ua,o),ft(Rt,r),ft(Dt,h),ft(jt,new La);let I=W(null),l=W(null),N=W(null);Jt(()=>{c(N,new Date().toISOString(),!0)});function S(){o.workflowStep=gt.SELECTING_MANGA_FOLDERS}function L(){if(o.workflowStep=gt.PROCESSING_MANGA,o.selectedZipFiles.length>0){const R=o.selectedZipFiles[0],se=o.zipFiles.findIndex(ve=>ve.file===R);se>=0&&(o.currentZipIndex=se,c(I,R,!0))}}function X(R){c(I,R,!0)}async function J(R,se){const ve=o.currentZip;if(ve&&(R==="success"?(o.setZipStatus(ve.file,ze.COMPLETED),se&&e(N)&&await h.addCompletedId(e(N),se)):R==="warning"?o.setZipStatus(ve.file,ze.WARNING):R==="error"&&o.setZipStatus(ve.file,ze.ERROR)),o.moveToNextZip()){const y=o.currentZip;y&&c(I,y.file,!0)}else c(I,null)}function q(){e(l)&&e(l).startUpload()}const re=de(()=>o.workflowStep!==gt.PROCESSING_MANGA);var Q=Yr(),E=s(Q),z=i(s(E),2),ie=s(z);ie.__click=()=>Mt(St("/"));var ae=i(ie,2);ae.__click=()=>Mt(St("/chapter-editor"));var $=i(ae,2);Fa($,{}),a(z),a(E);var pe=i(E,2),ye=i(pe,2);{var we=R=>{ka(R,{})};x(ye,R=>{e(re)&&R(we)})}var me=i(ye,2);jr(me,{});var ge=i(me,2);{var Z=R=>{Za(R,{get guidedState(){return o},onDone:S,class:"uno-zgouyr"})},K=R=>{var se=Me(),ve=De(se);{var y=H=>{ss(H,{get guidedState(){return o},onDone:L,class:"uno-l0uum8"})},m=H=>{var xe=Me(),_=De(xe);{var P=ee=>{var le=Br(),Se=s(le);fs(Se,{get guidedState(){return o},onZipSelected:X,onAutomationRequestUpload:q,get mangaProcessorRef(){return e(l)},class:"uno-wgeun8"});var he=i(Se,2);{var Ce=ke=>{_t(wr(ke,{get guidedState(){return o},get zipFile(){return e(I)},onProcessingComplete:J,class:"uno-wgeun8"}),Le=>c(l,Le,!0),()=>e(l))},We=ke=>{var Le=qr();u(ke,Le)};x(he,ke=>{e(I)?ke(Ce):ke(We,!1)})}a(le),u(ee,le)};x(_,ee=>{o.workflowStep===gt.PROCESSING_MANGA&&ee(P)},!0)}u(H,xe)};x(ve,H=>{o.workflowStep===gt.SELECTING_MANGA_FOLDERS?H(y):H(m,!1)},!0)}u(R,se)};x(ge,R=>{o.workflowStep===gt.SELECTING_ROOT_FOLDER?R(Z):R(K,!1)})}a(Q),O(R=>ht(pe,"href",R),[()=>St("/docs")]),u(be,Q),tt()}nt(["click"]);export{un as component,ln as universal};
